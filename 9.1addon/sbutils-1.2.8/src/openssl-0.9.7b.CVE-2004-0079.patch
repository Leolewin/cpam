Index: ssl/s3_pkt.c
===================================================================
--- ssl/s3_pkt.c.orig	2005-11-03 09:21:56.311617000 -0600
+++ ssl/s3_pkt.c	2005-11-03 09:23:14.926280000 -0600
@@ -1085,6 +1085,14 @@
 			goto err;
 			}
 
+		/* Check we have a cipher to change to */
+		if (s->s3->tmp.new_cipher == NULL)
+			{
+			i=SSL_AD_UNEXPECTED_MESSAGE;
+			SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_CCS_RECEIVED_EARLY);
+			goto err;
+			}
+
 		rr->length=0;
 
 		if (s->msg_callback)
