<?xml version="1.0"?>
<programs>
  <program name="lftp" version="3.0.6" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}30</install-name>

    <sources>
      <source checksum="db6cb85639ff8c0c33406c272563ffa3"
        checksum-type="md5" size="1219493"
        path="src/lftp-3.0.6.tar.bz2"/>
      <patch checksum="a5aa4454743a12fd63fbdf01f8250918"
        checksum-type="md5" size="1131903"
        path="src/lftp-3.0.6.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison13"
        add-path="prepend" type="build">v&gt;=1.35</depend>
      <depend program="gcc" install-name="gcc332" add-path="prepend"
        systype="*-aix4*|*-hpux10*|*-solaris*">v==3.3.2</depend>
      <depend var="GCC_RT" install-name="gcc332r"
        systype="*-aix4*|*-hpux10*|*-solaris*"/>
      <depend program="gettext" var="GETTEXT"
        install-name="gettext014"
        add-path="prepend">v&gt;=0.14.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv19" add-path="prepend"
        systype="*-hpux*|*-irix*|*-linux*|*-osf*|*-solaris*">v&gt;=1.9.2</depend>
      <depend program="ncurses" var="NCURSES"
        install-name="ncurses54">v&gt;=5.4</depend>
      <depend program="readline" var="READLINE"
        install-name="readline43">v&gt;=4.3</depend>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_sysconfdir="${SB_INSTALL_PREFIX}/etc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix5*)
  CC=xlc CFLAGS="-O2 -qmaxmem=-1 -qarch=com"
  CXX=xlC CXXFLAGS="-O2 -qmaxmem=-1 -qarch=com"
  LDFLAGS="-Wl,-brtl -Wl,-bnortllib -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
*-aix*)
  CFLAGS="-O2 -mpower -mcpu=common"
  CXXFLAGS="-O2 -mpower -mcpu=common"
  LDFLAGS="-Wl,-brtl -Wl,-bnortllib -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
*-osf4*)
  CC=cc CFLAGS="-O2 -ieee -std1 -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -ieee -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -ieee -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -ieee -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
*-hpux11.11)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  # getnameinfo and getaddrinfo are broken
  export ac_cv_func_getaddrinfo=no
  export ac_cv_func_getipnodebyname=no
  export ac_cv_func_getnameinfo=no ;;
*-hpux11*)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  # problems with getnameinfo()
  export ac_cv_func_getnameinfo=no
  export ac_cv_func_getaddrinfo=no ;;
*-hpux10*)
  CFLAGS="-O2 -march=1.1" CXXFLAGS="-O2 -march=1.1"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix6*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 -O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 -O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-solaris2.[89])
  CFLAGS="-O2 -mcpu=v8" CXXFLAGS="-O2 -mcpu=v8"
  CC_LD_RT="-R" ;;
*-solaris2*)
  CFLAGS="-O2 -mcpu=v7" CXXFLAGS="-O2 -mcpu=v7"
  CC_LD_RT="-R" ;;
esac

./configure CC="${CC:-gcc}" CXX="${CXX:-g++}" \
CPPFLAGS="-I${SB_VAR_READLINE_INC} \
${SB_VAR_NCURSES+-I${SB_VAR_NCURSES_INC}}" \
CFLAGS="${CFLAGS:--O2}" CXXFLAGS="${CXXFLAGS:--O2} \
-I${SB_VAR_READLINE_INC} ${SB_VAR_NCURSES+-I${SB_VAR_NCURSES_INC}}" \
LDFLAGS="-L${SB_VAR_READLINE_LIB} \
${SB_VAR_NCURSES+-L${SB_VAR_NCURSES_LIB}} \
${CC_LD_RT}${SB_VAR_READLINE_LIB}\
${SB_VAR_NCURSES+:${SB_VAR_NCURSES_LIB}}\
${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT_LIB}} ${LDFLAGS+${LDFLAGS}}" \
--datadir="${_datadir}" --sysconfdir="${_sysconfdir}" \
--disable-dependency-tracking --with-libintl-prefix=${SB_VAR_GETTEXT} \
${SB_VAR_LIBICONV+--with-libiconv-prefix=${SB_VAR_LIBICONV}} \
${ARGS+${ARGS}} --prefix=${SB_INSTALL_PREFIX}

gmake configure
]]>
    </configure>

    <install>
<![CDATA[
gmake install

rmdir ${SB_INSTALL_PREFIX}/lib/lftp || :
rmdir ${SB_INSTALL_PREFIX}/lib || :
]]>
    </install>

    <notes>
      <change from="3.0.5" to="3.0.6">
        <item><para>completion for bm: URL scheme
implemented</para></item>
        <item><para>fixed "du" command with large files
&gt;2Gb</para></item>
        <item><para>fixed saving old directory when no cd verification
is performed</para></item>
        <item><para>compilation on HP-UX fixed</para></item>
      </change>

      <change from="3.0.4" to="3.0.5">
        <item><para>new URL scheme bm:bookmark_name[/path] to specify
bookmarked URLs</para></item>
        <item><para>fixed encrypted FXP in certain server
combinations</para></item>
        <item><para>fixed ftp retrying on 4xx code when data
connection was already closed</para></item>
        <item><para>fixed compilation without SSL</para></item>
      </change>

      <change from="3.0.3" to="3.0.4">
        <item><para>encrypted FXP is now supported with CPSV or SSCN
commands</para></item>
        <item><para>new setting ftp:ssl-protect-fxp (default is
no)</para></item>
        <item><para>cpu usage optimizations, sftp
speed-up</para></item>
        <item><para>fixed uploading of zero sized files over
ftp</para></item>
        <item><para>fixed coredump when AUTH SSL was used and the
server refused to setup ssl connection</para></item>
        <item><para>fixed coredump on unexpected extra ftp server
reply</para></item>
        <item><para>added workaround for ftp servers violating RFC2389
(format of FEAT reply)</para></item>
        <item><para>added workaround for ftp servers which refuse to
switch to utf-8 before login</para></item>
        <item><para>fixed compilation on systems without
strtok_r</para></item>
      </change>

      <change from="3.0.2" to="3.0.3">
        <item><para>cls for sftp can now print symbolic user, group
and number of hard links</para></item>
        <item><para>make "cd dir/" check if dir exists</para></item>
        <item><para>follow ftp:ssl-force even if ftp server does not
advertise AUTH in FEAT reply</para></item>
        <item><para>fixed excessive STAT commands in FXP
transfer</para></item>
        <item><para>fixed core dump when disconnecting with active FXP
transfer</para></item>
        <item><para>fixed memory leak in sftp uploading and file
renaming</para></item>
      </change>

      <change from="3.0.1" to="3.0.2">
        <item><para>support for ftp commands CLNT, HOST and OPTS MLST
added</para></item>
        <item><para>ftp command MLSD disabled by default as it does
not return symlink info</para></item>
        <item><para>added workaround for MLSD format bug in
NcFTPd</para></item>
        <item><para>fixed spinning in cls when output stalls (e.g.
cls|less)</para></item>
        <item><para>fixed coredump when ftp:proxy was specified
without protocol name</para></item>
        <item><para>fixed assertion failure when using ftp over http
proxy with CONNECT method</para></item>
        <item><para>fixed timeout message in sftp when it is
disconnected</para></item>
        <item><para>fixed compilation on systems lacking atoll
function</para></item>
      </change>

      <change from="3.0.0" to="3.0.1">
        <item><para>fixed timeout handling in sftp</para></item>
        <item><para>fixed a coredump in case of some network
errors</para></item>
        <item><para>fixed compilation with gcc-2.95</para></item>
        <item><para>fixed compilation with socks</para></item>
        <item><para>fixed compilation without ssl</para></item>
      </change>

      <change from="2.6.12" to="3.0.0">
        <item><para>sftp protocol support (use "sftp://user@host"
URLs). sftp is a protocol implemented as ssh2 subsystem, it is binary
and works over a secure channel.</para></item>
        <item><para>faster directory caching, no re-parsing each
time</para></item>
        <item><para>ftp now follows RFC2640; FEAT, LANG, UTF8 support;
new settings ftp:use-feat and ftp:lang</para></item>
        <item><para>ftp can set modification time on remote files
using either SITE UTIME or two argument MDTM command (off by default);
new settings ftp:use-site-utime and
ftp:use-mdtm-overloaded</para></item>
        <item><para>ftp can now use MLSD to get machine parseable file
listing (ftp:use-mlsd)</para></item>
        <item><para>charset translation in ftp protocol, new setting
ftp:charset</para></item>
        <item><para>new mirror option --delete-first to remove old
files before transferring new files. By default mirror removes old
files after the transfers.</para></item>
        <item><para>now mirror can replace directories with plain
files or symbolic links if --delete (-e) option is
specified</para></item>
        <item><para>ftp can now use CONNECT method of http proxies
(when ftp:use-hftp is false)</para></item>
        <item><para>mirror open --newer-than can now take time
specification like that of at(1) command, like "week ago", "now-7days"
or "2004-01-01"</para></item>
        <item><para>new mirror options --ignore-size and
--only-missing</para></item>
        <item><para>new mirror option --use-pget[-n=N] to make mirror
use pget to transfer files.</para></item>
        <item><para>debug output can now include date and time on each
line (debug -t). When lftp goes to background, this is turned on by
default, along with pid (-p) and context (-c). Try "debug -tcp" and
see.</para></item>
        <item><para>get1 command has now --source-region and
--target-position options to get a part of a file</para></item>
        <item><para>better handling of ~/.netrc - multiple logins for
the same machine are allowed, proper password is taken automatically
from netrc if a login matches</para></item>
        <item><para>pget has now a progress bar which shows file
download state</para></item>
        <item><para>new source option -e to execute output of an
external program</para></item>
        <item><para>chmod -R fixed</para></item>
        <item><para>fixed cache invalidation when file name being
invalidated ends with a slash</para></item>
      </change>

      <change from="2.6.11" to="2.6.12">
        <item><para>fixed put over https protocol</para></item>
        <item><para>fixed spinning in bg mode when an external program
was still running at the time of moving to background</para></item>
        <item><para>fixed compilation with IRIX MIPSPro
compiler</para></item>
      </change>

      <change from="2.6.10" to="2.6.11">
        <item><para>fixed mirror for empty files</para></item>
        <item><para>a rare coredump fixed in http 0.9 handling, when
first line of reply is empty</para></item>
        <item><para>compilation fixes for compilers other than
gcc</para></item>
        <item><para>translations update</para></item>
      </change>

      <note type="usage">
        <para>The global configuration file resides in
<command>${SB_INSTALL_PREFIX}/etc/lftp.conf</command>.</para>
      </note>

      <platform name="HP-UX 11.00">
        <para>Patch <command>PHSS_22543</command> providing the
<command>libstd_v2</command> Standard C++ library is required as the
HP C++ compiler was used.</para>
      </platform>

      <platform name="Tru64 UNIX">
        <para>The latest C++ runtime library is required due to the
usage of the latest Compaq C++ compiler. It is available from the
following locations:</para>
        <unorderedlist>
          <item><para>package CXXREDIST651V37.tar in the support
directory of the CD</para></item>
          <item><para>online support directory <ulink url="ftp://support.thewrittenword.com/dists">ftp://support.thewrittenword.com/dists</ulink></para></item>
          <item><para>directly from Compaq at <ulink url="ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm">ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm</ulink></para></item>
        </unorderedlist>
      </platform>
    </notes>
  </program>
</programs>
