<?xml version="1.0"?>
<programs>
  <program name="gimp-print" version="4.2.7" revision="2">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>gimpprint42</install-name>

    <sources>
      <source checksum="766be49f44a6a682d857e5aefec414d4"
        checksum-type="md5" size="5178122"
        path="src/gimp-print-4.2.7.tar.gz"/>
      <patch checksum="74bd6433befd635a9bf1606b8b7565f3"
        checksum-type="md5" size="1133790"
        path="src/gimp-print-4.2.7.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison13"
        add-path="prepend" type="build">v&gt;=1.35</depend>
      <depend program="gettext" var="GETTEXT"
        install-name="gettext014"
        add-path="prepend">v&gt;=0.14.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv19"
        systype="*-hpux*|*-irix*|*-linux*|*-osf*|*-solaris*">v&gt;=1.9.2</depend>
      <depend program="zlib" var="ZLIB"
        install-name="zlib11">v&gt;=1.1.4</depend>
      <depend var="GCC_RT" install-name="gcc332r"
        systype="*-aix*"/>
      <depend var="GS_RT" install-name="ghostscript70r"
        add-path="prepend"/>
      <depend program="gcc" add-path="prepend">v==3.3.2</depend>
      <depend program="perl" add-path="prepend">v==5.8.2</depend>
      <depend program="readline" var="READLINE">v==4.3</depend>
      <depend program="texinfo" add-path="prepend">v==4.6</depend>
    </dependencies>

    <script-header>
<![CDATA[
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mpower -mcpu=common"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -Ae -z +ESlit +Onofltacc +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 -O2 \
-OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf4*)
  CC=cc CFLAGS="-O2 -std1 -ieee -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -msym -readonly_strings "
  CC_LD_RT="-Wl,-rpath," ;;
*-solaris2.[89])
  CFLAGS="-O2 -mcpu=v8"
  CC_LD_RT="-R" ;;
*-solaris2*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic"
  CC_LD_RT="-R" ;;
esac

rm -f config.cache
CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_READLINE_INC} -I${SB_VAR_ZLIB_INC}" \
LDFLAGS="-L${SB_VAR_READLINE_LIB} -L${SB_VAR_ZLIB_LIB} \
${CC_LD_RT}${SB_VAR_READLINE_LIB}:${SB_VAR_ZLIB_LIB}\
${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT}/lib} ${LDFLAGS+${LDFLAGS}}" \
./configure ${SB_VAR_CUPS+--with-cups} --with-ijs --with-escputil \
--with-translated-ppds --with-gimp=no --with-samples=no \
--with-readline=only --with-foomatic=no --with-foomatic3=no \
--with-foomatic-oldids=no --with-libintl-prefix=${SB_VAR_GETTEXT} \
${SB_VAR_LIBICONV+--with-libiconv-prefix=${SB_VAR_LIBICONV}} \
--prefix=${SB_INSTALL_PREFIX}

# Old version of BISON used to autogenerate (gets alloca definition wrong)
rm -f src/printdef/printdefy.c src/printdef/printdefy.h

# Rebuild info files
rm doc/*.info*

${SB_PATH_SHTOOL} subst -q -e "\
s!libdirs=-L\(.*\)!libdirs=\"-L\1 ${CC_LD_RT}\1\"!" \
src/main/gimpprint-config
]]>
    </configure>

    <build>
<![CDATA[
gmake DOCDIR=${_docdir}
]]>
    </build>

    <install>
<![CDATA[
gmake install DOCDIR=${_docdir}

rmdir ${SB_INSTALL_PREFIX}/share/gimp-print/samples
rmdir ${SB_INSTALL_PREFIX}/share/gimp-print
rmdir ${SB_INSTALL_PREFIX}/lib/gimp/1.2/plug-ins
rmdir ${SB_INSTALL_PREFIX}/lib/gimp/1.2
rmdir ${SB_INSTALL_PREFIX}/lib/gimp

${SB_PATH_INSTALL} -m 644 -o root -g 0 -d ${_docdir}/texinfo
${SB_PATH_INSTALL} -m 644 -o root -g 0 doc/*.texi doc/print-color.* \
doc/print-main.* doc/print-setup.* ${_docdir}/texinfo
]]>
    </install>

    <notes>
      <change from="4.2.6" to="4.2.7">
        <items name="Major bugs fixed">
          <item><para>Many Macintosh OS X users have reported problems
of various kinds with USB-attached printers, including both native USB
and parallel printers connected with USB-parallel printers. Symptoms
reported include failure to print altogether, inability to print more
than one page without rebooting or restarting the print system, and
poor performance. These problems are not specific to
Gimp-Print.</para>
          <para>We have released a replacement USB backend driver for
Macintosh OS X 10.2 and higher that to the best of our knowledge fixes
all of these problems. This driver, named "usbtb", is available on the
download site at <ulink url="http://sourceforge.net/project/showfiles.php?group_id=1537&amp;package_id=120183">http://sourceforge.net/project/showfiles.php?group_id=1537&amp;package_id=120183</ulink></para>
          <para>We recommend that all users of OS X 10.2 and above who
are having printing problems with USB-attached printers try this
driver. In addition to resolving these problems, this driver also also
provides textual cues to the system printer queue window to walk the
user through recovery from common error conditions, and it also
provides ink level reporting for Epson and HP printers that support
it.</para>
          <para>This replacement USB backend driver is not specific to
Gimp-Print, and may be used with any USB-connected printer with any
printer driver under OS X.</para></item>
          <item><para>(bug 907765) The CUPS driver now reports pages
starting from page 1 rather than page 0 as was previously the
case</para></item>
          <item><para>(bug 919224) The Postscript output driver (in
the GIMP plugin) now functions correctly in non-US locales when a PPD
file is provided</para></item>
          <item><para>(bug 919225) A segmentation violation on the
IA64 platform is fixed</para></item>
          <item><para>(bug 972014) A bug in the Postscript output
driver causes the GIMP plugin to crash on startup with certain PPD
files. This bug is not related to locale. At least certain PPD files
from the Epson PIPS drivers are known to result in this
problem.</para></item>
          <item><para>(bug 919226) The horizontal printing position on
the Epson Stylus C63/C64 and C83/C84 printers has been
fixed.</para></item>
          <item><para>(bug 613054) The CUPS driver now handles, via a
workaround, incorrect Postscript generated by some programs. In
certain cases, these programs result in the generation of single bit
output, rather than 8-bit output as it should. The result was that
Gimp-Print printed only a thin band of horizontally compressed output,
and it may have crashed in some cases.</para>
          <para>The programs most commonly affected were Adobe
InDesign 2.0 and psnup</para></item>
          <item><para>(bug 924862) The package now operates correctly
with on Solaris and other systems using an external
libintl</para></item>
          <item><para>(bug 929227) Gimp-Print no longer attempts to
build (and fail) the Print plugin against the GIMP 2.0. This fix
requires a special build procedure in some circumstances; please see
item (10) under Exceptions and Workarounds below.</para></item>
          <item><para>(bug 855685) escputil now reports ink levels
from all known Epson Stylus printers. In addition, ink level reporting
is more reliable in general, with fewer timeouts or unparseable
output.</para></item>
          <item><para>(bug 971832) The HP DesignJet 2500 and 3500 now
support correct maximum page widths of 36" and 54" respectively,
rather than 44" for both.</para></item>
          <item><para>(bug 971833) The PPD files now use the
recommended manufacturer names. Previously, certain CUPS applications
could display the manufacturer names incorrectly.</para></item>
        </items>

        <items name="New functionality">
          <item><para>The Epson Stylus Photo R200/R210 and R300/R310
printers, and the RX500 and RX600 multi-function devices, are now
supported. These printers have been properly tuned and are fully
functional (except for direct printing to CD's). The Epson CX5300 and
CX5400 multi-functional devices are also now supported as
printers.</para></item>
          <item><para>The HP LaserJet 1012 and Brother HL-1440
printers are now supported.</para></item>
          <item><para>Super A0 and Super B0 paper sizes are now
supported</para></item>
          <item><para>Translations for Hungarian, Ukrainian, and
Norwegian/Bokmaal have been added. In addition, other translations
have been updated.</para></item>
        </items>

        <items name="Exceptions and Workarounds">
          <item><para>Mac OS X users who use the Epson Printer Utility
(provided by Epson with their standard driver set) to check ink levels
and perform maintenance tasks, such as head cleaning or head
alignment, may encounter print job failures when attempting to print
with the Gimp-Print driver after using the Epson utility. The cause
for this failure is currently unknown, but the workaround is to
completely power-cycle the printer, after which the Gimp-Print driver
should again print normally. Another option is to disable the Epson
Printer Utility.</para></item>
          <item><para>The new HP DesignJets have not been fully tuned.
In particular, there are reports that they print too light. This can
be corrected with the Density adjustment (try 1.5~1.7 or
thereabouts).</para></item>
          <item><para>The list of compatible and potentially
compatible Hewlett-Packard printers has been updated with the latest
available information. If a particular printer does not work with the
recommended driver, we recommend that you try other similar drivers,
check the Feature Requests at <ulink url="http://sourceforge.net/tracker/?atid=101537&amp;group_id=1537&amp;func=browse">http://sourceforge.net/tracker/?atid=101537&amp;group_id=1537&amp;func=browse</ulink>,
and if the printer is not listed please file a feature request (via
the Submit New button).</para></item>
          <item><para>Borderless (full-bleed) printing is not quite
correct on the Epson Stylus Photo printers that support it (see bug
621668). Typically, the left or right margin is off by 1 mm or less,
resulting in a very fine white strip on that edge.</para></item>
          <item><para>Many Canon printers do not print correctly at
720x360 DPI. The workaround is to use 360 or 720 DPI.</para></item>
          <item><para>With certain versions of CUPS and in certain
configurations, if a new version of Gimp-Print is installed over an
existing version genppd will create PPD files based on the older
version of Gimp-Print rather than the newer version. This will happen
if all of the following are true:</para>
          <unorderedlist>
            <item><para>The cups-config provided by the CUPS driver
adds -Wl,rpath=/usr/lib. This is done by some versions of CUPS
reportedly because in some cases the runtime linker does not pick up
libraries out of /usr/lib. This can be checked by running</para>
            <screen>
cups-config --libs --ldflags
            </screen>
            <para>and inspecting the output for any mention of
"rpath", "RPATH", "RUN_PATH", or the like.</para></item>
            <item><para>There is presently a version of Gimp-Print
installed in /usr (--prefix=/usr) rather than /usr/local or the
like</para></item>
            <item><para>Gimp-Print is built dynamically only
(--disable-static)</para>
            <para>Note that in general if you install CUPS into a
non-standard location, and install Gimp-Print into the same location,
this problem can surface.</para>
            <para>This bug is difficult to detect in a normal build. It
does not cause an error to happen during build; the only failure is
that some PPD files may not be built or may be built with missing
options.</para>
            <para>In this case, the run path embedded in the genppd
executable points to the version of Gimp-Print installed in /usr/lib.
This run path overrides any attempt by libtool to look in the build
directory. The result is that genppd is run against the older version
of Gimp-Print. If the new version contains additional features (more
printers, etc.) they will not be available to genppd.</para>
            <para>If you wish to use only shared libraries, and do not
wish to build static libraries at all, there are three workarounds
available:</para>
            <unorderedlist>
              <item><para>Build and install Gimp-Print into /usr (rather
than /usr/local) and then rebuild Gimp-Print from scratch. This will
install the correct libgimpprint.so in /usr/lib, and in the rebuild
genppd will be run against the correct library.</para></item>
              <item><para>Remove the old version of Gimp-Print prior to
building the new version of Gimp-Print. The important files to remove
are anything named /usr/lib/libgimpprint*.</para></item>
              <item><para>Edit cups-config to remove the reference to the
run path</para></item>
            </unorderedlist></item>
          </unorderedlist></item>
          <item><para>The fix for bug 929227 (Gimp-Print incorrectly
attempts to build against GIMP 2.0) requires special build
instructions if you are using a very old version of the GIMP 1.2
(versions affected are believed to include 1.2.0, 1.2.1, and 1.2.2).
Specifically, you must set GIMPTOOL in the environment to point to the
proper version of gimptool when running Gimp-Print's configure script.
For example:</para>
          <screen>
GIMPTOOL=/usr/bin/gimptool ./configure
          </screen>
          <para>The bug fix involves checking for the presence of the
GIMP slightly differently from how it was previously done. Previously,
Gimp-Print checked for the presence of a program named "gimptool",
which provides information about how to build plugins against the
GIMP. This worked correctly when only the GIMP 1.2 was installed, but
not when the GIMP 2.0 was installed.</para>
          <para>The GIMP 2.0 actually installs a program named
"gimptool-2.0", and creates a symbolic link named "gimptool" pointing
to it. Later versions of the GIMP 1.2 (1.2.3, 1.2.4, 1.2.5, and any
later versions that may be released) similarly create a program named
"gimptool-1.2" and a symbolic link named "gimptool". As the configure
script prior to this bug fix simply checked for gimptool, it
incorrectly detected a gimptool from the GIMP 2.0, which this version
of Gimp-Print cannot build against.</para>
          <para>The current configure script checks first for
gimptool-1.2 and then for gimptool, and only accepts the use of a GIMP
1.2 version of one of these programs. However, if you have one of the
older versions of the GIMP 1.2 installed in a non-standard location,
and you use --with-gimp-prefix or --with-gimp-exec-prefix to specify
its location, the configure script will not automatically detect the
correct location of gimptool, and you must specify it as described
above. Note that you must specify a copy of gimptool from the GIMP
1.2, not from the GIMP 2.0. If your copy of the GIMP is installed in a
standard location (typically /usr/bin or /usr/local/bin), you do not
need to use --with-gimp-prefix or --with-gimp-exec-prefix, and
therefore do not need to use this workaround.</para>
          <para>The Gimp-Print and GIMP projects recommend upgrading
to a newer revision of the GIMP 1.2 (at the time these release notes
are written, the latest version is 1.2.5), which will not require this
workaround. This workaround is available in the event that you cannot
or do not wish to upgrade your installation of the GIMP.</para></item>
        </items>

        <item><para>613054 Mac OS X: Printing from InDesign 2.0 on OS
10.2.1</para></item>
        <item><para>855685 escputil does not return status for
C84</para></item>
        <item><para>907765 CUPS filter `progress meter' reports
incorrect page number</para></item>
        <item><para>919224 Postscript driver fails in non-US locale
with a PPD file</para></item>
        <item><para>919225 segv on ia64 from lack of prototype for
strdup</para></item>
        <item><para>919226 Incorrect horizontal offset on Epson C64
and C84 printers</para></item>
        <item><para>924862 Gimp-print breaks thebuild script of the
GIMP 2.0 on Solaris</para></item>
        <item><para>929227 Gimp-Print incorrectly attempts to build
against GIMP 2.0</para></item>
        <item><para>971832 HP DesignJet 2500/3500 have incorrect
widths</para></item>
        <item><para>971833 CUPS PPD manufacturer names violate spec
(4.2)</para></item>
        <item><para>972014 eksprx600_610.ppd crashes
gimp-print-4.2.6-4</para></item>
      </change>

      <change from="4.2.5" to="4.2.6">
        <items name="Major bugs fixed">
          <item><para>(bug 627266) The CUPS driver offers an
"Autoselect" option for the media source (input slot). This behavior
cannot be disabled. Previous versions of Gimp-Print did not handle
this option appropriately. This option is now handled appropriately,
by treating it as the default input slot for the
printer.</para></item>
          <item><para>(bug 729918) The PostScript driver (used only in
the Print plugin for the GIMP) did not operate correctly if the locale
was set to something other than the US English locale.</para></item>
          <item><para>(bug 668342) The Canon S-450, and other Canon
printers, only printed the first page of a multi-page job if the
printer was hosted on a Windows system.</para></item>
          <item><para>(bug 842715) The Epson Stylus Color 600, 800,
850, 1520, and 3000 failed to print in black and white or grayscale at
certain resolutions.</para></item>
          <item><para>(bug 865253) In certain cases, the PPD file
generator for CUPS may not generate all of the PPD files, or may not
generate them correctly. The underlying problem is some versions of
CUPS specify a linker command line that forces an old version of the
Gimp-Print driver library to be used when building the PPD
files.</para>
          <para>This fix works correctly unless --disable-static (to
disable building static libraries) is passed on the command line.
Normally, only people packaging up Gimp-Print for distribution use
this option. If you wish to use this option, please read the
Exceptions and Workarounds *carefully* for a full description of the
problem along with suggested methods of procedure.</para></item>
        </items>

        <items name="New Functionality">
          <item><para>A number of newer Epson Stylus printers and
multi-function devices are supported. Please see the supported
printers list at the bottom of this file for full information on
supported printers.</para></item>
          <item><para>The Canon S200 is now supported</para></item>
          <item><para>The European 10x15 cm and US Engineering C paper
sizes have been added</para></item>
          <item><para>The CUPS driver now offers normal and reversed
paper order, permitting printing documents in the correct page order
on inkjet and some laser printers</para></item>
          <item><para>A Czech language translation has been
added</para></item>
        </items>

        <items name="Quality improvements">
          <item><para>Under OS X, the options are grouped more
appropriately, making for easier use</para></item>
          <item><para>Some Epson printer resolution names have been
changed for clarity. This change does not introduce an
incompatibility.</para></item>
          <item><para>The escputil command no longer hangs if the
printer does not respond</para></item>
          <item><para>Minor speed improvement for the HP LaserJet
IIP</para></item>
          <item><para>Minor adjustment to the HP DeskJet 340
margins</para></item>
          <item><para>The PPD files have been audited for conformance
to the PPD specification</para></item>
        </items>

        <item><para>627266 Mac OS X: Autoselect option incorrectly
offered</para></item>
        <item><para>668342 Canon S-450 prints only one page of a
job</para></item>
        <item><para>729918 Postscript family driver fails in non-US
locale</para></item>
        <item><para>735493 CUPS PPD files lacking
*OutputOrder</para></item>
        <item><para>842715 Epson 600/800/850/1520/3000 fail at certain
resolutions BW</para></item>
        <item><para>865253 genppd may not generate new PPD files
(4.2)</para></item>
      </change>
    </notes>

    <changelog>
      <change date="2004 September 7" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Update to libtool-1.4.2-5</para></item>
      </change>
    </changelog>
  </program>
</programs>
