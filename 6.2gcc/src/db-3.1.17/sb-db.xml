<?xml version="1.0"?>
<programs>
  <program name="db" version="3.1.17" revision="4">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>libdb31</install-name>

    <sources>
      <source checksum="5baeb94fb934d0bf783ea42117c400be"
        checksum-type="md5" size="1954117"
        path="src/db-3.1.17.tar.gz"/>
      <patch checksum="b87832ffdac6eb4160f452012739707f"
        checksum-type="md5" size="707004"
        path="src/db-3.1.17.patch"/>
    </sources>

    <dependencies>
      <depend program="gcc" add-path="prepend">v==3.3.2</depend>
    </dependencies>

    <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix5*)
  CC=xlc_r CFLAGS="-O2 -qmaxmem=-1 -qarch=com"
  CXX=xlC_r CXXFLAGS="-O2 -qmaxmem=-1 -qarch=com"
  ARGS="--enable-cxx" LDFLAGS="-Wl,-brtl" ;;
*-aix*)
  CC=xlc_r CFLAGS="-O2 -qmaxmem=-1 -qarch=com"
  LDFLAGS="-Wl,-brtl" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -std" ;;
*-hpux11*)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch"
  ARGS="--enable-cxx" ;;
*-hpux10*)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit" ;;
*-irix6*)
  CC=cc CFLAGS="-O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-LANG:std -Wl,-woff,84 -Wl,-woff,85 -woff 1429 -O2"
  ARGS="--enable-cxx" ;;
*-linux9*|*-linuxe3*)
  ARGS="--enable-posixmutexes --enable-cxx" ;;
*-linux*)
  ARGS="--enable-cxx" ;;
*-sun-solaris2.[89])
  CFLAGS="-O2 -mcpu=v8"
  CXXFLAGS="-O2 -mcpu=v8"
  ARGS="--enable-cxx" ;;
*-solaris2*)
  CC=cc CFLAGS="-mr -Qn -xO2 -xtarget=generic"
  CXX=CC CXXFLAGS="-xO2 -xtarget=generic"
  ARGS="--enable-cxx" ;;
esac
]]>
    </script-header>

    <module name="default">
      <configure>
<![CDATA[
cd dist

rm -f config.cache
CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="${LDFLAGS+${LDFLAGS}}" ./configure --enable-compat185 \
--enable-shared --enable-rpc ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>

      <build>
<![CDATA[
_doc="${SB_INSTALL_PREFIX}/docs"
cd dist; gmake docdir=${_doc}
]]>
      </build>

      <install>
<![CDATA[
_doc="${SB_INSTALL_PREFIX}/docs"

cd dist
gmake strip=: docdir=${_doc} install

# For backwards compatibility with previous versions of this package
case "${SB_SYSTYPE}" in
*-irix6*)
  ln -s ./libdb-3.1.so \
  ${SB_INSTALL_PREFIX}/lib/libdb-3.1.so.  ;;
esac

chown -hR 0:0 ${SB_INSTALL_PREFIX}
]]>
      </install>
    </module>

    <module name="static">
      <configure>
<![CDATA[
cd dist

rm -f config.cache
CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="${LDFLAGS+${LDFLAGS}}" ./configure --enable-compat185 \
--disable-shared --enable-rpc ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>

      <build>
<![CDATA[
(cd dist; gmake)
]]>
      </build>

      <install>
<![CDATA[
ginstall -o root -g 0 dist/libdb.a ${SB_INSTALL_PREFIX}/lib
test -f dist/libdb_cxx.a && \
ginstall -o root -g 0 dist/libdb_cxx.a ${SB_INSTALL_PREFIX}/lib

:
]]>
      </install>
    </module>

    <notes>
      <note type="installation">
        <para>The C++ bindings to the Berkeley DB library were built
using the vendor C++ compiler for AIX 5.x, HP-UX 11.x, IRIX, Redhat
Linux, and Solaris.</para>
      </note>

      <platform name="HP-UX 11.00">
        <para>Patch <command>PHSS_22543</command> providing the
<command>libstd_v2</command> Standard C++ library is required as the
HP C++ compiler was used.</para>
      </platform>

      <platform name="Solaris 2.6/SPARC">
        <para>Patch <command>105591-09</command> or newer is required
as the Sun C++ compiler was used.</para>
      </platform>
    </notes>

    <changelog>
      <change date="2004 March 31" revision="4"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Redhat Enterprise Linux 2.1,
3</para></item>
      </change>

      <change date="2003 July 14" revision="3"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Redhat Linux 9
(force --enable-posixmutexes)</para></item>
      </change>

      <change date="2003 March 30" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 5.1. Update config.guess,
config.sub, and ltmain.sh to latest versions.</para></item>
      </change>

      <change date="2003 January 27" revision="1"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Quote LDFLAGS if not set</para></item>
      </change>
    </changelog>
  </program>
</programs>
