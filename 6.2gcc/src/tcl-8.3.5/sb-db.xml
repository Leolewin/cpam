<?xml version="1.0"?>
<programs>
  <program name="tcl" version="8.3.5" revision="3">
    <build-name>${SB_PROG_NAME}${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}83</install-name>

    <sources>
      <source checksum="5cb79f8b90cf1322cb1286b9fe67f7a2"
        checksum-type="md5" size="2863381"
        path="src/tcl8.3.5-src.tar.gz"/>
      <patch checksum="eae6cff843b1ade1f2fe109bcf300dfb"
        checksum-type="md5" size="31392"
        path="src/tcl8.3.5-src.patch"/>
    </sources>

    <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qmaxmem=-1 -qarch=com" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -std" ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch" ;;
*-irix6*)
  CC=cc CFLAGS="-O2 -OPT:Olimit=0" ;;
*-solaris2.[89])
  CFLAGS="-O2 -mcpu=v8" ;;
*-solaris2*)
  CC=cc CFLAGS="-mr -Qn -xO2 -xtarget=generic" ;;
esac
]]>
    </script-header>

    <build>
<![CDATA[
cd unix

sed -e "s/TCL_CFLAGS_OPTIMIZE=.*/TCL_CFLAGS_OPTIMIZE='${CFLAGS:--O2}'/" \
tclConfig.sh >/tmp/$$; cp /tmp/$$ tclConfig.sh; rm -f /tmp/$$

gmake CFLAGS="${CFLAGS:--O2}"
]]>
    </build>

    <module name="default">
      <dependencies>
        <depend program="gcc" add-path="prepend">v==3.3.2</depend>
        <depend var="TCLP" install-name="tcl83p"
          set-var-only="1"/>
      </dependencies>

      <configure>
<![CDATA[
# Tk warns against using a thread-enabled tcl
cd unix
rm -f config.cache
CC="${CC:-gcc}" ./configure --enable-shared \
--prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>

      <install>
<![CDATA[
(cd unix && gmake install)

# Fix runtime path to tcl shared library
case "${SB_SYSTYPE}" in
*-hpux*)
  (cd unix
  rm tclsh
  gmake TCL_BUILD_LIB_SPEC="-L${SB_INSTALL_PREFIX}/lib -ltcl8.3" tclsh)
  ${SB_PATH_GINSTALL} -m 755 -o root -g 0 unix/tclsh \
  ${SB_INSTALL_PREFIX}/bin/tclsh8.3 ;;
esac

# Fix path to ldAix
case "${SB_SYSTYPE}" in
*-aix*)
  ${SB_PATH_SHTOOL} subst -q -e "\
s!${SB_BUILD_PREFIX}/unix/ldAix!${SB_INSTALL_PREFIX}/lib/tcl8.3/ldAix!" \
${SB_INSTALL_PREFIX}/lib/tclConfig.sh
  ${SB_PATH_CHMOD} 755 ${SB_INSTALL_PREFIX}/lib/tcl8.4/ldAix
  ;;
esac
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_VAR_TCLP} ${SB_INSTALL_PREFIX}
]]>
      </uninstall>
    </module>

    <module name="static">
      <dependencies>
        <depend program="tcl">v==8.3.5</depend>
        <depend program="gcc" add-path="prepend">v==3.3.2</depend>
      </dependencies>

      <configure>
<![CDATA[
# Tk warns against using a thread-enabled tcl
cd unix
rm -f config.cache
CC="${CC:-gcc}" ./configure --disable-shared \
--prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>

      <install>
<![CDATA[
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX}/lib

${SB_PATH_GINSTALL} -o root -g 0 unix/libtcl8.3.a \
${SB_INSTALL_PREFIX}/lib
]]>
      </install>
    </module>

    <notes>
      <note type="usage">
        <para>The default Tcl module search path directories
are:</para>
        <screen>
${SB_INSTALL_BASE}/tcl83p/lib/itcl3.2
${SB_INSTALL_BASE}/tcl83p/lib/itk3.2
${SB_INSTALL_BASE}/tcl83p/lib/iwidgets4.0.1
${SB_INSTALL_BASE}/tcl83p/lib/tclcurl0.11
${SB_INSTALL_BASE}/tcl83p/lib/tcllib1.6
${SB_INSTALL_BASE}/tcl83p/lib/tclx8.4
        </screen>

        <para>The default search path is set by the
<command>TCLLIBPATH</command> environment variable. The executable
wrapper for <command>tclsh8.3</command> sets the variable to the paths
above.</para>

        <para>The following 3rd-party modules are provided: TclCurl
0.11.0, itcl 3.2.1, tcllib 1.3, tclX 8.4.</para>

        <para>Package dependencies for some modules:</para>
        <unorderedlist>
          <item><para>The TclCurl 0.11.0 module needs v7.11.1 of the
curl package</para></item>
        </unorderedlist>
      </note>
    </notes>

    <changelog>
      <change date="2004 September 12" revision="3"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Create lib directory for "static" module when
installing so we don't assume "default" module installed
first</para></item>
      </change>

      <change date="2004 January 26" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Fix runtime path to -ltcl8.4 in tclsh8.4 binary on
HP-UX</para></item>
      </change>

      <change date="2003 March 30" revision="1"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 5.1</para></item>
      </change>
    </changelog>
  </program>
</programs>
