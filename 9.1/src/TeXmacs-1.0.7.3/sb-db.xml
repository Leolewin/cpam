<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="TeXmacs" version="1.0.7.3" revision="2"
  systype="*-aix*|hppa*-hpux11*|ia64*-hpux11.23|*-irix*|*-linux*|*-solaris*">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}-src</build-name>

    <install-name>texmacs10</install-name>

    <sources>
      <source checksum="dd7886153661c39e9dc350afec5050a8"
        checksum-type="md5" size="5269302"
        path="src/TeXmacs-1.0.7.3-src.tar.gz"/>
      <patch checksum="8638d2908e9e433f54c3cc25a8cc3ea9"
        checksum-type="md5" size="26647"
        path="src/TeXmacs-1.0.7.3-src.tww.patch"/>
      <patch checksum="f91f58c77d2762e9abb254f8b4d661ac"
        checksum-type="md5" size="1345"
        path="src/TeXmacs-1.0.7.3-src.gmp43.patch"/>
      <patch checksum="48f930b77c90c7da85ae17e285043a0f"
        checksum-type="md5" size="539825"
        path="src/TeXmacs-1.0.7.3-src.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="grep" install-name="grep29"
        add-path="prepend">v&gt;=2.9</depend>
      <depend program="guile" install-name="guile18"
        add-path="prepend">v&gt;=1.8.6</depend>
      <depend program="tetex" install-name="tetex30"
        add-path="prepend">v&gt;=3.0</depend>
      <depend program="transfig" install-name="transfig32"
        add-path="prepend">v&gt;=3.2.5</depend>
      <depend program="freetype" install-name="libttf24"
        add-path="prepend">v&gt;=2.4.6</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv113">v&gt;=1.13.1</depend>
      <depend program="gcc" install-name="gcc44"
        add-path="prepend">v&gt;=4.4.6</depend>
      <depend var="GCC_RT" install-name="gcc44r"/>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${INSTALL_PREFIX}/share"
_docdir="${INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc -pthread"
  CXXFLAGS="-O2 -mcpu=powerpc -pthread"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib -pthread"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC_LD_RT="-Wl,+b,"

  ARGS="--disable-fastalloc" ;;
*-hpux*)
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--disable-fastalloc" ;;
i?86*-linux*|i?86-suse-linuxe1?)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-irix*)
  CFLAGS="-O2 -pthread"
  CXXFLAGS="-O2 -pthread"
  LDFLAGS="-pthread"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--disable-fastalloc" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CXXFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-Wl,-R" ;;
*-solaris2.6)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis -D_XOPEN_SOURCE_EXTENDED=1"
  CXXFLAGS="-O2 -mcpu=ultrasparc -mvis -D_XOPEN_SOURCE_EXTENDED=1"
  CC_LD_RT="-Wl,-R" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CXXFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-Wl,-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="${CC_LD_RT}${SB_VAR_GCC_RT+${SB_VAR_GCC_RT_LIB}}\
${SB_VAR_LIBICONV+:${SB_VAR_LIBICONV_LIB}} \
${LDFLAGS+${LDFLAGS}}" --enable-optimize="${CXXFLAGS:--O2}" \
${SB_VAR_LIBICONV+--with-iconv=${SB_VAR_LIBICONV}} \
--with-freetype=linked ${ARGS+${ARGS}} --datadir=${_datadir} \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!grep -F!ggrep -F!" plugins/maxima/bin/maxima_detect

# guile-config on HP-UX ends up putting -mt into the makefile so
# replace it with -pthread.
${SB_PATH_SED} -i -e 's|-mt\b|-pthread|g' src/makefile
]]>
    </configure>

    <notes>
      <change from="1.0.6" to="1.0.7">
        <item><para>Several improvements in the graphics
mode.</para></item>
        <item><para>Several (yet undocumented) improvements for making
presentations.</para></item>
        <item><para>Added developer documentation for the Scheme API
and a clean Scheme mode with colour highlighting.</para></item>
        <item><para>An integrated linking tool based on the former
Proclus plug-in.</para></item>
        <item><para>Support for CJK.</para></item>
        <item><para>Another major change in 1.0.7 is the existence of
an experimental Qt port.</para>
        <para>In order to try it, you have to compile TeXmacs by
hand using</para>
        <screen>
./configure --enable-qt
make
make install
        </screen>
        <para>Any feedback and help for debugging the new port is
welcome.</para>
        <para>For the next stable release, we intend to migrate
to Qt.</para></item>
      </change>

      <change from="1.0.5" to="1.0.6">
        <item><para>Improved LaTeX and Html converters and support for
MathML.</para></item>
        <item><para>Alpha-version of a graphical mode for drawing
technical pictures.</para></item>
        <item><para>Default use of Type 1 fonts.</para></item>
        <item><para>New plug-ins for Maple and
Mathematica.</para></item>
        <item><para>Simple animations.</para></item>
        <item><para>Faster booting.</para></item>
        <item><para>Started documentation of the Scheme
API.</para></item>
      </change>

      <note type="usage">
        <para>The R plugin is only available on Redhat Linux. The code
for the plugin is Linux-specific.</para>
      </note>
    </notes>

    <changelog>
      <change date="2012 January 30" revision="4"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Update bison dependency from 2.3 to
2.4.3</para></item>
        <item><para>Update grep dependency from 2.5.3 to
2.9</para></item>
        <item><para>Update freetype dependency from 2.3.7 to
2.4.6</para></item>
        <item><para>Update libiconv dependency from 1.12 to
1.13.1</para></item>
        <item><para>Update gcc dependency from 4.2.4 to
4.4.6</para></item>
      </change>
    </changelog>
  </program>
</programs>
