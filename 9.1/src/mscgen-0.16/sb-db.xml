<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="mscgen" version="0.16" revision="2">
    <build-name>${SB_PROG_NAME}</build-name>

    <install-name>${SB_PROG_NAME}016</install-name>

    <sources>
      <source checksum="fc10b9917db4b252209ae88e4608dcd3"
        checksum-type="md5" size="620832"
        path="src/mscgen-src-0.16.tar.gz"/>
      <patch checksum="e6522dbc64a9300569569f041cf17cd9"
        checksum-type="md5" size="166054"
        path="src/mscgen.tww.patch"/>
      <patch checksum="b9554a185b0cde58ac5b9b6e80015a47"
        checksum-type="md5" size="94586"
        path="src/mscgen.gnulib.patch"/>
      <patch checksum="a5217c73cbb6e77d36a716dc3591c30b"
        checksum-type="md5" size="524483"
        path="src/mscgen.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="flex" install-name="flex25" add-path="prepend"
        type="build">v&gt;=2.5.35</depend>
      <depend program="gd" var="LIBGD"
        install-name="libgd20">v&gt;=2.0.35</depend>
    </dependencies>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-Ae -z +O2 +Ofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBGD_INC}" \
LDFLAGS="${SB_VAR_GCC_RT+-L${SB_VAR_GCC_RT_LIB} \
${CC_LD_RT}${SB_VAR_GCC_RT_LIB}} -L${SB_VAR_LIBGD_LIB} \
${CC_LD_RT}${SB_VAR_LIBGD_LIB} ${LDFLAGS+${LDFLAGS}}" \
--disable-dependency-tracking --mandir="${SB_INSTALL_PREFIX}/man" \
--prefix=${SB_INSTALL_PREFIX}

# Change DOS line endings as SunCC complains about them
${SB_PATH_FIND} . -name '*.c' -exec ${SB_PATH_SED} -i 's!\r!!'  '{}' ';'
${SB_PATH_FIND} . -name '*.h' -exec ${SB_PATH_SED} -i 's!\r!!'  '{}' ';'
]]>
    </configure>

    <test>
<![CDATA[
gmake check
]]>
    </test>

    <licenses>
      <license module="parser" path="lgpl-2.1.license"/>

      <license path="gpl-2.license"/>
    </licenses>

    <notes>
      <change from="0.15" to="0.16">
        <item><para>Fix segfault on malformed input, issue
#10</para></item>
        <item><para>Replace flex default rule so that it will not echo
unknown characters. Instead it returns an unknown token to the parser
which then stops and warns about the erroneous input
line.</para></item>
        <item><para>Match \r\n, \r and \n line endings to count input
line numbers</para></item>
        <item><para>Fix error in GPL address for
utf8.c/h</para></item>
        <item><para>Fix for spaces (|||) and dividers (---) on
lineswhich have "," at the end causing an assert to fail</para></item>
        <item><para>Add FreeType support under USE_FREETYPE, although
disabled by default</para></item>
        <item><para>Add anti-alising to some lines</para></item>
        <item><para>Increase row heights when text is more than 2
lines long and size boxes accordingly</para></item>
      </change>

      <change from="0.14" to="0.15">
        <item><para>Escape special characters for SVG
output</para></item>
        <item><para>Better UTF8 support in SVG and PS
output</para></item>
        <item><para>Add Wall Wextra and fixup warnings</para></item>
        <item><para>Add ability to place multiple boxes on the same
line using "," instead of ";"</para></item>
        <item><para>Clean up Makefiles a little and add install
target</para></item>
      </change>

      <change from="0.13" to="0.14">
        <item><para>Added state description boxes into the entity
lines</para></item>
        <item><para>Use command "&lt;entity&gt; box &lt;entity&gt;
[label="..."];" for state boxes. "abox" and "rbox" also work for
rounded and angular boxes.</para></item>
        <item><para>Fix arc drawing for SVG which was un-noticably
mirrored</para></item>
        <item><para>Add all-freebsd target</para></item>
      </change>

      <change from="0.12" to="0.13">
        <item><para>Fix colour output for postscript</para></item>
        <item><para>Fix scaling for Postscript bounding box; now
matches image scaling</para></item>
        <item><para>Parse empty double-quoted strings (e.g. label="")
and allow double quotes in strings if escaped (e.g.
label="hello\"there")</para></item>
        <item><para>Add some info about building on
Solaris</para></item>
      </change>

      <change from="0.11" to="0.12">
        <item><para>Add REMOVE_PNG_OUPUT to allow building without PNG
support as a workaround for a packaging problem with gd-devel on
Fedora 8</para></item>
        <item><para>Add support for textcolour and linecolour
attributes on arcs and entites.  Add support for double lined
arcs.</para></item>
        <item><para>Add support for arctextcolour and arclinecolour
attributes on entity definitions to allow default colours to be set on
arcs originating from some entity</para></item>
        <item><para>Change ADraw colour model to RGB.  Allow colours
to be specified as #rrggbb values, or the 16 W3C HTML
names</para></item>
        <item><para>Simplify running of tests under Valgrind (e.g.
VALGRIND="valgrind -tool=memcheck" make test)</para></item>
        <item><para>Linux builds use pkg-config to get gd dependencies
and no longer static-link by default</para></item>
        <item><para>Add more string replacements to make parse error
reporting relate to input and not internal parser token
names</para></item>
        <item><para>Add 'width' global option to allow explicit
setting of output chart width, rather than using a scale factor with
hscale</para></item>
        <item><para>Rename parser.a to libparser.a</para></item>
        <item><para>Move CHANGES file up a directory</para></item>
        <item><para>Add arcgradient option to allow arrows to slope,
making direction of the message to be more clearly
observed</para></item>
      </change>
    </notes>

    <changelog>
      <change date="2012 January 31" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Update bison dependency from 2.3 to
2.4.3</para></item>
      </change>
    </changelog>
  </program>
</programs>
