<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="cdrdao" version="1.2.2" revision="2"
  systype="*-linux*">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}12</install-name>

    <sources>
      <source checksum="f0cbf36907406cb4f4c568f9e6669a34"
        checksum-type="md5" size="1408344"
        path="src/cdrdao-1.2.2.tar.bz2"/>
      <patch checksum="36f0067d3791032acaffa0a237d76d3e"
        checksum-type="md5" size="3571"
        path="src/cdrdao-1.2.2.tww.patch"/>
      <patch checksum="5f72d586dd746daf5f53580e8bc5ead2"
        checksum-type="md5" size="782373"
        path="src/cdrdao-1.2.2.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="cdrtools" var="CDRTOOLS"
        install-name="cdrtools20">v&gt;=2.01</depend>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_sysconfdir="${SB_INSTALL_PREFIX}/etc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
--without-ogg-support --without-mp3-support --without-lame \
--without-xdao --with-scglib=sys \
--with-scglib-inc=${SB_VAR_CDRTOOLS_INC} \
--with-scglib-lib=${SB_VAR_CDRTOOLS_LIB} \
--datadir=${_datadir} --mandir="${SB_INSTALL_PREFIX}/man" \
--disable-dependency-tracking --prefix=${SB_INSTALL_PREFIX}

# fix config file paths
${SB_PATH_SED} -i -e "\
s!/etc/cdrdao.conf!${_sysconfdir}/cdrdao.conf!; \
s!/etc/defaults/cdrdao!${_sysconfdir}/defaults/cdrdao!;" \
dao/main.cc dao/cdrdao.man
]]>
    </configure>

    <install>
<![CDATA[
gmake install

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_sysconfdir}
${SB_PATH_INSTALL} -m 644 -o root -g 0 /dev/null \
${_sysconfdir}/cdrdao.conf
]]>
    </install>

    <licenses>
      <license path="gpl-2.license"/>
    </licenses>

    <notes>
      <change from="1.2.1" to="1.2.2">
        <item><para>Added device locking for win32</para></item>
        <item><para>Man page cleanup</para></item>
        <items name="GCDMaster changes">
          <item><para> Fixed GCC 4.1 compilation issues</para></item>
          <item><para> Fixed hang when inserting WAV file</para></item>
        </items>
      </change>

      <change from="1.2.0" to="1.2.1">
        <item><para>Fixed bad bug with missing return statemements in
recomputeLength and format conversion.</para></item>
        <item><para>Fixed broken '-' STDIN input
feature.</para></item>
        <item><para>Fixed various gcc4-related compile
problems.</para></item>
        <item><para>Fixed copy problem with single device when
read_device is specified.</para></item>
        <item><para>Added autodetect of cdrtools header files in
configure</para></item>
        <item><para>Minor fixes to driver table.</para></item>
        <item><para>pccts build is now better integrated with
automake/autoconf.</para></item>
        <item><para>Added FreeBSD 7 support to configure.ac. Fixed
libao dependency.</para></item>
        <items name="GCDMaster changes">
          <item><para>The crash when creating a new "Create Audio CD"
view seemed to be related to gtkmm and libsigc++ and went away with
newer releases of those packages.</para></item>
        </items>

        <items name="toc2cue changes">
          <item><para>toc2cue: fixed bug that was causing empty output
files.</para></item>
          <item><para>Added conversion of COPY to DCP
flags.</para></item>
        </items>
      </change>
    </notes>

    <changelog>
      <change date="2010 November 4" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>
    </changelog>
  </program>
</programs>
