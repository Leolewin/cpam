<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="babl" version="0.1.0" revision="2">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>lib${SB_PROG_NAME}01</install-name>

    <sources>
      <source checksum="197133d84fe120ee66c8137dff1696e6"
        checksum-type="md5" size="406488"
        path="src/babl-0.1.0.tar.bz2"/>
      <patch checksum="421c6ae8ac3b6a1e0b8abfa4ce4cc394"
        checksum-type="md5" size="3738"
        path="src/babl-0.1.0.gnulib-prep.patch"/>
      <patch checksum="5b732a81b6649bb872eda1e96b7aaa60"
        checksum-type="md5" size="6149"
        path="src/babl-0.1.0.tww.patch"/>
      <patch checksum="fd731f030d7334fc6b45cddf9ef6ab34"
        checksum-type="md5" size="100660"
        path="src/babl-0.1.0.gnulib.patch"/>
      <patch checksum="70c2cda8db4e8971f7f561ba8bb736a3"
        checksum-type="md5" size="1690424"
        path="src/babl-0.1.0.auto.patch"/>
    </sources>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="+O2 -z +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux10*|*-hpux11.[01]*)
  CC=cc CFLAGS="-Ae +O2 -z +Ofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -z +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath,"

  # avoid 'c99 only' warnings
  export ac_cv_header_stdint_h=no ;;
i?86*-linuxe3)
  CFLAGS="-O2 -mcpu=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*|i?86-suse-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.[678])
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

# The use pattern of inline by babl always results in undefined
# symbols unless using gcc.
#case "${CC:-gcc}" in
#  gcc) ;;
#  *) CPPFLAGS="${CPPFLAGS+${CPPFLAGS}} -Dinline=" ;;
#esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
${CPPFLAGS+CPPFLAGS="${CPPFLAGS}"} \
LDFLAGS="${SB_VAR_GCC_RT+${CC_LD_RT}${SB_VAR_GCC_RT_LIB}}\
 ${LDFLAGS+${LDFLAGS}}" \
--disable-dependency-tracking --datadir=${_datadir} \
--datarootdir=${_datadir} --docdir=${_docdir} \
--libdir=${SB_INSTALL_PREFIX_LIB} --prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" babl.pc
]]>
    </configure>

    <test>
<![CDATA[
gmake check || :
]]>
    </test>

    <changelog>
      <change date="2010 November 2" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>
    </changelog>
  </program>
</programs>
