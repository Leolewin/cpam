<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="cups" version="1.4.8" revision="2">
    <install-name>${SB_PROG_NAME}148</install-name>

    <sources>
      <source checksum="0ec52d3f3c69bc2ab5ed70c594edbce6"
        checksum-type="md5" size="4547162"
        path="src/cups-1.4.8-source.tar.bz2"/>
      <patch checksum="bee0b367daa372c8c4c4683c31989a5c"
        checksum-type="md5" size="139636"
        path="src/cups-1.4.8.tww.patch"/>
      <patch checksum="fda996510d7637796d580c21c5469b11"
        checksum-type="md5" size="1754823"
        path="src/cups-1.4.8.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="dbus" var="DBUS"
        install-name="dbus12">v==1.2.26</depend>
      <depend program="gnutls" var="LIBGNUTLS"
        install-name="libgnutls210">v&gt;=2.10.5</depend>
      <depend program="jpeg" var="JPEG"
        install-name="libjpeg8">v&gt;=8b</depend>
      <depend program="libgcrypt" var="LIBGCRYPT"
        install-name="libgcrypt14">v&gt;=1.4.6</depend>
      <depend program="libgpg-error" var="LIBGPG_ERROR"
        install-name="libgpgerror110">v&gt;=1.10</depend>
      <depend program="libpng" var="LIBPNG"
        install-name="libpng14">v&gt;=1.4.4</depend>
      <depend program="libtasn1" var="LIBTASN"
        install-name="libtasn29">v&gt;=2.9</depend>
      <depend program="perl" var="PERL" add-path="prepend"
        type="build">v==5.12.2</depend>
      <depend program="python" var="PYTHON"
        add-path="prepend">v==2.6.7</depend>
      <depend program="pkgconfig" install-name="pkgconfig02"
        add-path="prepend" type="build">v&gt;=0.25</depend>
      <depend program="tiff" var="LIBTIFF"
        install-name="libtiff39">v&gt;=3.9.5</depend>
      <depend program="zlib" var="LIBZ"
        install-name="libz12">v&gt;=1.2.5</depend>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_localstatedir="/var${SB_INSTALL_PREFIX}"
_sysconfdir="/etc${SB_INSTALL_PREFIX}"
]]>
    </script-header>

    <module name="default">
      <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

      <dependencies replace="0">
        <depend user="cups"/>

        <depend group="cups"/>

      </dependencies>

      <validate>
        <depend program="cups" module="runtime">v==1.4.8</depend>
        <depend program="cups" module="runtime-64bit"
          systype="*-aix*|*-hpux*|*-irix*|*-solaris*">v==1.4.8</depend>
        <depend program="ghostscript"
          module="cups-1.4.8">v==9.01</depend>
        <depend program="gimp-print"
          module="cups-1.4.8">v==4.2.7</depend>
      </validate>

      <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_localstatedir="/var${SB_INSTALL_PREFIX}"
_sysconfdir="/etc${SB_INSTALL_PREFIX}"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CXX=xlC CXXFLAGS="-O2 -qro -qroconst -qnotempinc \
-qnotemplateregistry  -qmaxmem=-1 -qarch=ppc"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"

  ARGS="--enable-pam" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b,"

  ARGS="--enable-pam" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--enable-pam --disable-ipv6" ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--enable-pam" ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--disable-pam" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -std1 -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -arch ev5 -model ansi -msym \
-readonly_strings -timplicit_local"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CXX=CC CXXFLAGS="-xO2 -xtarget=pentium4"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -xarch=v8plusa"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -m32 -xarch=sparcvis"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_JPEG_INC} -I${SB_VAR_LIBZ_INC} \
-I${SB_VAR_LIBPNG_INC} -I${SB_VAR_LIBTIFF_INC}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="-L${SB_VAR_JPEG_LIB} -L${SB_VAR_LIBZ_LIB} \
-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBTIFF_LIB} \
${CC_LD_RT}${SB_VAR_JPEG_LIB}:${SB_VAR_LIBZ_LIB}:\
${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBTIFF_LIB}:\
${SB_INSTALL_PREFIX}/lib${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT}/lib} \
${LDFLAGS+${LDFLAGS}}" DSOFLAGS="-L${SB_VAR_JPEG_LIB} \
-L${SB_VAR_LIBZ_LIB} -L${SB_VAR_LIBPNG_LIB} \
-L${SB_VAR_LIBTIFF_LIB} ${CC_LD_RT}${SB_VAR_JPEG_LIB}:\
${SB_VAR_LIBZ_LIB}:${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBTIFF_LIB}\
${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT}/lib} ${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="${SB_VAR_LIBGNUTLS_LIB}/pkgconfig:\
${SB_VAR_LIBGCRYPT_LIB}/pkgconfig:${SB_VAR_LIBTASN_LIB}/pkgconfig:\
${SB_VAR_LIBGPG_ERROR_LIB}/pkgconfig:\
${SB_VAR_DBUS_LIB}/pkgconfig" \
--enable-slp --enable-ssl --disable-cdsassl --enable-gnutls \
--disable-openssl --disable-ldap --with-cups-user=cups \
--with-cups-group=cups --enable-libtool-unsupported \
--disable-gssapi --disable-threads --datadir=${_datadir} \
--with-cachedir="${_localstatedir}/cache" \
--with-docdir=${_docdir} --with-fontpath="${_datadir}/fonts" \
--with-logdir="${_localstatedir}/log" \
--localstatedir=${_localstatedir} --sysconfdir=${_sysconfdir} \
--mandir="${SB_INSTALL_PREFIX}/man" ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}

# fix library search paths
${SB_PATH_SED} -i -e "\
s!^IMGLIBS=\"!IMGLIBS=\"-L${SB_VAR_LIBTIFF_LIB} -L${SB_VAR_JPEG_LIB} \
-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBZ_LIB} \
${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}:${SB_VAR_JPEG_LIB}:\
${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBZ_LIB} !;" cups-config

# Fix paths in man pages
${SB_PATH_SED} -i -e "\
s!/etc/cups!${_sysconfdir}!g" man/cups-lpd.man \
man/subscriptions.conf.man man/cups-snmp.conf.man \
man/classes.conf.man man/cupsaddsmb.man man/printers.conf.man

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" cups.pc cupsimage.pc cups-config
]]>
      </configure>

      <build>
<![CDATA[
gmake && {
  # add tiff runtime path
  ${SB_PATH_EGREP} -e -R${SB_VAR_LIBTIFF_LIB} \
  filter/libcupsimage.la >/dev/null || {
    ${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF_LIB} !;" \
  filter/libcupsimage.la
  }
}
]]>
      </build>

      <test>
<![CDATA[
gmake -C scheduler unittests
(cd scheduler && ./testmime)
]]>
      </test>

      <install>
<![CDATA[
gmake install

${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF_LIB} !;" \
${SB_INSTALL_PREFIX}/lib/libcupsimage.la

${SB_PATH_INSTALL} -m 600 -o root -g cups /dev/null \
${_sysconfdir}/classes.conf
${SB_PATH_INSTALL} -m 644 -o root -g 0 /dev/null \
${_sysconfdir}/client.conf
${SB_PATH_INSTALL} -m 644 -o root -g 0 /dev/null \
${_sysconfdir}/lpoptions
${SB_PATH_INSTALL} -m 600 -o cups -g cups /dev/null \
${_sysconfdir}/passwd.md5
${SB_PATH_INSTALL} -m 644 -o root -g 0 /dev/null \
${_sysconfdir}/printcap
${SB_PATH_INSTALL} -m 600 -o root -g cups /dev/null \
${_sysconfdir}/printers.conf
]]>
      </install>

      <uninstall>
        <remove-db-entry program="ghostscript"
          module="cups-1.4.8">v==9.01</remove-db-entry>
        <remove-db-entry program="gimp-print"
          module="cups-1.4.8">v==4.2.7</remove-db-entry>
      </uninstall>
    </module>

    <module name="runtime-64bit"
    systype="*-aix*|*-hpux*|*-irix*|*-solaris*">
      <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

      <install-name>${SB_PROG_NAME}148r</install-name>

      <dependencies>
        <depend program="cups" var="CUPS">v==1.4.8</depend>
        <depend program="dbus" var="DBUS" install-name="dbus12"
          module="64bit">v==1.2.26</depend>
        <depend program="gnutls" var="LIBGNUTLS"
          install-name="libgnutls210"
          module="64bit">v&gt;=2.10.5</depend>
        <depend program="jpeg" var="JPEG" install-name="libjpeg8"
          module="64bit">v&gt;=8b</depend>
        <depend program="libgcrypt" var="LIBGCRYPT"
          install-name="libgcrypt14"
          module="64bit">v&gt;=1.4.6</depend>
        <depend program="libgpg-error" var="LIBGPG_ERROR"
          install-name="libgpgerror110"
          module="64bit">v&gt;=1.10</depend>
        <depend program="libpng" var="LIBPNG" install-name="libpng14"
          module="64bit">v&gt;=1.4.4</depend>
        <depend program="libtasn1" var="LIBTASN"
          install-name="libtasn29" module="64bit">v&gt;=2.9</depend>
        <depend program="perl" var="PERL" add-path="prepend"
          type="build">v==5.12.2</depend>
        <depend program="python" var="PYTHON"
          add-path="prepend">v==2.6.7</depend>
        <depend program="pkgconfig" install-name="pkgconfig02"
          add-path="prepend" type="build">v&gt;=0.25</depend>
        <depend program="tiff" var="LIBTIFF" install-name="libtiff39"
          module="64bit">v&gt;=3.9.5</depend>
        <depend program="zlib" var="LIBZ" install-name="libz12"
          module="64bit">v&gt;=1.2.5</depend>
      </dependencies>

      <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  _bindir="bin/ppc64"
  _libdir="lib/ppc64" ;;
ia64*-hpux*)
  _bindir="bin/hpux64"
  _libdir="lib/hpux64" ;;
*-hpux*)
  _bindir="bin/pa20_64"
  _libdir="lib/pa20_64" ;;
*-irix*)
  _bindir="bin/mips4"
  _libdir=lib64 ;;
i?86*-solaris*)
  _bindir="bin/amd64"
  _libdir="lib/amd64" ;;
*-solaris*)
  _bindir="bin/sparcv9"
  _libdir="lib/sparcv9" ;;
esac

case "${SB_SYSTYPE}" in
*-aix*)
  export OBJECT_MODE=64 ;;
esac

_datadir="${SB_VAR_CUPS}/share"
_docdir="${SB_VAR_CUPS}/doc"
_localstatedir="/var${SB_VAR_CUPS}"
_sysconfdir="/etc${SB_VAR_CUPS}"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -q64 -qro -qroconst -qmaxmem=-1"
  CXX=xlC CXXFLAGS="-O2 -q64 -qro -qroconst -qnotempinc \
-qnotemplateregistry -qmaxmem=-1"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"

  ARGS="--enable-pam" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b,"

  ARGS="--enable-pam" ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -Ae -z +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  case "${SB_SYSTYPE}" in
  *-hpux11.31)
    ARGS="--build=hppa64-hp-hpux11.31" ;;
  *-hpux11.23)
    ARGS="--build=hppa64-hp-hpux11.23" ;;
  *-hpux11.11)
    ARGS="--build=hppa64-hp-hpux11.11 --disable-ipv6" ;;
  *-hpux11.00)
    ARGS="--build=hppa64-hp-hpux11.00 --disable-ipv6" ;;
  esac

  ARGS="${ARGS} --enable-pam" ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-64 -mips4 -O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-64 -mips4 -O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--disable-pam" ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -m64 \
-xarch=sse2"
  CXX=CC CXXFLAGS="-xO2 -xtarget=opteron -m64 -xarch=sse2"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic \
-xarch=v9"
  CXX=CC CXXFLAGS="-xO2 -xtarget=generic -xarch=v9"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic \
-m64 -xarch=v9"
  CXX=CC CXXFLAGS="-xO2 -xtarget=generic -m64 -xarch=v9"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_JPEG_INC} -I${SB_VAR_LIBZ_INC} \
-I${SB_VAR_LIBPNG_INC} -I${SB_VAR_LIBTIFF_INC}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="-L${SB_VAR_JPEG}/${_libdir} -L${SB_VAR_LIBZ}/${_libdir} \
-L${SB_VAR_LIBPNG}/${_libdir} -L${SB_VAR_LIBTIFF}/${_libdir} \
${CC_LD_RT}${SB_VAR_JPEG}/${_libdir}:${SB_VAR_LIBZ}/${_libdir}:\
${SB_VAR_LIBPNG}/${_libdir}:${SB_VAR_LIBTIFF}/${_libdir}:\
${SB_INSTALL_PREFIX}/${_libdir} ${LDFLAGS+${LDFLAGS}}" \
DSOFLAGS="-L${SB_VAR_JPEG}/${_libdir} -L${SB_VAR_LIBZ}/${_libdir} \
-L${SB_VAR_LIBPNG}/${_libdir} -L${SB_VAR_LIBTIFF}/${_libdir} \
${CC_LD_RT}${SB_VAR_JPEG}/${_libdir}:${SB_VAR_LIBZ}/${_libdir}:\
${SB_VAR_LIBPNG}/${_libdir}:${SB_VAR_LIBTIFF}/${_libdir} \
${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="${SB_VAR_LIBGNUTLS}/${_libdir}/pkgconfig:\
${SB_VAR_LIBGCRYPT}/${_libdir}/pkgconfig:\
${SB_VAR_LIBTASN}/${_libdir}/pkgconfig:\
${SB_VAR_LIBGPG_ERROR}/${_libdir}/pkgconfig:\
${SB_VAR_DBUS}/${_libdir}/pkgconfig" \
--enable-slp --enable-ssl --disable-cdsassl --enable-gnutls \
--disable-openssl --disable-ldap --with-cups-user=cups \
--with-cups-group=cups --enable-libtool-unsupported \
--disable-gssapi --disable-threads --datadir=${_datadir} \
--with-cachedir="${_localstatedir}/cache" \
--with-docdir=${_docdir} --with-fontpath="${_datadir}/fonts" \
--with-logdir="${_localstatedir}/log" \
--localstatedir=${_localstatedir} --sysconfdir=${_sysconfdir} \
--bindir="${SB_VAR_CUPS}/bin" --sbindir="${SB_VAR_CUPS}/sbin" \
${ARGS+${ARGS}} --libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
--mandir="${SB_INSTALL_PREFIX}/man" \
--prefix=${SB_INSTALL_PREFIX}

# fix library search paths
${SB_PATH_SED} -i -e "\
s!^IMGLIBS=\"!IMGLIBS=\"-L${SB_VAR_LIBTIFF_LIB} -L${SB_VAR_JPEG_LIB} \
-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBZ_LIB} \
${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}:${SB_VAR_JPEG_LIB}:\
${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBZ_LIB} !;" cups-config

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" cups.pc cupsimage.pc
]]>
      </configure>

      <build>
<![CDATA[
gmake && {
  # add tiff runtime path
  ${SB_PATH_EGREP} -e "-R${SB_VAR_LIBTIFF}/${_libdir}" \
  filter/libcupsimage.la >/dev/null || {
    ${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF}/${_libdir} !;" \
  filter/libcupsimage.la
  }
}
]]>
      </build>

      <install>
<![CDATA[
gmake install-pkgconfig
gmake -C cups install-libs
gmake -C filter install-libs

${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF}/${_libdir} !;" \
${SB_INSTALL_PREFIX}/${_libdir}/libcupsimage.la

# install modified cups-config
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX}/${_bindir}
${SB_PATH_SED} -e "\
s!^includedir=.*!includedir=${SB_INSTALL_PREFIX}/include!; \
s!^libdir=.*!libdir=${SB_INSTALL_PREFIX}/${_libdir}!" \
${SB_VAR_CUPS}/bin/cups-config >${SB_INSTALL_PREFIX}/${_bindir}/cups-config
${SB_PATH_CHMOD} 755 ${SB_INSTALL_PREFIX}/${_bindir}/cups-config
${SB_PATH_CHOWN} 0:0 ${SB_INSTALL_PREFIX}/${_bindir}/cups-config
]]>
      </install>
    </module>

    <module name="runtime">
      <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

      <install-name>${SB_PROG_NAME}148r</install-name>

      <dependencies replace="0">
        <depend program="cups" var="CUPS">v==1.4.8</depend>
      </dependencies>

      <script-header>
<![CDATA[
_datadir="${SB_VAR_CUPS}/share"
_docdir="${SB_VAR_CUPS}/doc"
_localstatedir="/var${SB_VAR_CUPS}"
_sysconfdir="/etc${SB_VAR_CUPS}"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CXX=xlC CXXFLAGS="-O2 -qro -qroconst -qnotempinc \
-qnotemplateregistry -qmaxmem=-1 -qarch=ppc"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"

  ARGS="--enable-pam" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b,"

  ARGS="--enable-pam" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="+O2 -Ae -z +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--enable-pam --disable-ipv6" ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -Ae -z +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="+O2 -AA -z +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--enable-pam" ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--disable-pam" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -std1 -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -model ansi -msym -readonly_strings \
-timplicit_local"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CXX=CC CXXFLAGS="-xO2 -xtarget=pentium4"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -xarch=v8plusa"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -m32 -xarch=sparcvis"
  CC_LD_RT="-R"

  ARGS="--enable-pam" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_JPEG_INC} -I${SB_VAR_LIBZ_INC} \
-I${SB_VAR_LIBPNG_INC} -I${SB_VAR_LIBTIFF_INC}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="-L${SB_VAR_JPEG_LIB} -L${SB_VAR_LIBZ_LIB} \
-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBTIFF_LIB} \
${CC_LD_RT}${SB_VAR_JPEG_LIB}:${SB_VAR_LIBZ_LIB}:\
${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBTIFF_LIB}:\
${SB_INSTALL_PREFIX}/lib${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT}/lib} \
${LDFLAGS+${LDFLAGS}}" DSOFLAGS="-L${SB_VAR_JPEG_LIB} \
-L${SB_VAR_LIBZ_LIB} -L${SB_VAR_LIBPNG_LIB} \
-L${SB_VAR_LIBTIFF_LIB} ${CC_LD_RT}${SB_VAR_JPEG_LIB}:\
${SB_VAR_LIBZ_LIB}:${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBTIFF_LIB}\
${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT}/lib} ${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="${SB_VAR_LIBGNUTLS_LIB}/pkgconfig:\
${SB_VAR_LIBGCRYPT_LIB}/pkgconfig:${SB_VAR_LIBTASN_LIB}/pkgconfig:\
${SB_VAR_LIBGPG_ERROR_LIB}/pkgconfig:\
${SB_VAR_DBUS_LIB}/pkgconfig" \
--enable-slp --enable-ssl --disable-cdsassl --enable-gnutls \
--disable-openssl --disable-ldap --with-cups-user=cups \
--with-cups-group=cups --enable-libtool-unsupported \
--disable-gssapi --disable-threads --datadir=${_datadir} \
--with-cachedir="${_localstatedir}/cache" \
--with-docdir=${_docdir} --with-fontpath="${_datadir}/fonts" \
--with-logdir="${_localstatedir}/log" ${ARGS+${ARGS}} \
--localstatedir=${_localstatedir} --bindir="${SB_VAR_CUPS}/bin" \
--mandir=${SB_INSTALL_PREFIX}/man --sbindir="${SB_VAR_CUPS}/sbin" \
--sysconfdir=${_sysconfdir} --prefix=${SB_INSTALL_PREFIX}

# fix library search paths
${SB_PATH_SED} -i -e "\
s!^IMGLIBS=\"!IMGLIBS=\"-L${SB_VAR_LIBTIFF_LIB} -L${SB_VAR_JPEG_LIB} \
-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBZ_LIB} \
${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}:${SB_VAR_JPEG_LIB}:\
${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBZ_LIB} !;" cups-config

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" cups.pc cupsimage.pc
]]>
      </configure>

      <build>
<![CDATA[
gmake && {
  # add tiff runtime path
  ${SB_PATH_EGREP} -e -R${SB_VAR_LIBTIFF_LIB} \
  filter/libcupsimage.la >/dev/null || {
    ${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF_LIB} !;" \
  filter/libcupsimage.la
  }
}
]]>
      </build>

      <install>
<![CDATA[
gmake install-pkgconfig install-headers
gmake -C cups install
gmake -C filter install-libs

${SB_PATH_SED} -i -e "\
s!^dependency_libs=' !dependency_libs=' -R${SB_VAR_LIBTIFF_LIB} !;" \
${SB_INSTALL_PREFIX}/lib/libcupsimage.la

# install modified cups-config
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX}/bin
${SB_PATH_SED} -e "\
s!^includedir=.*!includedir=${SB_INSTALL_PREFIX}/include!; \
s!^libdir=.*!libdir=${SB_INSTALL_PREFIX}/lib!" \
${SB_VAR_CUPS}/bin/cups-config >${SB_INSTALL_PREFIX}/bin/cups-config
${SB_PATH_CHMOD} 755 ${SB_INSTALL_PREFIX}/bin/cups-config
${SB_PATH_CHOWN} 0:0 ${SB_INSTALL_PREFIX}/bin/cups-config
]]>
      </install>
    </module>

    <licenses>
      <license>
        <para align="center">CUPS License Agreement</para>
        <para align="center">Copyright 2007-2009 by Apple Inc.</para>
        <para align="center">1 Infinite Loop</para>
        <para align="center">Cupertino, CA 95014 USA</para>
        <para align="center">WWW: http://www.cups.org/</para>
        <unorderedlist>
          <item><para>INTRODUCTION</para>
          <para>CUPS(tm) is provided under the GNU General Public
License ("GPL") and GNU Library General Public License ("LGPL"),
Version 2, with exceptions for Apple operating systems and the OpenSSL
toolkit. A copy of the exceptions and licenses follow this
introduction.</para>
          <para>The GNU LGPL applies to the CUPS and CUPS Imaging
libraries located in the "cups" and "filter" subdirectories of the
CUPS source distribution and in the "cups" include directory and
library files in the binary distributions. The GNU GPL applies to the
remainder of the CUPS distribution, including the "pdftops" filter
which is based upon Xpdf.</para>
          <para>For those not familiar with the GNU GPL, the license
basically allows you to:</para>
          <unorderedlist>
            <item><para>Use the CUPS software at no charge.</para></item>
            <item><para>Distribute verbatim copies of the software in
source or binary form.</para></item>
            <item><para>Sell verbatim copies of the software for a media
fee, or sell support for the software.</para></item>
          </unorderedlist>
          <para>What this license *does not* allow you to do is make
changes or add features to CUPS and then sell a binary distribution
without source code. You must provide source for any changes or
additions to the software, and all code must be provided under the GPL
or LGPL as appropriate. The only exceptions to this are the portions
of the CUPS software covered by the Apple operating system license
exceptions outlined later in this license agreement.</para>
          <para>The GNU LGPL relaxes the "link-to" restriction,
allowing you to develop applications that use the CUPS and CUPS
Imaging libraries under other licenses and/or conditions as
appropriate for your application, driver, or filter.</para></item>
          <item><para>LICENSE EXCEPTIONS</para>
          <para>In addition, as the copyright holder of CUPS, Apple
Inc. grants the following special exceptions:</para>
          <orderedlist>
            <item><para>Apple Operating System Development License
Exception;</para>
            <orderedlist type="lower-alpha">
              <item><para>Software that is developed by any person or
entity for an Apple Operating System ("Apple OS-Developed Software"),
including but not limited to Apple and third party printer drivers,
filters, and backends for an Apple Operating System, that is linked to
the CUPS imaging library or based on any sample filters or backends
provided with CUPS shall not be considered to be a derivative work or
collective work based on the CUPS program and is exempt from the
mandatory source code release clauses of the GNU GPL. You may
therefore distribute linked combinations of the CUPS imaging library
with Apple OS-Developed Software without releasing the source code of
the Apple OS-Developed Software. You may also use sample filters and
backends provided with CUPS to develop Apple OS-Developed Software
without releasing the source code of the Apple OS-Developed
Software.</para></item>
              <item><para>An Apple Operating System means any
operating system software developed and/or marketed by Apple Computer,
Inc., including but not limited to all existing releases and versions
of Apple's Darwin, Mac OS X, and Mac OS X Server products and all
follow-on releases and future versions thereof.</para></item>
              <item><para>This exception is only available for Apple
OS-Developed Software and does not apply to software that is
distributed for use on other operating systems.</para></item>
              <item><para>All CUPS software that falls under this
license exception have the following text at the top of each source
file:</para>
              <screen>
This file is subject to the Apple OS-Developed
	     Software exception.
              </screen></item>
            </orderedlist></item>
            <item><para>OpenSSL Toolkit License
Exception;</para>
            <orderedlist type="lower-alpha">
              <item><para>Apple Inc. explicitly allows the compilation
and distribution of the CUPS software with the OpenSSL
Toolkit.</para></item>
            </orderedlist></item>
          </orderedlist>
          <para>No developer is required to provide these exceptions
in a derived work.</para></item>
          <item><para>KERBEROS SUPPORT CODE</para>
          <para>The Kerberos support code ("KSC") is copyright
2006 by Jelmer Vernooij and is provided 'as-is', without any express
or implied warranty.  In no event will the author or Apple Inc. be
held liable for any damages arising from the use of the KSC.</para>
          <para>Sources files containing KSC have the following
text at the top of each source file:</para>
          <screen>
This file contains Kerberos support code, copyright 2006 by
     Jelmer Vernooij.
          </screen>
          <para>The KSC copyright and license apply only to
Kerberos-related feature code in CUPS.  Such code is typically
conditionally compiled based on the present of the HAVE_GSSAPI
preprocessor definition.</para>
          <para>Permission is granted to anyone to use the KSC for
any purpose, including commercial applications, and to alter it and
redistribute it freely, subject to the following restrictions:</para>
          <orderedlist>
            <item><para>The origin of the KSC must not be
misrepresented; you must not claim that you wrote the original
software. If you use the KSC in a product, an acknowledgment in the
product documentation would be appreciated but is not
required.</para></item>
            <item><para>Altered source versions must be plainly marked
as such, and must not be misrepresented as being the original
software.</para></item>
            <item><para>This notice may not be removed or altered from
any source distribution. </para></item>
          </orderedlist></item>
          <item><para>TRADEMARKS</para>
          <para>CUPS and the CUPS logo (the "CUPS Marks") are
trademarks of Apple Inc. Apple grants you a non-exclusive and
non-transferable right to use the CUPS Marks in any direct port or
binary distribution incorporating CUPS software and in any promotional
material therefor.  You agree that your products will meet the highest
levels of quality and integrity for similar goods, not be unlawful,
and be developed, manufactured, and distributed in compliance with
this license.  You will not interfere with Apple's rights in the CUPS
Marks, and all use of the CUPS Marks shall inure to the benefit of
Apple.  This license does not apply to use of the CUPS Marks in a
derivative products, which requires prior written permission from
Apple Inc.</para></item>
        </unorderedlist>
      </license>

      <license path="gpl-2.license"/>
    </licenses>

    <notes>
      <change from="1.4.5" to="1.4.6">
        <item><para>Fixed a "make check" issue on Solaris (STR
#3729)</para></item>
        <item><para>Regression: The pstops filter did not support
landscape printing of PostScript files (STR #3722)</para></item>
        <item><para>The scheduler killed retried (fax) jobs after
restarting them (STR #3697)</para></item>
        <item><para>The cupsAdminSetServerSettings() function disabled
sharing when debug logging was enabled (STR #3712)</para></item>
      </change>

      <change from="1.4.4" to="1.4.5">
        <item><para>Documentation fixes (STR #3542, STR
#3650)</para></item>
        <item><para>Localization fixes (STR #3635, STR #3636, STR
#3647, STR #3666)</para></item>
        <item><para>Security: Fixed a memory corruption bug reported
in CVE-2010-2941 (STR #3648)</para></item>
        <item><para>The CUPS API incorrectly mapped the
HTTP_UNAUTHORIZED status to the IPP_NOT_AUTHORIZED status code, when
IPP_NOT_AUTHENTICATED would be the correct mapping (STR
#3684)</para></item>
        <item><para>The scheduler would restart jobs while shutting
down (STR #3679)</para></item>
        <item><para>Fixed a PPD loader bug that could cause a crash in
cupsd (STR #3680)</para></item>
        <item><para>Improved the mapping of non-standard PPD and PWG
names (STR #3671)</para></item>
        <item><para>The scheduler did not initialize Kerberos in all
cases (STR #3662)</para></item>
        <item><para>cupsAdminSetServerSettings duplicated Listen and
Order lines (STR #3645)</para></item>
        <item><para>Added DeviceN colorspace support to the CUPS
Raster format (STR #3419)</para></item>
        <item><para>ppdMarkDefaults() did not clear the marked field
of the previous choices (STR #3642)</para></item>
        <item><para>The serial backend would not allow a raw job to be
canceled (STR #3649)</para></item>
        <item><para>The socket backend could go into an infinite loop
with certain printers (STR #3622)</para></item>
        <item><para>Setting the PRINTER or LPDEST environment
variables to "name/instance" did not work (STR #3485)</para></item>
        <item><para>The scheduler did not handle the JobRetryLimit
setting properly (STR #3466)</para></item>
        <item><para>The lpstat command always showed a remote job ID
of 0 for shared printers (STR #3627)</para></item>
        <item><para>Increased the write timeout for the libusb-based
USB backend to 5 minutes (STR #3595)</para></item>
        <item><para>The libusb-base USB backend did not check whether
the printer has a serial number (STR #3590)</para></item>
        <item><para>The lpadmin command did not support setting of
custom option values (STR #3631)</para></item>
        <item><para>The lpadmin command did not support setting of the
location or description of a class (STR #3613)</para></item>
        <item><para>The cupsaddsmb command did not give up after too
many failed attempts (STR #3615)</para></item>
        <item><para>The CUPS library no longer uses certain
problematic ctype macros that change based on the locale's character
set.</para></item>
        <item><para>PJL value substitution of more than 9 values was
broken (STR #3621)</para></item>
        <item><para>Custom options with missing string values caused
ppdEmit* to segfault (STR #3620)</para></item>
        <item><para>Fixed an issue with the Italian version of the web
interface (STR #3624)</para></item>
        <item><para>Fixed the Solaris SMF configuration file for
cups-lpd (STR #3611)</para></item>
        <item><para>The scheduler did not set the
notify-subscribed-event attribute when delivering printer-added or
printer-modified events (STR #3608)</para></item>
        <item><para>The mailto notifier could get into an infinite
loop (STR #3609)</para></item>
        <item><para>Date/time information was not shown in banner
pages.</para></item>
        <item><para>Relational operators were broken in
#if/#elif/#else/#endif expressions for the PPD compiler.</para></item>
        <item><para>Moving a job via the web interface failed without
asking for authentication (STR #3559)</para></item>
        <item><para>The scheduler now clears the printer-state-reasons
when the driver is changed (STR #3570)</para></item>
        <item><para>The web interface did not allow a user to change
the driver (STR #3537, STR #3601)</para></item>
        <item><para>The scheduler was not setting the PATH_INFO
environment variable when needed (STR #3600)</para></item>
        <item><para>The scheduler incorrectly set the CUPSD_AUTH_TYPE
environment variable instead of AUTH_TYPE (STR #3599)</para></item>
        <item><para>Fixed a buffer overrun in the PPD compiler (STR
#3594)</para></item>
        <item><para>Fixed some additional IPP job template attribute
mapping issues in the scheduler.</para></item>
      </change>

      <change from="1.4.3" to="1.4.4">
        <item><para>Documentation updates (STR #3453, STR #3527, STR
#3528, STR #3529)</para></item>
        <item><para>Security: The texttops filter did not check the
results of allocations (STR #3516)</para></item>
        <item><para>Security: The fix for CVE-2009-3553 was incomplete
(STR #3490)</para></item>
        <item><para>Security: The web admin interface could disclose
the contents of memory (STR #3577)</para></item>
        <item><para>Security: CUPS could overwrite files as root in
directories owned or writable by non-root users (STR
#3510)</para></item>
        <item><para>The cups-config utility did not return the correct
linker options on AIX (STR #3587)</para></item>
        <item><para>Fixed some IPP conformance issues with the
scheduler's ippget-event-life, operations-supported, output-bin, and
sides attributes (STR #3554)</para></item>
        <item><para>The OpenSSL interfaces have been made thread-safe
and the GNU TLS interface is explicitly forbidden when threading is
enabled (STR #3461)</para></item>
        <item><para>Fixed an IPP conformance issue with the
scheduler's Send-Document implementation (STR #3514)</para></item>
        <item><para>Added additional validation checks for the 1284
device ID (STR #3534)</para></item>
        <item><para>Fixed a problem with the RPM spec file (STR
#3544)</para></item>
        <item><para>The lpstat command did not limit the job list to
the specified printers (STR #3541)</para></item>
        <item><para>The cupsfilter command did not set the
RIP_MAX_CACHE environment variable (STR #3531)</para></item>
        <item><para>Fixed support for media-col and page size variants
(STR #3394)</para></item>
        <item><para>The PostScript filter did not support all media
selection options for the first page (STR #3525)</para></item>
        <item><para>The scheduler did not always remove job control
files (STR #3425)</para></item>
        <item><para>The scheduler could crash on restart if classes
were defined (STR #3524)</para></item>
        <item><para>The scheduler no longer looks up network interface
hostnames by default on Mac OS X (STR #3523)</para></item>
        <item><para>ippWriteIO did not write collection (member)
attributes properly in all cases (STR #3521)</para></item>
        <item><para>The "cupsctl --remote-any" and corresponding web
interface check box (allow printing from the Internet) did not work
reliably (STR #3520)</para></item>
        <item><para>The lpq and lpr commands would sometimes choose
different default printers (STR #3503)</para></item>
        <item><para>cupsDo*Request did not flush error text, leading
to multiple issues (STR #3325, STR #3519)</para></item>
        <item><para>cupsDoAuthentication did not cancel password
authentication after 3 failures (STR #3518)</para></item>
        <item><para>Fixed several LDAP browsing bugs (STR
#3392)</para></item>
        <item><para>The Dymo driver did not support copies (STR
#3457)</para></item>
        <item><para>The scheduler did not update the classes.conf file
when deleting a printer belonging to a class (STR #3505)</para></item>
        <item><para>The lppasswd command did not use localized
password prompts (STR #3492)</para></item>
        <item><para>The socket backend no longer waits for
back-channel data on platforms other than Mac OS X (STR
#3495)</para></item>
        <item><para>The scheduler didn't send events when a printer
started accepting or rejecting jobs (STR #3480)</para></item>
        <item><para>The web interface now includes additional CSRF
protection (STR #3498)</para></item>
      </change>

      <change from="1.4.2" to="1.4.3">
        <item><para>SECURITY: The scheduler could try responding on a
closed client connection, leading to a crash (STR #3200)</para></item>
        <item><para>SECURITY: The lppasswd program allowed the
localization files to be overridden when running in setuid mode (STR
#3482)</para></item>
        <item><para>Localization updates (STR #3352, STR #3409, STR
#3422, STR #3452, STR #3473, STR #3502)</para></item>
        <item><para>Documentation updates (STR #3451, STR
#3504)</para></item>
        <item><para>The IPP backend now sets the printer-state-message
to "Ready to print." at the end of a successful job (STR
#3460)</para></item>
        <item><para>The PPD compiler did not correctly add the
manufacturer to the output filename when using the "-m" option (STR
#3469)</para></item>
        <item><para>The IPP backend did not handle authentication
properly for the Get- Printer-Attributes operation (STR
3458)</para></item>
        <item><para>Getting SNMP values larger than 127 bytes did not
work.</para></item>
        <item><para>IPP conformance: Get-Jobs has a default value for
requested-attributes (STR #3383)</para></item>
        <item><para>cupsPrintFiles() did not report all errors (STR
#3449)</para></item>
        <item><para>cupsAddDest() could read freed memory (STR
#3448)</para></item>
        <item><para>The DBUS notifier did not build (STR
#3447)</para></item>
        <item><para>The scheduler would crash when an active printer
was deleted.</para></item>
        <item><para>The snmp backend did not work with some printers
(STR #3413)</para></item>
        <item><para>The web interface did not show the conflicting
values when setting options (STR #3440)</para></item>
        <item><para>Setting options in the web interface did not
always work (STR #3439)</para></item>
        <item><para>The scheduler did not use the Get-Job-Attributes
policy for a printer (STR #3431)</para></item>
        <item><para>The scheduler added two job-name attributes to
each job object (STR #3428)</para></item>
        <item><para>CSS files would not print (STR
#3442)</para></item>
        <item><para>The scheduler did not clean out completed jobs
when PreserveJobHistory was turned off (STR #3425)</para></item>
        <item><para>The web interface did not show completed jobs for
a printer (STR #3436)</para></item>
        <item><para>Authenticated printing did not always work when
printing directly to a remote server (STR #3435)</para></item>
        <item><para>The USB backend did not work on Solaris (STR
#3423)</para></item>
        <item><para>cupstestppd didn't catch problems with
JobPatchFile definitions (STR #3421)</para></item>
        <item><para>The socket backend could crash if a SNMP string
had a negative length.</para></item>
        <item><para>Fixed some termination issues with the USB backend
on Mac OS X.</para></item>
        <item><para>The side-channel APIs did not handle interrupts
properly.</para></item>
        <item><para>The network backends incorrectly cleared the
media-empty-warning state.</para></item>
        <item><para>The web interface did not allow users to
successfully add serial printers (STR #3391)</para></item>
        <item><para>cupsTempFd() did not work in some situations (STR
#3382)</para></item>
        <item><para>Some C API headers were missing C++ wrapper
logic.</para></item>
        <item><para>The PPD compiler did not localize single-language
PPD options properly (STR #3386)</para></item>
        <item><para>Modifying a printer from the web interface
sometimes caused the wrong driver to be selected (STR
#3418)</para></item>
        <item><para>The scheduler did not handle out-of-memory
conditions properly when loading a job (STR #3407)</para></item>
        <item><para>When adding printers from the web interface, the
dynamic updates of the device list made it hard to pick a device (STR
#3406)</para></item>
        <item><para>Fixed a typo in the web interface admin page
template (STR 3403)</para></item>
        <item><para>The web interface did not preserve the "printer is
shared" state when modifying a printer (STR #3390)</para></item>
        <item><para>The PPD compiler incorrectly inserted translations
of empty strings (STR #3411)</para></item>
        <item><para>The scheduler did not reset the SIGPIPE handler of
child processes (STR #3399)</para></item>
        <item><para>cupsGetNamedDest() incorrectly returned the
default printer if the named printer did not exist (STR
#3397)</para></item>
        <item><para>Fixed a GNU TLS error handling bug (STR
#3381)</para></item>
      </change>

      <change from="1.4.1" to="1.4.2">
        <item><para>SECURITY: The CUPS web interface was vulnerable to
several XSS and HTTP header/body attacks via attribute injection (STR
#3367, STR #3401)</para></item>
        <item><para>Fixed localization errors (STR #3359, STR #3372,
STR #3380, STR #3387)</para></item>
        <item><para>The documentation for classes.conf and
printers.conf did not provide the correct instructions for manual
changes (STR #3351)</para></item>
        <item><para>The scheduler did not always rebuild printer cache
files when the driver was changed (STR #3356)</para></item>
        <item><para>The documentation makefile failed to install
localizations when using newer versions of Bash (STR
#3360)</para></item>
        <item><para>The configure script did not use the --with-xinetd
value for the default LPD configuration path (STR #3347)</para></item>
        <item><para>The configure script incorrectly required glib for
DBUS support (STR #3346)</para></item>
        <item><para>The cupstestppd program incorrectly reported
filters with bad permisssions as missing (STR #3363)</para></item>
        <item><para>The cups.desktop file used the wrong locale names
(STR #3358)</para></item>
        <item><para>cupsSideChannelRead() did not return an error for
short reads.</para></item>
        <item><para>The installed PAM configuration file did not use
the correct options with the pam_unix2 module (STR
#3313)</para></item>
        <item><para>The scheduler did not preserve default options
that contained special characters (STR #3340)</para></item>
        <item><para>The scheduler did not remove old pre-filters when
updating a printer driver (STR #3342)</para></item>
        <item><para>The HP/GL-2 filter did not check for early
end-of-file (STR #3319)</para></item>
        <item><para>The USB backend did not compile on some platforms
(STR #3332)</para></item>
        <item><para>cupsSideChannelSNMPWalk() could go into an
infinite loop with broken SNMP implementations.</para></item>
      </change>

      <change from="1.4.0" to="1.4.1">
        <item><para>Documention fixes (STR #3296)</para></item>
        <item><para>SNMP supply levels and states were wrong for some
printers.</para></item>
        <item><para>The IPP backend did not update the
auth-info-required value.</para></item>
        <item><para>The libusb-based USB backend would hang at the end
of the job (STR #3315, STR #3318)</para></item>
        <item><para>DNS-SD registrations for raw queues had an empty
"ty" key (STR #3299)</para></item>
        <item><para>The JPEG and BMP MIME type rules were broken (STR
#3284)</para></item>
        <item><para>cupsGetNamedDest returned the default printer when
the named destination did not exist (STR #3285)</para></item>
        <item><para>The JobKillDelay was not triggered for canceled
jobs (STR #3292)</para></item>
        <item><para>The PPD compiler could get in an infinite loop
(STR #3293)</para></item>
        <item><para>The configure check for dns-sd.h was broken (STR
#3297)</para></item>
        <item><para>The "Query Printer for Default Options" page did
not go away if the query job was held (STR #3302)</para></item>
        <item><para>Boolean options did not show up as selected in the
web interface (STR #3303)</para></item>
        <item><para>The scheduler did not cache or report driver
information files correctly, leading to a variety of issues (STR
#3283, STR #3297, STR #3305)</para></item>
        <item><para>cupsDoIORequest() did not abort on permanent
errors (STR #3311)</para></item>
        <item><para>Modifying a class in the web interface did not
work (STR #3312)</para></item>
        <item><para>BrowseLocalProtocols could be cleared when
changing the sharing setting (STR #3287)</para></item>
        <item><para>The scheduler could return an empty supported
document format (STR #3308)</para></item>
        <item><para>The PPD compiler generated invalid PPD files when
the locale used something other than "." for the decimal point (STR
#3300)</para></item>
        <item><para>The IPP backend did not handle some non-comforming
IPP printer implementations (STR #3262)</para></item>
        <item><para>The scheduler leaked three file descriptors to
each job filter (STR #3263)</para></item>
        <item><para>The scheduler now uses a default CUPS-Get-Devices
timeout of 15 seconds (STR #3307)</para></item>
      </change>

      <change from="1.4.rc1" to="1.4.0">
        <item><para>Localization updates (STR #3223, STR #3246, STR
#3248, STR #3250)</para></item>
        <item><para>Documentation updates (STR #3225, STR #3230, STR
#3242, STR #3260)</para></item>
        <item><para>The --with-pdftops configure option did not accept
a full path to the filter (STR #3278)</para></item>
        <item><para>The banner filter did not position the back side
image correctly (STR #3277)</para></item>
        <item><para>The dnssd backend could crash (STR
#3272)</para></item>
        <item><para>The 1284 device ID sometimes contained trailing
garbage (STR #3266)</para></item>
        <item><para>The USB backend returned different URIs for some
printers than in CUPS 1.3 (STR #3259)</para></item>
        <item><para>The scheduler did not do local job-hold-until
processing for remote queues (STR #3258)</para></item>
        <item><para>The scheduler did not try all possible SSL
certificates on Mac OS X.</para></item>
        <item><para>The scheduler did not always remove a file
descriptor when using the kqueue interface (STR #3256)</para></item>
        <item><para>The scheduler did not protect against bad job
control files in all cases (STR #3253)</para></item>
        <item><para>The scheduler did not encode "+" in model names
(STR #3254)</para></item>
        <item><para>The web interface didn't show the default options
(STR #3244)</para></item>
        <item><para>The IPP and LPD backends needed print data before
they would do an SNMP query.</para></item>
        <item><para>Fixed a GNU TLS compatibility issue (STR
#3231)</para></item>
        <item><para>Fixed a HTML error in the add and modify printer
web interface templates (STR #3229)</para></item>
        <item><para>The scheduler did not minimize the number of
printer state events that were generated by filter STATE: messages,
which could lead to poor performance.</para></item>
        <item><para>The USB backend on Mac OS X did not cleanly cancel
a job.</para></item>
        <item><para>The network backends now set the
connecting-to-device printer-state- reasons value when looking up the
address and copying the print data for consistency.</para></item>
        <item><para>The scheduler now supports the
com.apple.print.recoverable-warning reason on all
platforms.</para></item>
      </change>

      <change from="1.4.b3" to="1.4.rc1">
        <item><para>The PPD compiler documentation was missing
information on localization (STR #3212)</para></item>
        <item><para>The IPP backend now reconnects after every request
when talking to printers that claim IPP support but only use
HTTP/1.0.</para></item>
        <item><para>The PPD compiler crashed when both "Resolution"
and "Group foo Option Resolution" were specified in the .drv
file.</para></item>
        <item><para>The PPD compiler's #if/#elif/#else/#endif did not
work for undefined variables (STR #3210)</para></item>
        <item><para>Static libraries could not be installed by a
non-root user on systems needing a ranlib program (STR
#3209)</para></item>
        <item><para>The scheduler incorrectly always tried to copy
Kerberos credentials for print jobs.</para></item>
        <item><para>Updated the Spanish localization (STR
#3204)</para></item>
        <item><para>The scheduler crashed when getting the default
paper size from libpaper (STR #3205, STR #3206)</para></item>
        <item><para>The PPD compiler now defines six variables:
CUPS_VERSION, CUPS_VERSION_MAJOR, CUPS_VERSION_MINOR,
CUPS_VERSION_PATCH, PLATFORM_NAME, and PLATFORM_ARCH (STR
#3203)</para></item>
        <item><para>Fixed a whitespace skipping bug in
cupsRasterInterpretPPD.</para></item>
        <item><para>The scheduler did not return HTTP 403 (Forbidden)
for authenticated users that were not authorized to do IPP operations
(STR #3193)</para></item>
        <item><para>The scheduler did not report more than 8 Product
strings from a PPD file.  Some PPD files have as many as
24.</para></item>
        <item><para>ppdOpen*() could crash if a keyword had no value
string (something that cupstestppd looks for...)</para></item>
        <item><para>cupsLangDefault() did not return the correct
language on Mac OS X.</para></item>
        <item><para>The Mac OS X USB backend did not handle aborted or
stalled pipe conditions properly, which prevented drivers from
ejecting partial pages when a job was canceled or held.</para></item>
      </change>

      <change from="1.4.b2" to="1.4.b3">
        <item><para>Documentation fixes (STR #3044, STR #3057, STR
#3153, STR #3158, STR #3173)</para></item>
        <item><para>Added complete localizations for German, Japanese,
Polish, and Russian and partial localizations for Chinese, Danish,
Finnish, French, Italian, Korean, Norwegian, Portuguese, and Swedish
(STR #3096, STR #3098, STR #3109, STR #3111, STR #3141)</para></item>
        <item><para>Updated the configure check for -fstack-protector
(STR #3198)</para></item>
        <item><para>The network backends now correctly convert SNMP
supply descriptions to UTF-8 encoding as needed.</para></item>
        <item><para>The scheduler could crash when deleting an
attribute (STR #3197)</para></item>
        <item><para>The cups-driverd program did not detect symlink
loops (STR #3185)</para></item>
        <item><para>The EPSON 24-pin series driver should now feed the
correct amount (STR #2624)</para></item>
        <item><para>The scheduler now automatically logs the last N
debug messages for failed print jobs.</para></item>
        <item><para>You can now modify a raw print queue (STR
#3133)</para></item>
        <item><para>Fixed a number of ppdi issues and added a unit
test to validate that ppdc + ppdi can generate and import the same
data (STR #3152)</para></item>
        <item><para>Moving jobs in the web interface now shows an
error if you only have one printer or class added (STR
#3094)</para></item>
        <item><para>Since classes have never truly supported the
printer-error-policy stuff added in CUPS 1.2, update the code to
reflect the current reality and support only the retry-current-job
policy for now (STR #3171)</para></item>
        <item><para>Revised the password callback support (STR
#2953)</para></item>
        <item><para>ppdEmit*() did not choose between PageSize and
PageRegion properly.</para></item>
        <item><para>Make some fairly substantial changes to the
Kerberos support code so that CUPS can work in multi-realm
environments and does not require delegatable credentials.  Shared
printing still requires delegation, however "delegation by policy" can
be enabled in the KDC to make this all work.</para></item>
        <item><para>"AccessLogLevel actions" did not hide
client-error-not-found errors.</para></item>
        <item><para>AP_FIRST_InputSlot did not work with
number-up.</para></item>
        <item><para>cupsBackChannelRead() and cupsBackChannelWrite()
could fail due to a lack of kernel buffers.</para></item>
        <item><para>The IPP and LPD backends did not respond to
side-channel requests while copying print data to a temporary
file.</para></item>
        <item><para>cupsWriteRequestData() flushed the output buffer
unnecessarily, causing reduced performance in some
situations.</para></item>
        <item><para>If a CGI process died before sending its MIME
headers, the request would hang on the client.</para></item>
        <item><para>The printer/class/job search feature on the web
interface did not work (STR #3132)</para></item>
        <item><para>The scheduler did not write the printers out for
classes.</para></item>
        <item><para>CUPS-Get-PPDs did not work properly when filtering
by language, product, or psversion (STR #3136)</para></item>
        <item><para>The scheduler now kills job filters when it takes
more than 30 seconds (configurable) to cancel or hold the
job.</para></item>
        <item><para>The cupstestppd program did not validate the
capitalization of filenames in the PPD file.</para></item>
        <item><para>The cupstestppd program did not validate the
PageSize and PageRegion values.</para></item>
        <item><para>The cups-deviced helper program could miss
reporting some backend devices (STR #3108)</para></item>
        <item><para>The cupsSideChannelSNMP* functions did not
work.</para></item>
        <item><para>The scheduler could consume 100% CPU when jobs
were canceled.</para></item>
        <item><para>Clicking on "Select Another Make/Manufacturer" in
the web interface incorrectly added the printer (STR
#3095)</para></item>
        <item><para>The scheduler no longer uses programs with
insecure file permissions.</para></item>
        <item><para>httpAssembleURI*() did not escape backslashes in
hostnames.</para></item>
        <item><para>The dnssd backend did not unquote "full names"
before creating the device URI.</para></item>
        <item><para>The scheduler now supports JobRetryInterval values
less than 10 seconds.</para></item>
        <item><para>Updated the Spanish localization (STR
#3090)</para></item>
        <item><para>The scheduler did not redo Bonjour/DNS-SD
registrations when updating them failed.</para></item>
        <item><para>The "authenticated" policy incorrectly required
authentication for status operations.</para></item>
        <item><para>ppdOpen*() incorrectly loaded PPDs with multiple
JobPatchFile keywords.</para></item>
        <item><para>The network backends no longer report the SNMP
"offline" or maintenance status bits since they are inconsistently
implemented and often unreliable.</para></item>
        <item><para>The scheduler no longer logs child processes
killed via SIGKILL as "crashed".</para></item>
        <item><para>The printer link shown on the "job moved" template
was bad (STR #3085)</para></item>
        <item><para>Updated the HTML templates to use the final HTML 4
DOCTYPE (STR #3086)</para></item>
        <item><para>The scheduler did not track the "paused" reason
properly if a printer had other reasons associated with
it.</para></item>
        <item><para>cupsSendRequest() did not clear old local
certificate auth data.</para></item>
        <item><para>The PPD compiler did not search for localization
files properly (STR #3084)</para></item>
        <item><para>cupsGetNamedDest() did not use the fallback
default like cupsGetDests*() (STR #3082)</para></item>
        <item><para>The scheduler now provides a LogTimeFormat
directive to enable microseconds in the date and time that are
logged.</para></item>
        <item><para>The scheduler now provides a
MultipleOperationTimeout directive to control the timeout for
multi-file print jobs.</para></item>
        <item><para>The configure script incorrectly allowed Avahi to
be used for DNS-SD printer discovery (STR #3065)</para></item>
        <item><para>The web interface and scheduler did not support
URIs up to 1024 bytes in length (STR #3072)</para></item>
        <item><para>Fixed pdftops issues with page sizes (STR
#3063)</para></item>
        <item><para>Fixed pdftops issues with Ghostscript (STR
#3062)</para></item>
        <item><para>The scheduler incorrectly registered default
profiles for PostScript printers with no specified
colorspace.</para></item>
        <item><para>The scheduler incorrectly created an empty
org.cups.printers.plist file on Mac OS X.</para></item>
        <item><para>cupsGetPPD3() did not look for local PPDs in the
right directory.</para></item>
        <item><para>SNMP lookups via side-channel did not work for
NULL-VALUE and and OCTET-STRING OIDs containing nul
characters.</para></item>
        <item><para>The libusb-based USB backend did not
work.</para></item>
        <item><para>The scheduler did not set the printer-commands
attribute correctly for some PPDs.</para></item>
        <item><para>The ppdi utility did not work.</para></item>
        <item><para>The web interface no longer uses multi-part output
with old or broken web browsers (STR #3049)</para></item>
        <item><para>CUPS now conforms to the draft IPP/2.0 and IPP/2.1
specification.</para></item>
        <item><para>Added a new cupsGetConflicts() API to get a list
of conflicting options.</para></item>
        <item><para>The PPD compiler didn't localize options or
choices that did not have associated translation text (STR
#3045)</para></item>
        <item><para>Updated the Spanish localization (STR
#3043)</para></item>
        <item><para>Fixed build problems (STR #3040, STR
#3047)</para></item>
        <item><para>cupsResolveConflicts() did not resolve using the
default option choice in some cases due to the mirror UIConstraints
that are present in most PPD files.</para></item>
        <item><para>The scheduler did not honor MIME type
priorities.</para></item>
        <item><para>The commandtops filter incorrectly used the
JCLBegin code to end its jobs.</para></item>
        <item><para>The default BrowseLocalProtocols value was not set
properly.</para></item>
        <item><para>Since the commandtops filter does not actually
support ReportLevels all on its own, don't list that printer command
by default for PS printers.</para></item>
        <item><para>The scheduler did not give filters a chance to log
errors or update printer attributes when a job was
canceled.</para></item>
        <item><para>The scheduler did not clear the
"connecting-to-device" reason keyword when a job
finished.</para></item>
      </change>

      <change from="1.4.b1" to="1.4.b2">
        <item><para>Documentation updates (STR #2983, STR #2998, STR
#3021)</para></item>
        <item><para>The cupstestppd utility now validates the
FileVersion and FormatVersion values in PPD files.</para></item>
        <item><para>The default cupsd.conf file did not reflect the
--with-local-protocols value set at compile-time (STR
#3037)</para></item>
        <item><para>The cupsGetPPD* APIs now create symlinks to local
PPD files rather than copying them whenever possible.</para></item>
        <item><para>Various performance optimizations in the string
pool, dests, and options implementations.</para></item>
        <item><para>The cupsGetDests* APIs now return the marker and
printer-commands attributes.</para></item>
        <item><para>Side-channel SNMP lookups would not work when
cupsSNMPSupplies was set to False in the PPD file.</para></item>
        <item><para>Localized the device descriptions for the SCSI,
serial, and network backends (STR #3014)</para></item>
        <item><para>Added a Spanish localization (STR
#3015)</para></item>
        <item><para>Added support for marker-low-levels and
marker-high-levels attributes.</para></item>
        <item><para>The scheduler could hang writing a long log
line.</para></item>
        <item><para>The cupsGetDevices() function now has an
"include_schemes" parameter.</para></item>
        <item><para>The lpinfo command now supports --include-schemes
and --exclude-schemes options.</para></item>
        <item><para>The CUPS-Get-PPDs operation now supports the
include-schemes and exclude-schemes attributes.</para></item>
        <item><para>The CUPS-Get-Devices operation now supports the
include-schemes attribute.</para></item>
        <item><para>The print filters now support a replacement for
the fitplot option called "fit-to-page".</para></item>
        <item><para>The LPD backend no longer tries to collect page
accounting information since the LPD protocol does not allow us to
prevent race conditions.</para></item>
        <item><para>The scheduler did not save the last
marker-change-time value.</para></item>
        <item><para>Fixed a problem with printing to some IPP
printers, including CUPS 1.1.x.</para></item>
        <item><para>Fixed a redirection problem with the printer web
page (STR #3012)</para></item>
        <item><para>Fixed a PPD compiler problem with the loading of
message catalogs (STR #2990)</para></item>
        <item><para>Fixed a PPD compiler problem with the loading of
.strings files (STR #2989)</para></item>
        <item><para>The cupsfilter utility did not set the
CONTENT_TYPE environment variable when running filters.</para></item>
        <item><para>The scheduler now waits to allow system sleep
until the jobs have all stopped.</para></item>
        <item><para>The IPP, LPD, and socket backends used different
"connecting" progress messages.</para></item>
      </change>

      <change from="1.3.11" to="1.4.b1">
        <item><para>Documentation updates (STR #2567)</para></item>
        <item><para>The PPD compiler now allows local message catalogs
to override the standard CUPS translations (STR #2642)</para></item>
        <item><para>The ppdmerge command did not merge custom option
strings (STR #2863)</para></item>
        <item><para>The scheduler now supports the Hold-New-Jobs and
Release-Held-New-Jobs operations; these are exposed via the
cupsdisable and cupsenable commands (STR #2332)</para></item>
        <item><para>The lpstat command is now much faster when
displaying the status of a single printer (STR #2843)</para></item>
        <item><para>The scheduler now caches information from PPD
files to provide significantly faster startup time with large numbers
of PPDs (STR #1293)</para></item>
        <item><para>CUPS-Get-Driver now provides much better driver
matching based on the IEEE-1284 device ID and make/model strings (STR
#2707)</para></item>
        <item><para>Now support the cupsSNMPSupplies keyword to
control whether the network backends query the SNMP Printer MIB for
supply levels.</para></item>
        <item><para>Now support and use a new banner file format for
better text support and easier customization (STR #2490)</para></item>
        <item><para>The scheduler now sets the PRINTER_INFO and
PRINTER_LOCATION environment variables from the corresponding IPP
attributes.</para></item>
        <item><para>The ippRead*() and ippWrite*() functions no longer
use a stack-based buffer (STR #2388)</para></item>
        <item><para>The CUPS-Add-Modify-Printer operation now allows
you to set the printer-state-reasons attribute.</para></item>
        <item><para>The "set printer options" page now supports
auto-configuration of printer options (STR #1440)</para></item>
        <item><para>The web interface now provides an advanced server
settings form.</para></item>
        <item><para>The web interface's "modify printer" pages now
make it easier to change just one setting (STR #1919)</para></item>
        <item><para>The scheduler now supports a plist
PrintcapFormat.</para></item>
        <item><para>The scheduler now supports multiple addresses in
Allow and Deny lines, just like Apache (STR #2947)</para></item>
        <item><para>Added CUPS_JOBTYPE environment variable for job
filters so they know whether they are printing a banner or document
file (STR #2799)</para></item>
        <item><para>Added support for printer filtering by the
cupsfilter command (STR #2562)</para></item>
        <item><para>Added a SSLOptions directive to allow Windows
clients to talk to CUPS in FIPS mode (STR #2827)</para></item>
        <item><para>Renamed the accept and reject commands to
cupsaccept and cupsreject; the old names are still available (STR
#2936)</para></item>
        <item><para>The locale/translate utility needed an update to
work with Google (STR #2882)</para></item>
        <item><para>The lpstat command now supports a -H option to
display the default server (STR #2833)</para></item>
        <item><para>The scheduler now supports a FatalErrors directive
to control which errors should cause the scheduler to exit (STR
#2536)</para></item>
        <item><para>The scheduler now uses the php-cgi program if it
is available (STR #2923)</para></item>
        <item><para>The scheduler now supports a DefaultPaperSize
directive (STR #2848)</para></item>
        <item><para>The scheduler now passes the
job-originating-host-name value to filters in the options argument
(STR #2558)</para></item>
        <item><para>CUPS now supports job tickets in PDF files (STR
#2903)</para></item>
        <item><para>Added a DBUS notifier (STR #2529)</para></item>
        <item><para>The LPD mini-daemon now passes the document name
when queuing print jobs (STR #2482)</para></item>
        <item><para>The IPP backend did not relay
com.apple.print.recoverable-message values.</para></item>
        <item><para>The scheduler now supports a job-media-progress
attribute to track the progress of individual pages.</para></item>
        <item><para>The sample HP driver now supports A5 (STR
#2798)</para></item>
        <item><para>The CUPS web interface menu item now uses the
xdg-open command, when available (STR #2724)</para></item>
        <item><para>The cups-lpd program now supports the -h option
(STR #2794)</para></item>
        <item><para>The scheduler now sets the PAM_TTY parameter and
the PAM_ESTABLISH_CRED credential flag (STR #2745)</para></item>
        <item><para>The scheduler now logs unsuccessful requests to
the error_log file as errors (STR #2616)</para></item>
        <item><para>Added support for a "retry-current-job" error
policy that retries the current job immediately when the backend
encounters an error (STR #2555)</para></item>
        <item><para>The scheduler now returns a "forbidden" error when
a user correctly authenticates but does not have permission to
continue further (STR #2101)</para></item>
        <item><para>The scheduler now loads both the server and CA
certificates (if present) from the ServerCertificate file (STR
#2146)</para></item>
        <item><para>New RSS subscriptions now create their feed files
immediately (STR #2853)</para></item>
        <item><para>Added support for a device-location attribute
which provides the physical location of a printer
device.</para></item>
        <item><para>Added a cupsBackendReport() API which handles
quoting of the device data by a backend.</para></item>
        <item><para>Added support for custom options in the web
interface (STR #1729)</para></item>
        <item><para>Added support for Mozilla LDAP, reconnection to
LDAP servers, and improved LDAP performance (STR #1962)</para></item>
        <item><para>Added Solaris SMF support (STR
#1477)</para></item>
        <item><para>Added optional support for using TCP wrappers to
limit access to CUPS (STR #263)</para></item>
        <item><para>Added ppdPageSizeLimits API.</para></item>
        <item><para>Added support for new cupsMediaQualifier2,
cupsMediaQualifier3, cupsMinSize, and cupsMaxSize
attributes.</para></item>
        <item><para>Added cupsResolveConflicts and
ppdInstallableConflict APIs.</para></item>
        <item><para>Added support for new cupsUIConstraints and
cupsUIResolver attributes for better option conflict detection and
resolution.</para></item>
        <item><para>Increased the maximum size of 1284 device ID
strings to 256 bytes (STR #2877)</para></item>
        <item><para>Added an AccessLogLevel directive to cupsd.conf to
control what is logged to the access_log file.</para></item>
        <item><para>The default LogLevel is now "warn" instead of
"info" to reduce the amount of logging that is done to disk by
default.</para></item>
        <item><para>The PPD compiler did not include OID query
keywords in PPD files (STR #2871)</para></item>
        <item><para>The cups-driverd helper program now directly
supports driver information files.</para></item>
        <item><para>The USB backend now uses libusb when available
(STR #1575)</para></item>
        <item><para>Added ppdLocalizeAttr function to get the
localized version of an attribute.</para></item>
        <item><para>MIME types now support a priority() attribute (STR
#2719)</para></item>
        <item><para>The standard MIME types are now installed in
DataDir/mime (STR #2719)</para></item>
        <item><para>The lpoptions command now describes custom options
and the necessary parameters (STR #2660)</para></item>
        <item><para>The ppdmerge program did not support Simplified
Chinese or Traditional Chinese language version strings (STR
#2851)</para></item>
        <item><para>The PPD compiler now supports localizable
attributes (STR #2738)</para></item>
        <item><para>The ppdpo utility now includes cupsIPPReasons
values in the message catalogs it generates (STR #2754)</para></item>
        <item><para>The PPD compiler now supports conditional
directives (STR #2636)</para></item>
        <item><para>The ppdc utility now supports a "-t" option to
test PPD files (STR #2739)</para></item>
        <item><para>The ppdc utility now supports a "-m" option to use
the ModelName value as the output filename.</para></item>
        <item><para>The ppdc utility now supports a FileName directive
to set an alternate output filename (STR #2740)</para></item>
        <item><para>The side-channel API now supports SNMP queries for
the standard network backends.</para></item>
        <item><para>Added a PageLogFormat directive to the cupsd.conf
file to control the format of lines in the page_log
file.</para></item>
        <item><para>Filters can now send PPD: messages to stderr to
set PPD keywords like DefaultPageSize while a job is
printing.</para></item>
        <item><para>Added a mdns backend for discovery and printing to
printers that advertise themselves via DNS-SD (Bonjour)</para></item>
        <item><para>The ipp, lpd, and socket backends now support
DNS-SD service name resolution.</para></item>
        <item><para>The scheduler now uses a single shared file
descriptor for all DNS-SD registrations (STR #2674)</para></item>
        <item><para>The ipp, lpd, and socket backends now support
SNMP-based page accounting and supply level monitoring (STR
#1655)</para></item>
        <item><para>Added support for cupsPJLDisplay attribute to
control what PJL commands are used to display the job
information.</para></item>
        <item><para>Driver information files can now be installed in
/Library/Printers/PPDs.drv on Mac OS X.</para></item>
        <item><para>The CUPS image library now supports reading images
larger than 2GB.</para></item>
        <item><para>The scheduler now delays writing config and state
files to reduce disk activity (STR #2684)</para></item>
        <item><para>The CUPS-Get-Devices operation now supports the
exclude-schemes and timeout attributes to control which backends are
polled and for how long.</para></item>
        <item><para>The cups-deviced helper application now runs
backends in parallel to get the list of devices faster.</para></item>
        <item><para>Added --enable-pap configure option.</para></item>
        <item><para>The default cupsd.conf file now includes an
"authenticated" policy which requires authentication for remote print
jobs.</para></item>
        <item><para>Added support for Czech and Hungarian in PPD files
(STR #2735, STR #2736)</para></item>
        <item><para>The PPD compiler tools now support Mac OS X
.strings files for localization (STR #2737)</para></item>
        <item><para>ppdOpen*() now default the colorspace member to
PPD_CS_N when no DefaultColorSpace attribute is present in the PPD
file.</para></item>
        <item><para>The build system has been updated to support
separate installation of data, program, header, and library
files.</para></item>
        <item><para>All support libraries are now built as shared
libraries by default.</para></item>
        <item><para>The scheduler now manages ICC color profiles on
Mac OS X.</para></item>
        <item><para>The network backends (ipp, lpd, socket) now
support SNMP-based supply and page count monitoring (STR
#1655)</para></item>
        <item><para>The lppasswd program is no longer installed setuid
to root to make the default installation more secure.</para></item>
        <item><para>Added a new ppdLocalizeMarkerName() function to
get the localized version of a marker-names value.</para></item>
        <item><para>The scheduler now provides the printer-dns-sd-name
attribute for printers shared via DNS-SD/Bonjour.</para></item>
        <item><para>The pdftops filter now executes the Xpdf or
poppler pdftops utility to convert PDF files (STR #1471)</para></item>
        <item><para>Bonjour printer registrations now advertise as
local or global based on the current access policies for the
printer.</para></item>
        <item><para>cupsGetDests*() and cupsSetDests*() now track the
last used printer preference on Mac OS X.</para></item>
        <item><para>Added a new streaming request API (STR
#2261)</para></item>
        <item><para>Added a new cupsGetNamedDest() function to the
CUPS library for faster printing with lp and lpr (STR
#2638)</para></item>
        <item><para>The scheduler now sets the PAM RHOST value on
systems that support it (STR #2637)</para></item>
        <item><para>The scheduler now sandboxes child processes when
possible.</para></item>
        <item><para>The Cancel-Job operation now supports a purge-job
attriibute to purge a specified job.</para></item>
        <item><para>ppdEmit* and ppdCollect* now use the
NonUIOrderDependency attributes for custom option
selections.</para></item>
        <item><para>The web interface now enables/disables the printer
sharing (formerly publishing) controls based on the
server-is-sharing-printers state (STR #2233)</para></item>
        <item><para>The scheduler now tracks printer sharing via the
server-is-sharing-printers attribute, and manages LPD and SMB sharing
as well (STR #2233)</para></item>
        <item><para>The web interface now allows you to go back to the
make/ manufacturer page if there is no matching printer driver on the
model page (STR #2436)</para></item>
        <item><para>The printer list now shows the default media,
banner, and duplex options as well as the color and duplex
capabilities of printers (STR #1175)</para></item>
        <item><para>The web interface look-n-feel has been updated
(STR #2492)</para></item>
        <item><para>The scheduler now supports a CUPS-Get-Document
operation that returns the specified print job document (STR
#118)</para></item>
        <item><para>The cupsfilter utility now supports a "-J jobid"
option to filter the document from the specified job.</para></item>
        <item><para>The scheduler (cupsd) now supports a new option
(-t) to do a syntax check of the cupsd.conf file (STR
#2003)</para></item>
        <item><para>Added new cupsGetPPD3() API to allow applications
to cache PPDs safely (STR #1473)</para></item>
        <item><para>Added generic PostScript and PCL printer driver
PPDs.</para></item>
      </change>

      <change from="1.3.10" to="1.3.11">
        <item><para>The scheduler did not prevent nested classes (STR
#3211)</para></item>
        <item><para>The scheduler did not reprint processing jobs that
were moved to another destination (STR #3222)</para></item>
        <item><para>The scheduler did not reset the current job file
when stopping a printer (STR #3226)</para></item>
        <item><para>The scheduler did not handle POSTs to custom CGIs
properly (STR #3221)</para></item>
        <item><para>The pdftops filter did not print landscape PDF
pages properly (STR #2881)</para></item>
        <item><para>The scheduler did not handle partial header lines
properly from CGI programs (STR #3194)</para></item>
        <item><para>The web interface could hang on OpenBSD (STR
#3176, STR #3196)</para></item>
        <item><para>The scheduler and cupsfilter utility did not
handle rules starting with a negation operator properly (STR
#3160)</para></item>
        <item><para>The scheduler and cupsfilter utility would crash
with certain MIME .types rules (STR #3159)</para></item>
        <item><para>httpSetField wasn't bracketing IPv6 numeric
addresses for the Host: field (STR #3164)</para></item>
        <item><para>The ServerName, if specified, was not treated as a
valid alias for the local system (STR #3167)</para></item>
        <item><para>"make epm" did not work (STR #3166)</para></item>
        <item><para>"lpstat -h server" showed non-shared printers (STR
#3147)</para></item>
        <item><para>"make check" did not work on Linux (STR
#3161)</para></item>
      </change>

      <change from="1.3.9" to="1.3.10">
        <item><para>Documentation fixes (STR #2994, STR #2995, STR
#3008, STR #3056, STR #3057)</para></item>
        <item><para>SECURITY: The scheduler now protects against DNS
rebinding attacks (STR #3118)</para></item>
        <item><para>SECURITY: Fixed TIFF integer overflow in image
filters (STR #3031)</para></item>
        <item><para>The scheduler did not support the job-hold-until
attribute with the Restart-Job operation (STR #3130)</para></item>
        <item><para>SECURITY: The PNG image reading code did not
validate the image size properly, leading to a potential buffer
overflow (STR #2974)</para></item>
        <item><para>The rastertohp driver did not set the 1-sided
printing mode when needed (STR #3131)</para></item>
        <item><para>Now use a wrapper program instead of our fork of
the Xpdf code to support printing of PDF files. The new wrapper
supports using Xpdf, poppler, or Ghostscript to convert PDF files to
PostScript (STR #3129)</para></item>
        <item><para>Long job names caused problems with some PJL
printers (STR #3125)</para></item>
        <item><para>The lpq command did not work when showing all
destinations (STR #3117)</para></item>
        <item><para>The scheduler used a codeset name of UTF8 which is
not supported on Solaris (STR #3113)</para></item>
        <item><para>cupsGetJobs() did not work with a NULL destination
(STR #3107)</para></item>
        <item><para>Fixed a localization problem for option choices
(incorrectly) named "Custom" (STR #3106)</para></item>
        <item><para>The fallback OpenSSL random number seeding would
not work (STR #3079)</para></item>
        <item><para>The scheduler might miss a child signal, causing
high CPU usage.</para></item>
        <item><para>The scheduler did not enforce quotas after the job
history was unloaded (STR #3078)</para></item>
        <item><para>The job-k-limit, job-page-limit, and
job-quota-period attributes could not be set using the lpadmin command
(STR #3077)</para></item>
        <item><para>httpSeparateURI() did not error out on URIs with a
missing port number after a colon.</para></item>
        <item><para>Fixed a Valgrind-detected initialization error
when creating a missing directory on startup.</para></item>
        <item><para>The scheduler did not always read all of the HTTP
headers from a CGI script/program.</para></item>
        <item><para>The scheduler did not always set the "air"
property in Bonjour/DNS-SD registrations.</para></item>
        <item><para>The scheduler incorrectly compared Mac OS X UUIDs
for access control, preventing access in certain
configurations.</para></item>
        <item><para>The IPP backend incorrectly reset the required
authentication to Kerberos when authentication failed.</para></item>
        <item><para>The scheduler no longer looks up the local
hostname by default; turn on hostname lookups to restore the previous
behavior.</para></item>
        <item><para>The scheduler did not always load MIME type rules
correctly (STR #3059)</para></item>
        <item><para>The test page did not format correctly on A4 paper
(STR #3060)</para></item>
        <item><para>The web interface sometimes incorrectly redirected
users to 127.0.0.1 (STR #3022)</para></item>
        <item><para>cupsPrintFile*() did not send the document
filename for single file submissions (STR #3055)</para></item>
        <item><para>The scheduler did not update the member-names
attribute when removing the last printer from a class.</para></item>
        <item><para>The scheduler did not report PPD Products with
parenthesis in them properly (STR #3046)</para></item>
        <item><para>The wrong italic fonts were listed in the UTF-8
charset file for the text filter.</para></item>
        <item><para>The backends did not return an OK status for the
CUPS_SC_CMD_GET_BIDI side-channel command (STR #3029)</para></item>
        <item><para>The scheduler did not purge jobs that were missing
a time-at-creation attribute, indicating a bad job control file (STR
#3030)</para></item>
        <item><para>The "-o job-hold-until=week-end" option did not
work properly (STR #3025)</para></item>
        <item><para>The Solaris USB printer device does not support
select or poll (STR #3028)</para></item>
        <item><para>The scheduler would crash if you exceeded the
MaxSubscriptions limit.</para></item>
        <item><para>The lp "-H immediate" option did not specify that
the job should not be held (STR #3013)</para></item>
        <item><para>The scheduler did not support the "Connection:
close" HTTP header (STR #3010)</para></item>
        <item><para>The mailto notifier didn't terminate messages
properly (STR #3011)</para></item>
        <item><para>Backends could spin trying to read back-channel
data (STR #3001)</para></item>
        <item><para>The HP-GL/2 filter was using the wrong default
colors (STR #2966)</para></item>
        <item><para>The scheduler incorrectly allowed Get-Jobs
operations without a printer-uri (STR #2996)</para></item>
        <item><para>The compression option was not being encoded
properly (STR #2997)</para></item>
        <item><para>Added a missing character map for
JIS-X0213/ShiftJIS.</para></item>
        <item><para>The scheduler now rejects ATTR: messages with
empty values.</para></item>
        <item><para>The scheduler could consume all CPU handling
closed connections (STR #2988)</para></item>
        <item><para>Fixed some configure script bugs with rc/xinetd
directories (STR #2970)</para></item>
        <item><para>The Epson sample driver PPDs contained errors (STR
#2979)</para></item>
      </change>

      <note type="installation">
        <para>CUPS requires a special user and group,
``<command>cups</command>'' by default, to run non-privileged
processes as (e.g. filters). The default can be changed by setting the
<command>User</command> and <command>Group</command> directive in the
<command>/etc${SB_INSTALL_PREFIX}/cupsd.conf</command> configuration file.</para>
        <para>Both BSD and System V printing commands are available
with the CUPS package to replace the system commands. Unfortunately,
the names are the same. Therefore, it is important for the path to the
CUPS replacement commands to be first in a users
<command>$PATH</command>.</para>
        <para>The default path for configuration files is
<command>/etc${SB_INSTALL_PREFIX}</command> and <command>/var${SB_INSTALL_PREFIX}</command>
for log files.</para>
        <para>Additional filters and drivers from the GIMP Print
package have been added. Due to the large number of additional PPD
files installed with the GIMP print package, the initial startup time
for <command>cupsd</command> may be delayed as the
<command>/etc${SB_INSTALL_PREFIX}/ppds.dat</command> file is built. Once this file
has been created, subsequent startup times will be greatly
reduced.</para>
      </note>

      <note type="configuration">
        <para>Documentation is available in
<command>${SB_INSTALL_PREFIX}/doc</command> to assist in configuring
CUPS.</para>
      </note>
    </notes>

    <changelog>
      <change date="2012 May 8" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add 64-bit runtime module</para></item>
      </change>
    </changelog>
  </program>
</programs>
