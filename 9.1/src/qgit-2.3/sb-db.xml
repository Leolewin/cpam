<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="qgit" version="2.3" revision="2">
    <build-name>${SB_PROG_NAME}</build-name>

    <install-name>${SB_PROG_NAME}23</install-name>

    <sources>
      <source checksum="1f6cd60cc1b92973718b108d542e3270"
        checksum-type="md5" size="206812"
        path="src/qgit-2.3.tar.bz2"/>
      <patch checksum="363e585f4728a9d78254d91d4452db7f"
        checksum-type="md5" size="1369"
        path="src/qgit.tww.patch"/>
    </sources>

    <dependencies>
      <depend program="qt" var="LIBQT" install-name="libqt47"
        add-path="prepend">v&gt;=4.7.4</depend>
      <depend program="gcc" install-name="gcc44" add-path="prepend"
        systype="hppa*-hpux*|*-osf*|*-solaris2.8">v&gt;=4.4.6</depend>
      <depend var="GCC_RT" install-name="gcc44r"
        systype="hppa*-hpux*|*-osf*|*-solaris2.8"/>
    </dependencies>

    <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-blibpath:/usr/lib"

  _platform="aix-xlc" ;;
ia64*-hpux*)
  CC_LD_RT="-Wl,+b,"

  _platform="hpuxi-acc-32" ;;
*-hpux*)
  CC_LD_RT="-Wl,+s,+b,"

  _platform="hpux-g++" ;;
*-irix*)
  CC_LD_RT="-Wl,-rpath,"

  _platform="irix-cc" ;;
x86_64*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  _platform="linux-g++-64" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  _platform="linux-g++" ;;
*-osf*)
  CC_LD_RT="-Wl,-rpath,"

  _platform="tru64-g++" ;;
i?86*-solaris*)
  CC_LD_RT="-Wl,-R,"

  _platform="solarisx86-cc59" ;;
*-solaris2.8)
  CC_LD_RT="-Wl,-R,"

  _platform="solaris-g++" ;;
*-solaris*)
  CC_LD_RT="-Wl,-R,"

  _platform="solaris-cc59" ;;
esac

_gccsubdir="gcc44"

case "${SB_SYSTYPE}" in
hppa*-hpux*|*-osf*|*-solaris2.8)
  _libqt_inc="${SB_VAR_LIBQT}/include/${_gccsubdir}"
  _libqt_lib="${SB_VAR_LIBQT}/lib/${_gccsubdir}"
  _libqt_uic_path="${SB_VAR_LIBQT}/bin/uic" ;;
esac

LDFLAGS="${SB_VAR_GCC_RT+${CC_LD_RT}${SB_VAR_GCC_RT_LIB}} \
${LDFLAGS+${LDFLAGS}}"

export DOTQTDIR=${SB_BUILD_PREFIX}
export QMAKESPEC=${_platform}
export QTDIR=${SB_VAR_LIBQT}
]]>
    </script-header>

    <configure>
<![CDATA[
${SB_PATH_SED} -i -e "\
s!~/bin!${SB_INSTALL_PREFIX}/bin!" qgit.pro src/src.pro

${SB_VAR_LIBQT}/bin/qmake qgit.pro
(cd src && ${SB_VAR_LIBQT}/bin/qmake src.pro)

${SB_PATH_SED} -i -e "\
s!${SB_VAR_LIBQT}/bin/uic!${_libqt_uic_path:-${SB_VAR_LIBQT}/bin/uic}!g; \
s!${SB_VAR_LIBQT}/include!${_libqt_inc:-${SB_VAR_LIBQT}/include}!g; \
s!${SB_VAR_LIBQT}/lib!${_libqt_lib:-${SB_VAR_LIBQT}/lib}!g; \
s! ${CC_LD_RT}${SB_BUILD_PREFIX}/lib!!; \
s!^LFLAGS\(.*\)!LFLAGS\1${LDFLAGS+ ${LDFLAGS}}!;" \
$(${SB_PATH_FIND} ${SB_BUILD_PREFIX} -name 'Makefile*')
]]>
    </configure>

    <build>
<![CDATA[
gmake UIC="${_libqt_uic_path:-${SB_VAR_LIBQT}/bin/uic}"
]]>
    </build>

    <licenses>
      <license path="gpl-2.license"/>
    </licenses>

    <changelog>
      <change date="2012 January 20" revision="2"
      author="Gary V. Vaughan" email="gary@thewrittenword.com">
        <item><para>Remove support for HPUX 10.20.</para></item>
        <item><para>Remove support for Solaris 2.6 and 7.</para></item>
        <item><para>Solaris 2.9 now builds with native C++ compiler
instead of g++.</para></item>
        <item><para>OSF now builds with g++ instead of native C++
compiler.</para></item>
        <item><para>Update gcc dependency from 4.2.4 to
4.4.6.</para></item>
        <item><para>Update qt dependency from 4.4.3 to
4.7.4.</para></item>
      </change>
    </changelog>
  </program>
</programs>
