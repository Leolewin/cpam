<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="xmcd" version="3.3.1" revision="7">
    <build-name>${SB_PROG_NAME}-3.3.0</build-name>

    <install-name>${SB_PROG_NAME}33</install-name>

    <sources>
      <source checksum="0108b6f99342e31a11f22d54b87f89f8"
        checksum-type="md5" size="1059012"
        path="src/xmcd-3.3.0.tar.gz"/>
      <patch checksum="038cfc478a117474eae2ce7202186f4a"
        checksum-type="md5" size="15022"
        path="src/xmcd-3.3.0.3.3.1.patch"/>
      <patch checksum="a81b136fb14cb4ca45cc589d9bb51954"
        checksum-type="md5" size="5444"
        path="src/xmcd-3.3.0.tww.patch"/>
    </sources>

    <script-header>
<![CDATA[
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
xmkmf -a
]]>
    </configure>

    <build>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CDEBUGFLAGS="" CCOPTIONS="-O2 -qmaxmem=-1 -qarch=com"
  EXTRA_LDOPTIONS="-blibpath:/usr/lib" ;;
ia64*-hpux*)
  CDEBUGFLAGS=+O2
  CCOPTIONS="-z +Onofltacc +Olit=all +Oentrysched +Odataprefetch \
+Onolimit -mt"
  EXTRA_LDOPTIONS="-Wl,+nodefaultrpath" ;;
*-hpux11.[01]*)
  CDEBUGFLAGS=+O2
  CCOPTIONS="-z +Onofltacc +Olit=all +DAportable +Oentrysched \
+Odataprefetch +Onolimit -mt" ;;
*-hpux*)
  CDEBUGFLAGS=+O2
  CCOPTIONS="-z +Onofltacc +Olit=all +Oentrysched +Odataprefetch \
+Onolimit -mt" ;;
i?86*-linux*)
  CDEBUGFLAGS=-O2
  CCOPTIONS="-mtune=pentiumpro -march=pentiumpro" ;;
*-osf*)
  CCOPTIONS="-msym -readonly_strings" ;;
i386*-solaris*)
  CDEBUGFLAGS=-xO2
  CCOPTIONS="-mr -Qn -xstrconst -xtarget=pentium4" ;;
*-solaris2.8)
  CDEBUGFLAGS=-xO2
  CCOPTIONS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa" ;;
*-solaris*)
  CDEBUGFLAGS=-xO2
  CCOPTIONS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis" ;;
esac

gmake -f Makefile.std MAKE=gmake ${CC+CC="${CC}"} \
${THREADS_CFLAGS+THREADS_CFLAGS="${THREADS_CFLAGS}"} \
${CCOPTIONS+CCOPTIONS="${CCOPTIONS}"} \
${CDEBUGFLAGS+CDEBUGFLAGS="${CDEBUGFLAGS}"} \
${EXTRA_LDOPTIONS+EXTRA_LDOPTIONS="${EXTRA_LDOPTIONS}"}
]]>
    </build>

    <install>
<![CDATA[
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_docdir}

BATCH_BINDIR=${SB_INSTALL_PREFIX}/bin \
BATCH_XMCDLIB=${SB_INSTALL_PREFIX}/lib \
BATCH_DISCOGDIR=${SB_INSTALL_PREFIX}/lib/discog \
BATCH_MANDIR=${SB_INSTALL_PREFIX}/man/man1 \
BATCH_MANSUFFIX=1 \
sh ./install.sh -n -b

# Fix installation directory
rm -rf ${SB_INSTALL_PREFIX}/bin ${INSTALL_PREFIX}/lib/lib-*
mv ${SB_INSTALL_PREFIX}/lib/docs/* ${_docdir}
rm -rf ${SB_INSTALL_PREFIX}/lib/docs
mv ${SB_INSTALL_PREFIX}/lib/bin* ${INSTALL_PREFIX}/bin
rm ${SB_INSTALL_PREFIX}/bin/README

${SB_PATH_CHOWN} -hR 0:0 ${SB_INSTALL_PREFIX}
]]>
    </install>

    <notes>
      <change from="3.3.0" to="3.3.1">
        <items name="OS Support changes">
          <item><para>Changed libdi_d/Imakefile and cdda_d/Imakefile
to fix a compilation problem on Linux 2.6.x</para></item>
          <item><para>Added some fixes for recent FreeBSD 5.x
versions:</para>
          <unorderedlist>
            <item><para>The ATAPI CD device driver no longer supports
the CDIOCREADAUDIO ioctl. Xmcd/cda will now automatically use either
the CDIOCREADAUDIO ioctl or the pread(2) system call for CDDA reads,
based on the running kernel version. The user can set the environment
variable CDDA_USE_PREAD to 0 or 1 to force xmcd/cda to use
CDIOCREADAUDIO ioctl or pread(2), respectively.</para></item>
            <item><para>The <command>/dev/rcd0c</command> and
<command>/dev/racd0c</command> device nodes have been deprecated. The
config.sh now detects the absence of these and will use the new
<command>/dev/cd0</command> and <command>/dev/acd0</command> nodes as
the default instead.</para></item>
          </unorderedlist></item>
        </items>
      </change>

      <change from="3.2.1" to="3.3.0">
        <items name="CD-ROM drive support changes">
          <item><para>Added the following SCSI CD drives to the
support table:</para>
          <unorderedlist>
            <item><para>IBM GCC-4240N (laptop drive)</para></item>
            <item><para>HP CD Writer+ 9600S</para></item>
            <item><para>Plextor PX-W8222T</para></item>
          </unorderedlist></item>
        </items>

        <items name="OS Support changes">
          <item><para>AIX 5.x is now officially
supported</para></item>
          <item><para>Added POSIX 1003.1c threads method for
multithreading CDDA operations in addition to the original System V
IPC method. This code is enabled on OS platforms that support
preemptive pthreads. The method is configured via the cddaMethod
parameter in the device.cfg file. See the comments in the device.cfg
file for details, as well as the RELNOTES file. As a part of this
enhancement, source code changes and rearrangements were made in the
cdda_d directory to improve modularity.</para></item>
          <item><para>Added CDDA modes support for the OpenVMS
platform. This is implemented using the pthreads method. The
installvms.com, seldrive.com and instweb.com command procedures have
been enhanced.</para></item>
          <item><para>For OpenVMS, all the makevms.com command
procedures in the xmcd source code kit have been deprecated. In their
place are descrip.mms "makefiles" which can be used with the MMS
command to build xmcd. There is also a new top level makevms.com
command procedure that is generated from descrip.mms, for use by those
who do not have MMS.</para></item>
          <item><para>Fixed some xmcd problems on OpenVMS:</para>
          <unorderedlist>
            <item><para>Saving and deleting track
programs</para></item>
            <item><para>CD information local cache
handling</para></item>
            <item><para>HTTP proxy authorization
handling</para></item>
            <item><para>Local Discography .m3u and .pls playlist file
creation</para></item>
          </unorderedlist></item>
          <item><para>Added a workaround for an incompatibility
between gcc and SGI IRIX's libc ABI. The problem was causing xmcd and
cda to hang when attempting CDDA operations in SysVIPC method, and
eventually getting a "Read thread failure" error.</para></item>
          <item><para>Modifications to support API changes in Linux
ALSA 1.0.0, while remaining source-code compatible to ALSA 0.9.x.
Also, fixed a bug in the ALSA support code that caused the xmcd
balance control "Center" button to be ineffective in "CDDA playback"
mode.</para></item>
          <item><para>The old SGI audio library API is now
auto-detected and supported. This makes it possible to do CDDA
playback on IRIX 5.x.</para></item>
          <item><para>Fixed a problem on SGI IRIX, where during CDDA
playback mode, the xmcd volume control slider would move by itself to
0 when it's set to a low volume</para></item>
          <item><para>Added code to support CDDA playback hardware
volume control on the Digital OSF1/Tru64 Unix and OpenVMS platforms.
Note, though, that the audio driver and hardware may or may not
support this capability.</para></item>
        </items>

        <items name="Other changes">
          <item><para>Xmcd now displays the CD's Media Catalog Number
(MCN) in the disc details window, if this information is recorded on
the media and the drive supports reading it. Similarly, xmcd now
attempts to read each track's International Standard Recording Code
(ISRC) from the CD. If successful, xmcd will display this information
in the track details window. Otherwise, if the CDDB2 service provided
the ISRC information, it is shown instead.</para>
          <para>New device-specific parameters, mcnDisable and
isrcDisable, are added to allow this feature to be turned off. This is
useful in the event that an attempt to read the MCN or the ISRC data
would cause the CD drive to misbehave.</para>
          <para>Note: Reading the ISRC may take some time, especially
if the CD has many tracks, because the drive must seek to each track
to read the data</para></item>
          <item><para>Added the following output formats to the "CDDA
save to file" and "CDDA pipe to program" modes:</para>
          <screen>
.flac   (FLAC lossless compressed format)
.aac    (MPEG-2 or MPEG-4 AAC)
.mp4    (MPEG-4 AAC in MP4 container format)
          </screen>
          <para>Support for the FLAC format is enabled when xmcd/cda
are compiled and linked with the FLAC library. Support for the AAC and
MP4 formats are enabled if the running system has the FAAC encoder
program installed.</para>
          <para>Several common.cfg parameter have been generalized
and/or renamed:</para>
          <unorderedlist>
            <item><para>compressionMode: This is generalized to be
file-format specific. For the specific meanings of each mode, see the
xmcd help screen for the Encoding menu, or see the comments in the
common.cfg file.</para></item>
            <item><para>compressionAlgorithm: This is new to replace
the old mp3Algorithm parameter</para></item>
            <item><para>channelMode: This is new to replace the old
mp3Mode parameter</para></item>
          </unorderedlist>
          <para>Also, several parameters that previously had an effect
only with the MP3 format now also works with the FLAC, AAC and MP4
formats. See the comments in the common.cfg file for details.</para>
          <para>Similarly, the some command line arguments and
sub-commands have been changed for xmcd and cda. The "filefmt" command
now has new additional file type sub-arguments, the "compress" command
now takes different sub-arguments, and the "mp3" command has been
renamed "coding". See the xmcd and cda man pages for
details.</para></item>
          <item><para>Added a new "LAME MP3 options" section to the
options window, which allows the user to specify direct command line
options to be passed to the lame encoder. This facilitates the
ability to use some advanced or experimental LAME features that cannot
be otherwise accessed via the Encoding Parameters controls. In
addition, support for a new "lameopts" command is added to the xmcd
command line.</para>
          <para>Similarly, a cda "lameopts" command has been added to
provide the same feature</para>
          <para>The common.cfg file now has two new parameters to
support setting the default values of this functionality:
lameOptionsMode and lameOptions. See the comments in the common.cfg
file for details.</para></item>
          <item><para>In the "Channel routing" section of the xmcd
Options window, there is now a "CDDA playback output port" selector to
allow on-the-fly changing of this setting. Xmcd and cda also now both
support the new "outport" command on the command line. Note that this
feature is only meaningful on some platforms and architectures. See
the PLATFORM file for details. Due to this new feature, the -outport
command line option had become redundant and thus removed from both
xmcd and cda.</para></item>
          <item><para>In the "Volume &amp; balance" section of the
xmcd Options window, there is now a "CDDA level attenuator" slider
control. This allows the digital audio amplitude to be attenuated
before being sent to all CDDA outputs ("CDDA playback", "CDDA save to
file", and "CDDA pipe to program"). If the file format is a compressed
format, the attenuation occurs prior to encoding. Note that this is
different than the volume control slider on the xmcd main window,
which operates on hardware settings.</para>
          <para>In addition, xmcd also has new CDDA fade-out and
fade-in buttons for automatic CDDA level fading. Each additional
click on these buttons will speed up the fade operation.</para>
          <para>Xmcd and cda now both also support the new "cdda_att"
command on the command line for the CDDA level attenuator
feature</para>
          <para>Note that the setting of the CDDA level attenuator is
not saved along with other options. It always reverts to 100% after
restarting xmcd/cda.</para></item>
          <item><para>CD information tagging for the Ogg Vorbis and
FLAC formats now includes record label, BPM, MCN and ISRC information,
if available</para></item>
          <item><para>If saving CDDA to a file in the FLAC format,
xmcd/cda will add seek points to the file's seektable metadata area as
follows:</para>
          <unorderedlist>
            <item><para>If "file per track" mode is on, seek points
are added for the beginning of audio, and every 10 seconds (approx.)
thereafter</para></item>
            <item><para>If "file per track" mode is off, seek points
are added for the beginning of audio, and at the starting location of
each track thereafter</para></item>
          </unorderedlist>
          <para>No seek points are added to the data emitted via a
pipe-to-program stream</para></item>
          <item><para>Fixed a segmentation fault crash that occurred
when xmcd/cda was running in CDDA save-to-file mode and the output
file name was too long and caused a string buffer
overrun.</para></item>
          <item><para>Fixed a memory fault crash that sometimes
occurred when xmcd/cda was running in a CDDA mode, and the channel
routing control was set to something other than
"normal".</para></item>
          <item><para>Fixed a problem with the volume control jumping
to a lower setting when using the REW or FF buttons in CDDA playback
mode.</para></item>
          <item><para>Enhanced CDDB2 UTF-8 character set conversion
handling. The charsetTranslation parameter has been renamed
charsetConvMode, and now has three possible values, allowing the user
to choose from one of the following:</para>
          <unorderedlist>
            <item><para>No conversion is applied</para></item>
            <item><para>Convert to ISO 8859-1</para></item>
            <item><para>Convert to a character set based on the
user's locale environment using iconv(3), if applicable</para></item>
          </unorderedlist>
          <para>In addition, the UTF-8 locale name for use by
iconv_open(3) is now configurable via the langUtf8 parameter. See the
comments in the common.cfg file for details.</para></item>
          <item><para>Fixed a bug with CDDB2 segments handling,
where if a CD's CDDB data contains segments with notes, xmcd fails to
display the segments correctly and also fails to display the track
names, etc.</para></item>
          <item><para>The xmcd-generated Local Discography HTML pages
is in UTF-8 encoding, it now puts in an META tag to indicate that
fact. The web browser can then auto-select the correct character set
encoding to display non-ASCII characters correctly.</para></item>
          <item><para>Ogg Vorbis file comments are now encoded in
UTF-8 as required in the specification, and MP3 id3 tags are encoded
in ISO 8859-1</para></item>
          <item><para>Enhanced the external encoder handling code to
detect the version of the lame and faac programs, and set the
appropriate command line arguments based on the version.</para></item>
          <item><para>It is no longer necessary for playback to be
stopped to enter shuffle mode in xmcd. However, if enabling shuffle
would cause a side effect (such as clearing a play program,
disengaging segment play mode, or restarting the playback), a dialog
box will pop-up to let the user confirm the change.</para></item>
          <item><para>Removed unsupported code which were surrounded
by USE_LIBMP3LAME</para></item>
          <item><para>For "classic" CDDB submissions, corrected the
submit server host name to "submit.cddb.com". Previously xmcd/cda used
"cddb.cddb.com", and while that currently works, that may change in
the future.</para></item>
          <item><para>During startup, xmcd now checks the user's
private X resource file for version conflicts. If such a conflict is
found, a helpful error message is displayed and xmcd will
abort.</para></item>
          <item><para>Xmcd now has the capability to automatically
display "Messages of the day" information, if any, from the xmcd MOTD
service. By default, xmcd will automatically check for messages once
after initial startup, and display messages, if any. This feature can
be disabled by setting the new autoMotdDisable parameter in the
common.cfg file to True. There is also a new wwwWarp menu entry to
manually bring up the Messages of the day.</para></item>
          <item><para>The xmcd information dialog window to show the
CDDA output file directory and the expanded output path name was not
formatted correctly when linked with Motif 1.1. This is now
fixed.</para></item>
          <item><para>Fixed a problem when running with "classic" CDDB
and HTTP proxy authorization. If the wrong username or password is
typed, xmcd/cda was not re-prompting the user to re-try.</para></item>
          <item><para>Improved validity checking on CD-TEXT data, if
any, that the CD drive returns.</para></item>
          <item><para>Many platform-specific feature configuration
definitions in the source code have been consolidated into a new
common_d/config.h header file. This reduces the clutter in the
Imakefiles and makes it easier to make adjustments.</para></item>
          <item><para>Other minor fixes, cleanup and changes to
enhance code modularity</para></item>
        </items>
      </change>

      <change from="3.2.0" to="3.2.1">
        <items name="CD-ROM drive support changes">
          <item><para>Jitter correction is now disabled by default,
because many older, slow drives do not work well with jitter
correction during CDDA playback. If you have a fast drive and you hear
clicks and popping noises, you should try enabling jitter
correction.</para></item>
          <item><para>Change the default setting for the "Play Audio
Track Index" command support to False when configuring for SCSI
emulation, since the this command appears to be obsolete and no longer
listed in the MMC specifications</para></item>
        </items>

        <items name="OS Support changes">
          <item><para>Incorporate some enhancements for SGI
IRIX:</para>
          <unorderedlist>
            <item><para>Added volume and balance control support when
running in "CDDA playback" mode</para></item>
            <item><para>Fixed to set the CDDA playback mode sampling
rate more appropriately</para></item>
            <item><para>Enhanced to exclusively reserve the CD drive
when the device is opened. This fixes the cooperation between the IRIX
volume manager (mediad) and xmcd.</para></item>
            <item><para>Add SGI desktop integration compile-time
option (via the -DUSE_SGI_DESKTOP define, see the INSTALL file for
details)</para></item>
            <item><para>The machine architecture is now hardwired to
"mips" on IRIX, no matter which CPU variation xmcd is installed
under</para></item>
          </unorderedlist></item>
          <item><para>Fixed a problem that caused xmcd and cda to
display the incorrect track and time when running in CDDA mode on the
Solaris platform</para></item>
          <item><para>Fixed the config.sh script to set the CDDA read
method correctly on FreeBSD when using ATAPI-CAM</para></item>
          <item><para>Modified Imakefiles to fix BSDI BSD/OS 3.x
support</para></item>
          <item><para>Fixed demo mode compilation error</para></item>
        </items>

        <items name="Other changes">
          <item><para>Implemented CDDB2 album primary language
selection and display</para></item>
          <item><para>On platforms that support delivering SIGWINCH to
an application when run in an X terminal window and the window size is
changed, cda has now been enhanced handles that in visual mode. Also,
the visual mode has been enhanced to handle the suspend (typically
Ctrl-Z) and resume (the "fg" shell command) job control operations
better than in previous versions.</para></item>
          <item><para>Fixed a bug that caused the permissions of
/dev/dsp to be set to zero on systems with the OSS sound driver (if
xmcd/cda is run as the root user). The same bug also affected
/dev/audio on Solaris and HP-UX and /dev/paud0/1 or /dev/baud0/1 on
AIX.</para></item>
          <item><para>Fix xmcd's Options -&gt; Automated functions -&gt; On
Exit selections. These were not working in the previous
release.</para></item>
          <item><para>If a proxy server is used for CDDB lookups and
the port is not 80, xmcd was using the wrong port. This is now
fixed.</para></item>
          <item><para>Fixed a problem where the data length field in a
CDDA output file header (in WAV, AIFF, and AIFC formats) is smaller
than what it should be. Also, there was a problem with xmcd's handling
of WAV file headers which is now fixed. These previously caused
difficulty playing xmcd-generated files with some
players.</para></item>
          <item><para>Added a charsetTranslation parameter to
common.cfg. This sets whether xmcd and cda should attempt a character
set translation between the CDDB2 UTF-8 data and the local
character set. The default is set to False.</para></item>
          <item><para>Added an acceptSingleFuzzy parameter to
common.cfg. If CDDB lookup yields only one inexact "fuzzy" match,
setting this parameter to True will cause xmcd/cda to simply accept
that entry. Setting this to False will cause a confirmation dialog box
to appear. The default is False, which is the same as the behavior in
previous versions.</para></item>
          <item><para>If cda is used with the -batch option, CDDB
lookups will now still be performed (previously, this was not the
case). However, if an inexact "fuzzy" match occurs, cda will
internally choose the first match rather than ask the
user.</para></item>
          <item><para>There was a problem when using xmcd/cda in CDDA
save-to-file mode and the "On-load: auto play" mode is also enabled.
If the CDDA output file path template contains tokens that requires
information looked up from the CDDB service, the write fails because
xmcd/cda attempted to create the file names before the names are
available from CDDB. This is now fixed. Under this circumstance, if
necessary, xmcd/cda will now wait until the CDDB data is available
before starting the playback.</para></item>
          <item><para>Saved program sequences were not being properly
handled by cda. This is now fixed.</para></item>
          <item><para>Fixed a bug that was causing the "cda volume"
command to seg fault under some circumstances</para></item>
          <item><para>Fixed cda so that it constructs proper filenames
when running in CDDA save-to-file mode, also some other minor
improvements</para></item>
          <item><para>The local discography page for some CDs are
generated with the wrong description in the link to the primary genre
index (at the bottom of the page). This is now fixed. Also, added a
link to the secondary genre index if applicable.</para></item>
          <item><para>Fixed a compilation error that occured when
-DNOREMOTE is defined in the cddb_d directory</para></item>
          <item><para>Other internal fixes, cleanup and
rearrangements</para></item>
        </items>
      </change>

      <note type="installation">
        <para>Redhat Linux requires the LessTif OSF/Motif library from
the Redhat PowerTools CD.</para>
      </note>

      <note type="configuration">
        <para>Xmcd must be configured before it can be used. There is
no "default" configuration due to the number of variables involved.
The script
"<command>${SB_INSTALL_PREFIX}/lib/config/config.sh</command>" must be
run to configure Xmcd. This script will add files to the Xmcd
installation tree and change existing configuration files. When this
occurs, the package management system will not "know" about the
existence of these files. Thus, when the package is removed, the
<command>${SB_INSTALL_PREFIX}</command> installation directory will
remain.</para>
      </note>
    </notes>

    <changelog>
      <change date="2009 October 19" revision="7"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Add support for HP-UX 11.31/PA</para></item>
        <item><para>Add support for AIX 6.1</para></item>
        <item><para>Add support for SLES 10</para></item>
      </change>

      <change date="2007 May 4" revision="6"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 5</para></item>
      </change>

      <change date="2007 August 7" revision="5"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Solaris 10/x86</para></item>
      </change>

      <change date="2005 November 29" revision="4"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for HP-UX 11.23/PA-RISC</para></item>
      </change>

      <change date="2005 June 14" revision="3"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Solaris 10/SPARC</para></item>
      </change>

      <change date="2004 November 4" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Don't build during configure step for Redhat Linux
7.1 to work around compiler hang building wwwwarp.c</para></item>
      </change>
    </changelog>
  </program>
</programs>
