<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="ImageMagick" version="6.6.6" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}-10</build-name>

    <install-name>imagemagick66</install-name>

    <sources>
      <source checksum="626b1ed21e3b42eb4436d484a2747f6e"
        checksum-type="md5" size="8914466"
        path="src/ImageMagick-6.6.6-10.tar.bz2"/>
      <patch checksum="8be27677ba64112c84034a5c8b1dc303"
        checksum-type="md5" size="26737"
        path="src/ImageMagick-6.6.6-10.tww.patch"/>
      <patch checksum="dd5657bb2479f4787f4102f352348998"
        checksum-type="md5" size="241"
        path="src/ImageMagick-6.6.6-10.perl_typemap.patch"/>
      <patch checksum="504bfaa19d170a28f6cfabd6d0e0a9f3"
        checksum-type="md5" size="4057647"
        path="src/ImageMagick-6.6.6-10.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="pkgconfig" install-name="pkgconfig02"
        add-path="prepend" type="build">v&gt;=0.25</depend>
      <depend program="ghostscript" var="GHOSTSCRIPT"
        install-name="ghostscript90"
        add-path="prepend">v&gt;=9.01</depend>
      <depend program="gnuplot" var="GNUPLOT"
        install-name="gnuplot44"
        add-path="prepend">v&gt;=4.4.4</depend>
      <depend program="transfig" var="TRANSFIG"
        install-name="transfig32"
        add-path="prepend">v&gt;=3.2.5</depend>
      <depend program="bzip2" var="BZIP2"
        install-name="bzip210">v&gt;=1.0.6</depend>
      <depend program="fonts" var="FONTS" install-name="fonts11"
        module="urw">v&gt;=1.1</depend>
      <depend program="fcpackage" var="FCPACKAGE"
        install-name="fcpackage28">v&gt;=2.8</depend>
      <depend program="fftw" var="LIBFFTW"
        install-name="libfftw33">v&gt;=3.3</depend>
      <depend program="freetype" var="LIBTTF" install-name="libttf24"
        add-path="prepend">v&gt;=2.4.6</depend>
      <depend program="jpeg" var="JPEG"
        install-name="libjpeg8">v&gt;=8b</depend>
      <depend program="lcms" var="LIBLCMS"
        install-name="liblcms21">v&gt;=2.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv113">v&gt;=1.13.1</depend>
      <depend program="libpng" var="LIBPNG"
        install-name="libpng14">v&gt;=1.4.4</depend>
      <depend program="libxml" var="LIBXML" install-name="libxml27"
        add-path="prepend">v&gt;=2.7.8</depend>
      <depend program="libwmf" var="LIBWMF" install-name="libwmf02"
        add-path="prepend">v&gt;=0.2.8</depend>
      <depend program="tiff" var="LIBTIFF"
        install-name="libtiff39">v&gt;=3.9.5</depend>
      <depend program="xpm" var="XPM"
        install-name="xpm">v&gt;=3.4k</depend>
      <depend program="zlib" var="LIBZ"
        install-name="libz12">v&gt;=1.2.5</depend>
    </dependencies>

    <validate>
      <depend program="ImageMagick"
        module="perl-5.12.2">v==6.6.6</depend>
      <depend program="ImageMagick" module="gcc44">v==6.6.6</depend>
    </validate>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_urw_fonts="${SB_VAR_FONTS}/share/urw"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib:${SB_INSTALL_PREFIX}/lib"
  CC_LD_RT="-Wl,-blibpath:"
  ARGS="--with-threads" ;;
ia64*-hpux*)
  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads"
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--without-threads"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC_LD_RT="-Wl,-rpath,"
  ARGS="--with-threads" ;;
i?86*-linuxe3)
  CFLAGS="-O2 -mcpu=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-osf*)
  CFLAGS="-O2 -mcpu=ev5"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CPPFLAGS="\
${SB_VAR_XPM+-I${SB_VAR_XPM_INC}} \
${SB_VAR_JPEG+-I${SB_VAR_JPEG_INC}} -I${SB_VAR_LIBLCMS_INC} \
${SB_VAR_LIBTIFF+-I${SB_VAR_LIBTIFF_INC}} \
${SB_VAR_LIBPNG+-I${SB_VAR_LIBPNG_INC}} \
${SB_VAR_LIBZ+-I${SB_VAR_LIBZ_INC}} \
${SB_VAR_BZIP2+-I${SB_VAR_BZIP2_INC}} \
${SB_VAR_LIBTTF+-I${SB_VAR_LIBTTF_INC}} \
${SB_VAR_LIBWMF+-I${SB_VAR_LIBWMF_INC}} \
${SB_VAR_LIBXML+-I${SB_VAR_LIBXML_INC}} \
${CPPFLAGS+${CPPFLAGS}}" CFLAGS="${CFLAGS:--O2}" ${CXX+CXX="${CXX}"} \
CXXFLAGS="${CXXFLAGS:--O2}" CXXCPP="${CXXCPP+${CXXCPP}}" \
LDFLAGS="${SB_VAR_XPM+-L${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+-L${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBLCMS+-L${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBTIFF+-L${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+-L${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+-L${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+-L${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBWMF+-L${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_LIBXML+-L${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBLCMS+${CC_LD_RT}${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBWMF+${CC_LD_RT}${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_XPM+${CC_LD_RT}${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+${CC_LD_RT}${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBTIFF+${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+${CC_LD_RT}${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+${CC_LD_RT}${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+${CC_LD_RT}${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBXML+${CC_LD_RT}${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="\
${SB_VAR_FCPACKAGE+${SB_VAR_FCPACKAGE_LIB}/pkgconfig:}\
${SB_VAR_LIBTTF+${SB_VAR_LIBTTF_LIB}/pkgconfig}" \
--enable-shared --enable-static --without-frozenpaths \
--with-perl --without-dps --with-gslib --without-gvc \
--without-rsvg --without-jbig --enable-libtool-verbose \
--disable-openmp --with-modules --with-gs-font-dir=${_urw_fonts} \
--datadir=${_datadir} --datarootdir=${_datadir} \
--disable-dependency-tracking \
${ARGS+${ARGS}} --docdir=${_docdir} \
--mandir="${SB_INSTALL_PREFIX}/man" \
--prefix=${SB_INSTALL_PREFIX}

(cd PerlMagick
 ${SB_VAR_PERL}/bin/perl Makefile.PL PREFIX=${_install_prefix})
]]>
    </configure>

    <build>
<![CDATA[
gmake -C PerlMagick
]]>
    </build>

    <test>
<![CDATA[
gmake -C PerlMagick test

: ignore test failures
]]>
    </test>

    <install>
<![CDATA[
gmake -C PerlMagick install INSTALLPRIVLIB=${_install_prefix} \
INSTALLSITEARCH=${_install_prefix} \
INSTALLSITEMAN3DIR="${SB_INSTALL_PREFIX}/man/man3"

rm -rf ${_install_prefix}/lib

# install path for Perl's include.paths.d
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d \
${_install_prefix}/include.paths.d
cat >${_install_prefix}/include.paths.d/99-${SB_PROG_NAME} <<_EOT_
${_install_prefix}
_EOT_
]]>
    </install>

    <uninstall>
<![CDATA[
rm -rf ${_install_prefix} ${SB_INSTALL_PREFIX}/man/man3
]]>
    </uninstall>

    <module name="default">
      <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_urw_fonts="${SB_VAR_FONTS}/share/urw"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc_r CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CXX=xlC_r CXXFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib:${SB_INSTALL_PREFIX}/lib"

  ARGS="--with-magick-plus-plus --with-threads" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-mt -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit +We901"
  CXX=aCC CXXFLAGS="-mt -AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CFLAGS="-mt -g -z" CXXFLAGS="-mt -z -AA -g"
  CC_LD_RT="-Wl,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-hpux10*)
  # At +O2 optimisation, coders/dds.c provokes a compiler SEGV
  CC=cc CFLAGS="-Ae -z +O1 +Ofltacc +ESlit +DAportable +Oentrysched"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--without-magick-plus-plus --without-threads" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-mt -z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch"
  CXX=aCC CXXFLAGS="-mt -AA -z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-hpux*)
  CC=cc CFLAGS="-mt -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-mt -AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CFLAGS="-mt -g -z" CXXFLAGS="-mt -z -AA -g"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-irix*)
  CC=c99 CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
i?86*-linuxe3)
  CFLAGS="-O2 -mcpu=pentiumpro -march=pentiumpro"
  CXX=g++ CXXFLAGS="-O2 -mcpu=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXX=g++ CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-linux*)
  CFLAGS="-O2"
  CXX=g++ CXXFLAGS="-O2"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -ieee -arch ev5 -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -model ansi -arch ev5 -ieee -msym \
-readonly_strings -timplicit_local -D__USE_STD_IOSTREAM"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CXX=CC CXXFLAGS="-xO2 -xtarget=pentium4"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -xarch=v8plusa"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -m32 -xarch=sparcvis"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CPPFLAGS="\
${SB_VAR_XPM+-I${SB_VAR_XPM_INC}} \
${SB_VAR_JPEG+-I${SB_VAR_JPEG_INC}} \
${SB_VAR_LIBLCMS+-I${SB_VAR_LIBLCMS_INC}} \
${SB_VAR_LIBTIFF+-I${SB_VAR_LIBTIFF_INC}} \
${SB_VAR_LIBPNG+-I${SB_VAR_LIBPNG_INC}} \
${SB_VAR_LIBZ+-I${SB_VAR_LIBZ_INC}} \
${SB_VAR_BZIP2+-I${SB_VAR_BZIP2_INC}} \
${SB_VAR_LIBFFTW+-I${SB_VAR_LIBFFTW_INC}} \
${SB_VAR_LIBTTF+-I${SB_VAR_LIBTTF_INC}} \
${SB_VAR_LIBWMF+-I${SB_VAR_LIBWMF_INC}} \
${SB_VAR_LIBXML+-I${SB_VAR_LIBXML_INC}} \
${CPPFLAGS+${CPPFLAGS}}" CFLAGS="${CFLAGS:--O2}" ${CXX+CXX="${CXX}"} \
CXXFLAGS="${CXXFLAGS:--O2}" CXXCPP="${CXXCPP+${CXXCPP}}" \
LDFLAGS="${SB_VAR_XPM+-L${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+-L${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBLCMS+-L${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBTIFF+-L${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+-L${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+-L${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBFFTW+-L${SB_VAR_LIBFFTW_LIB}} \
${SB_VAR_LIBTTF+-L${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBWMF+-L${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_LIBXML+-L${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBLCMS+${CC_LD_RT}${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBWMF+${CC_LD_RT}${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_XPM+${CC_LD_RT}${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+${CC_LD_RT}${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBTIFF+${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+${CC_LD_RT}${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+${CC_LD_RT}${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+${CC_LD_RT}${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBXML+${CC_LD_RT}${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="\
${SB_VAR_FCPACKAGE+${SB_VAR_FCPACKAGE_LIB}/pkgconfig:}\
${SB_VAR_LIBTTF+${SB_VAR_LIBTTF_LIB}/pkgconfig}" \
--enable-shared --enable-static --without-frozenpaths \
--without-perl --without-dps --without-gslib --without-gvc \
--without-rsvg --without-jbig --enable-libtool-verbose \
--disable-openmp --with-modules --with-gs-font-dir=${_urw_fonts} \
--datadir=${_datadir} --datarootdir=${_datadir} \
--disable-silent-rules --disable-dependency-tracking \
--docdir=${_docdir} ${ARGS+${ARGS}} --libdir=${SB_INSTALL_PREFIX_LIB} \
--mandir="${SB_INSTALL_PREFIX}/man" --prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\)!-L\1 ${CC_LD_RT}\1!" \
magick/Magick-config wand/Wand-config

if [ "${CXX+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\)!-L\1 ${CC_LD_RT}\1!" \
  Magick++/bin/Magick++-config
fi

${SB_PATH_SED} -i "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" \
magick/ImageMagick.pc magick/MagickCore.pc \
Magick++/lib/Magick++.pc Magick++/lib/ImageMagick++.pc \
wand/MagickWand.pc
]]>
      </configure>

      <build>
<![CDATA[
gmake pkgdocdir=${_docdir}
]]>
      </build>

      <test>
<![CDATA[
gmake check

: ignore test failures
]]>
      </test>

      <install>
<![CDATA[
gmake install pkgdocdir=${_docdir}
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${_install_prefix} ${SB_INSTALL_PREFIX}/man/man3
]]>
      </uninstall>
    </module>

    <module name="perl-5.12.2">
      <dependencies replace="0">
        <depend program="ImageMagick">v==6.6.6</depend>
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v&gt;=4.4.6</depend>
        <depend program="perl" var="PERL"
          add-path="prepend">v==5.12.2</depend>
      </dependencies>

      <script-header replace="0">
<![CDATA[
_install_prefix="${SB_INSTALL_PREFIX_LIB}/perl5122"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib:${SB_INSTALL_PREFIX}/lib"
  CC_LD_RT="-Wl,-blibpath:"
  ARGS="--with-threads" ;;
ia64*-hpux*)
  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads"
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--without-threads"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC_LD_RT="-Wl,-rpath,"
  ARGS="--with-threads" ;;
i?86*-linuxe3)
  CFLAGS="-O2 -mcpu=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-osf*)
  CFLAGS="-O2 -mcpu=ev5"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CPPFLAGS="\
${SB_VAR_XPM+-I${SB_VAR_XPM_INC}} \
${SB_VAR_JPEG+-I${SB_VAR_JPEG_INC}} -I${SB_VAR_LIBLCMS_INC} \
${SB_VAR_LIBTIFF+-I${SB_VAR_LIBTIFF_INC}} \
${SB_VAR_LIBPNG+-I${SB_VAR_LIBPNG_INC}} \
${SB_VAR_LIBZ+-I${SB_VAR_LIBZ_INC}} \
${SB_VAR_BZIP2+-I${SB_VAR_BZIP2_INC}} \
${SB_VAR_LIBTTF+-I${SB_VAR_LIBTTF_INC}} \
${SB_VAR_LIBWMF+-I${SB_VAR_LIBWMF_INC}} \
${SB_VAR_LIBXML+-I${SB_VAR_LIBXML_INC}} \
${CPPFLAGS+${CPPFLAGS}}" CFLAGS="${CFLAGS:--O2}" ${CXX+CXX="${CXX}"} \
CXXFLAGS="${CXXFLAGS:--O2}" CXXCPP="${CXXCPP+${CXXCPP}}" \
LDFLAGS="${SB_VAR_XPM+-L${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+-L${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBLCMS+-L${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBTIFF+-L${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+-L${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+-L${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+-L${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBWMF+-L${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_LIBXML+-L${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBLCMS+${CC_LD_RT}${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBWMF+${CC_LD_RT}${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_XPM+${CC_LD_RT}${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+${CC_LD_RT}${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBTIFF+${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+${CC_LD_RT}${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+${CC_LD_RT}${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+${CC_LD_RT}${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBXML+${CC_LD_RT}${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="\
${SB_VAR_FCPACKAGE+${SB_VAR_FCPACKAGE_LIB}/pkgconfig:}\
${SB_VAR_LIBTTF+${SB_VAR_LIBTTF_LIB}/pkgconfig}" \
--enable-shared --enable-static --without-frozenpaths \
--with-perl --without-dps --with-gslib --without-gvc \
--without-rsvg --without-jbig --enable-libtool-verbose \
--disable-openmp --with-modules --with-gs-font-dir=${_urw_fonts} \
--datadir=${_datadir} --datarootdir=${_datadir} \
--disable-dependency-tracking \
${ARGS+${ARGS}} --docdir=${_docdir} \
--mandir="${SB_INSTALL_PREFIX}/man" \
--prefix=${SB_INSTALL_PREFIX}

(cd PerlMagick
 ${SB_VAR_PERL}/bin/perl Makefile.PL PREFIX=${_install_prefix})
]]>
      </configure>

      <build>
<![CDATA[
gmake -C PerlMagick
]]>
      </build>

      <test>
<![CDATA[
gmake -C PerlMagick test

: ignore test failures
]]>
      </test>

      <install>
<![CDATA[
gmake -C PerlMagick install INSTALLPRIVLIB=${_install_prefix} \
INSTALLSITEARCH=${_install_prefix} \
INSTALLSITEMAN3DIR="${SB_INSTALL_PREFIX}/man/man3"

rm -rf ${_install_prefix}/lib

# install path for Perl's include.paths.d
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d \
${_install_prefix}/include.paths.d
cat >${_install_prefix}/include.paths.d/99-${SB_PROG_NAME} <<_EOT_
${_install_prefix}
_EOT_
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${_install_prefix} ${SB_INSTALL_PREFIX}/man/man3
]]>
      </uninstall>
    </module>

    <module name="gcc44">
      <dependencies replace="0">
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v==4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"/>
      </dependencies>

      <script-header replace="0">
<![CDATA[
_gccsubdir="gcc44"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc"
  CXX=g++ CXXFLAGS="-O2 -mcpu=powerpc"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib:${SB_INSTALL_PREFIX}/lib"

  ARGS="--with-magick-plus-plus --with-threads" ;;
ia64*-hpux*)
  CXX=g++
  CC_LD_RT="-Wl,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-hpux10*)
  CXX=g++
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--without-magick-plus-plus --without-threads" ;;
*-hpux11.[01]*)
  CXX=g++
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-hpux*)
  CXX=g++
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--x-includes=/usr/include/X11R6 --x-libraries=/usr/lib/X11R6 \
--with-threads" ;;
*-irix*)
  CXX=g++
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXX=g++ CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-linux*)
  CFLAGS="-O2"
  CXX=g++ CXXFLAGS="-O2"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--with-threads" ;;
*-osf*)
  CFLAGS="-O2 -mcpu=ev4"
  CXX=g++ CXXFLAGS="-O2 -mcpu=ev4"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CXX=g++ CXXFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CXX=g++ CXXFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-R"

  ARGS="--with-threads" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CPPFLAGS="\
${SB_VAR_XPM+-I${SB_VAR_XPM_INC}} \
${SB_VAR_JPEG+-I${SB_VAR_JPEG_INC}} \
${SB_VAR_LIBLCMS+-I${SB_VAR_LIBLCMS_INC}} \
${SB_VAR_LIBTIFF+-I${SB_VAR_LIBTIFF_INC}} \
${SB_VAR_LIBPNG+-I${SB_VAR_LIBPNG_INC}} \
${SB_VAR_LIBZ+-I${SB_VAR_LIBZ_INC}} \
${SB_VAR_BZIP2+-I${SB_VAR_BZIP2_INC}} \
${SB_VAR_LIBTTF+-I${SB_VAR_LIBTTF_INC}} \
${SB_VAR_LIBWMF+-I${SB_VAR_LIBWMF_INC}} \
${SB_VAR_LIBXML+-I${SB_VAR_LIBXML_INC}} \
${CPPFLAGS+${CPPFLAGS}}" CFLAGS="${CFLAGS:--O2}" ${CXX+CXX="${CXX}"} \
CXXFLAGS="${CXXFLAGS:--O2}" CXXCPP="${CXXCPP+${CXXCPP}}" \
LDFLAGS="-L${SB_VAR_GCC_RT_LIB} \
${SB_VAR_XPM+-L${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+-L${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBLCMS+-L${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBTIFF+-L${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+-L${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+-L${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+-L${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBWMF+-L${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_LIBXML+-L${SB_VAR_LIBXML_LIB}} \
${CC_LD_RT}${SB_VAR_GCC_RT_LIB} \
${SB_VAR_LIBLCMS+${CC_LD_RT}${SB_VAR_LIBLCMS_LIB}} \
${SB_VAR_LIBWMF+${CC_LD_RT}${SB_VAR_LIBWMF_LIB}} \
${SB_VAR_XPM+${CC_LD_RT}${SB_VAR_XPM_LIB}} \
${SB_VAR_JPEG+${CC_LD_RT}${SB_VAR_JPEG_LIB}} \
${SB_VAR_LIBTIFF+${CC_LD_RT}${SB_VAR_LIBTIFF_LIB}} \
${SB_VAR_LIBPNG+${CC_LD_RT}${SB_VAR_LIBPNG_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_BZIP2+${CC_LD_RT}${SB_VAR_BZIP2_LIB}} \
${SB_VAR_LIBTTF+${CC_LD_RT}${SB_VAR_LIBTTF_LIB}} \
${SB_VAR_LIBXML+${CC_LD_RT}${SB_VAR_LIBXML_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="\
${SB_VAR_FCPACKAGE+${SB_VAR_FCPACKAGE_LIB}/pkgconfig:}\
${SB_VAR_LIBTTF+${SB_VAR_LIBTTF_LIB}/pkgconfig}" \
--enable-shared --enable-static --without-frozenpaths \
--without-perl --without-dps --without-gslib --without-gvc \
--without-rsvg --without-jbig --enable-libtool-verbose \
--disable-openmp --with-modules --with-gs-font-dir=${_urw_fonts} \
--datadir=${_datadir} --datarootdir=${_datadir} \
--disable-silent-rules \
--disable-dependency-tracking --docdir=${_docdir} \
${ARGS+${ARGS}} --libdir="${SB_INSTALL_PREFIX_LIB}/${_gccsubdir}" \
--mandir="${SB_INSTALL_PREFIX}/man" --prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\)!-L\1 ${CC_LD_RT}\1!" \
magick/Magick-config wand/Wand-config

if [ "${CXX+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\)!-L\1 ${CC_LD_RT}\1!" \
  Magick++/bin/Magick++-config
fi

${SB_PATH_SED} -i "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" \
magick/ImageMagick.pc magick/MagickCore.pc \
Magick++/lib/Magick++.pc Magick++/lib/ImageMagick++.pc \
wand/MagickWand.pc
]]>
      </configure>

      <build>
<![CDATA[
gmake pkgdocdir=${_docdir}
]]>
      </build>

      <test>
<![CDATA[
gmake check

: ignore test failures
]]>
      </test>

      <install>
<![CDATA[
gmake install-libLTLIBRARIES install-codersLTLIBRARIES \
install-configlibDATA install-filtersLTLIBRARIES \
install-pkgconfigDATA
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${_install_prefix} ${SB_INSTALL_PREFIX}/man/man3
]]>
      </uninstall>
    </module>

    <licenses>
      <license>
        <para>Copyright 1999-2011 ImageMagick Studio LLC, a non-profit
organization dedicated to making software imaging solutions freely
available.</para>
        <orderedlist>
          <item><para>Definitions.</para>
          <para>License shall mean the terms and conditions for use,
reproduction, and distribution as defined by Sections 1 through 9 of
this document.</para>
          <para>Licensor shall mean the copyright owner or entity
authorized by the copyright owner that is granting the License.</para>
          <para>Legal Entity shall mean the union of the acting entity
and all other entities that control, are controlled by, or are under
common control with that entity. For the purposes of this definition,
control means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such
entity.</para>
          <para>You (or Your) shall mean an individual or Legal Entity
exercising permissions granted by this License.</para>
          <para>Source form shall mean the preferred form for making
modifications, including but not limited to software source code,
documentation source, and configuration files.</para>
          <para>Object form shall mean any form resulting from
mechanical transformation or translation of a Source form, including
but not limited to compiled object code, generated documentation, and
conversions to other media types.</para>
          <para>Work shall mean the work of authorship, whether in
Source or Object form, made available under the License, as indicated
by a copyright notice that is included in or attached to the work (an
example is provided in the Appendix below).</para>
          <para>Derivative Works shall mean any work, whether in
Source or Object form, that is based on (or derived from) the Work and
for which the editorial revisions, annotations, elaborations, or other
modifications represent, as a whole, an original work of authorship.
For the purposes of this License, Derivative Works shall not include
works that remain separable from, or merely link (or bind by name) to
the interfaces of, the Work and Derivative Works thereof.</para>
          <para>Contribution shall mean any work of authorship,
including the original version of the Work and any modifications or
additions to that Work or Derivative Works thereof, that is
intentionally submitted to Licensor for inclusion in the Work by the
copyright owner or by an individual or Legal Entity authorized to
submit on behalf of the copyright owner. For the purposes of this
definition, "submitted" means any form of electronic, verbal, or
written communication sent to the Licensor or its representatives,
including but not limited to communication on electronic mailing
lists, source code control systems, and issue tracking systems that
are managed by, or on behalf of, the Licensor for the purpose of
discussing and improving the Work, but excluding communication that is
conspicuously marked or otherwise designated in writing by the
copyright owner as Not a Contribution.</para>
          <para>Contributor shall mean Licensor and any individual or
Legal Entity on behalf of whom a Contribution has been received by
Licensor and subsequently incorporated within the Work.</para></item>
          <item><para>Grant of Copyright License. Subject to the terms
and conditions of this License, each Contributor hereby grants to You
a perpetual, worldwide, non-exclusive, no-charge, royalty-free,
irrevocable copyright license to reproduce, prepare Derivative Works
of, publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.</para></item>
          <item><para>Grant of Patent License. Subject to the terms
and conditions of this License, each Contributor hereby grants to You
a perpetual, worldwide, non-exclusive, no-charge, royalty-free,
irrevocable patent license to make, have made, use, offer to sell,
sell, import, and otherwise transfer the Work, where such license
applies only to those patent claims licensable by such Contributor
that are necessarily infringed by their Contribution(s) alone or by
combination of their Contribution(s) with the Work to which such
Contribution(s) was submitted. If You institute patent litigation
against any entity (including a cross-claim or counterclaim in a
lawsuit) alleging that the Work or a Contribution incorporated within
the Work constitutes direct or contributory patent infringement, then
any patent licenses granted to You under this License for that Work
shall terminate as of the date such litigation is filed.</para></item>
          <item><para>Redistribution. You may reproduce and distribute
copies of the Work or Derivative Works thereof in any medium, with or
without modifications, and in Source or Object form, provided that You
meet the following conditions:</para>
          <orderedlist>
            <item><para>You must give any other recipients of the
Work or Derivative Works a copy of this License; and</para></item>
            <item><para>You must cause any modified files to carry
prominent notices stating that You changed the files;
and</para></item>
            <item><para>You must retain, in the Source form of any
Derivative Works that You distribute, all copyright, patent,
trademark, and attribution notices from the Source form of the Work,
excluding those notices that do not pertain to any part of the
Derivative Works; and</para></item>
            <item><para>If the Work includes a "NOTICE" text file as
part of its distribution, then any Derivative Works that You
distribute must include a readable copy of the attribution notices
contained within such NOTICE file, excluding those notices that do not
pertain to any part of the Derivative Works, in at least one of the
following places: within a NOTICE text file distributed as part of the
Derivative Works; within the Source form or documentation, if provided
along with the Derivative Works; or, within a display generated by the
Derivative Works, if and wherever such third-party notices normally
appear. The contents of the NOTICE file are for informational purposes
only and do not modify the License. You may add Your own attribution
notices within Derivative Works that You distribute, alongside or as
an addendum to the NOTICE text from the Work, provided that such
additional attribution notices cannot be construed as modifying the
License.</para></item>
          </orderedlist>
          <para>You may add Your own copyright statement to Your
modifications and may provide additional or different license terms
and conditions for use, reproduction, or distribution of Your
modifications, or for any such Derivative Works as a whole, provided
Your use, reproduction, and distribution of the Work otherwise
complies with the conditions stated in this License.</para></item>
          <item><para>Submission of Contributions. Unless You
explicitly state otherwise, any Contribution intentionally submitted
for inclusion in the Work by You to the Licensor shall be under the
terms and conditions of this License, without any additional terms or
conditions. Notwithstanding the above, nothing herein shall supersede
or modify the terms of any separate license agreement you may have
executed with Licensor regarding such Contributions.</para></item>
          <item><para>Trademarks. This License does not grant
permission to use the trade names, trademarks, service marks, or
product names of the Licensor, except as required for reasonable and
customary use in describing the origin of the Work and reproducing the
content of the NOTICE file.</para></item>
          <item><para>Disclaimer of Warranty. Unless required by
applicable law or agreed to in writing, Licensor provides the Work
(and each Contributor provides its Contributions) on an AS IS BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this
License.</para></item>
          <item><para>Limitation of Liability. In no event and under
no legal theory, whether in tort (including negligence), contract, or
otherwise, unless required by applicable law (such as deliberate and
grossly negligent acts) or agreed to in writing, shall any Contributor
be liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the Work
(including but not limited to damages for loss of goodwill, work
stoppage, computer failure or malfunction, or any and all other
commercial damages or losses), even if such Contributor has been
advised of the possibility of such damages.</para></item>
          <item><para>Accepting Warranty or Additional Liability.
While redistributing the Work or Derivative Works thereof, You may
choose to offer, and charge a fee for, acceptance of support,
warranty, indemnity, or other liability obligations and/or rights
consistent with this License. However, in accepting such obligations,
You may act only on Your own behalf and on Your sole responsibility,
not on behalf of any other Contributor, and only if You agree to
indemnify, defend, and hold each Contributor harmless for any
liability incurred by, or claims asserted against, such Contributor by
reason of your accepting any such warranty or additional
liability.</para></item>
        </orderedlist>

        <para>APPENDIX: How to apply the ImageMagick License to your
work</para>
        <para>To apply the ImageMagick License to your work, attach
the following boilerplate notice, with the fields enclosed by brackets
"[]" replaced with your own identifying information. (Don't include
the brackets!) The text should be enclosed in the appropriate comment
syntax for the file format. We also recommend that a file or class
name and description of purpose be included on the same "printed page"
as the copyright notice for easier identification within third-party
archives.</para>
        <screen>
Copyright [yyyy] [name of copyright owner]

   Licensed under the ImageMagick License (the "License"); you may not use
   this file except in compliance with the License.  You may obtain a copy
   of the License at

     http://www.imagemagick.org/script/license.php

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
   License for the specific language governing permissions and limitations
   under the License.
        </screen>
      </license>
    </licenses>

    <notes>
      <note type="usage">
        <para>The Image::Magick Perl binding is available in the
following directory:</para>
        <screen>
${SB_INSTALL_PREFIX}/lib/perl5122    # Perl 5.12.2
        </screen>

        <para>The directory is automatically added to the Perl
include.paths.d directory by the postinstall script.</para>
      </note>

      <platform name="HP-UX 11.00">
        <para>Patch <command>PHSS_22543</command> providing the
<command>libstd_v2</command> Standard C++ library is required as the
HP C++ compiler was used.</para>
      </platform>

      <platform name="Tru64 UNIX">
        <para>The latest C++ runtime library is required due to the
usage of the latest Compaq C++ compiler. It is available from the
following locations:</para>
        <unorderedlist>
          <item><para>package CXXREDIST651V37.tar in the support
directory of the CD</para></item>
          <item><para>online support directory <ulink url="ftp://support.thewrittenword.com/dists">ftp://support.thewrittenword.com/dists</ulink></para></item>
          <item><para>directly from Compaq at <ulink url="ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm">ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm</ulink></para></item>
        </unorderedlist>
      </platform>
    </notes>
  </program>
</programs>
