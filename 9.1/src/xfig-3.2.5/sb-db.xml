<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="xfig" version="3.2.5" revision="5">
    <build-name>${SB_PROG_NAME}.${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}32</install-name>

    <sources>
      <source checksum="fae0c67a3951bd41c057deb63b6aa47a"
        checksum-type="md5" size="5794801"
        path="src/xfig.3.2.5.full.tar.gz"/>
      <patch checksum="b5efc521dc873fa2c01f61cfa57d5229"
        checksum-type="md5" size="696"
        path="src/xfig.3.2.5.CVE-2010-4262.patch"/>
      <patch checksum="34004e22183fcaaf975c87133c45f6d3"
        checksum-type="md5" size="1721"
        path="src/xfig.3.2.5.fc-fix-eps-reading.patch"/>
      <patch checksum="4ad5d2ecc94c32e6b4891a60ecdc18c8"
        checksum-type="md5" size="16662"
        path="src/xfig.3.2.5.gnulib.patch"/>
      <patch checksum="e55e5208e2924548b810872be39f9ec6"
        checksum-type="md5" size="327"
        path="src/xfig.3.2.5.tww-gnulib.patch"/>
      <patch checksum="4c6c75679c95b6d189e43febaf083df2"
        checksum-type="md5" size="6992"
        path="src/xfig.3.2.5.tww.patch"/>
    </sources>

    <dependencies>
      <depend program="Xaw3d" var="LIBXAW3D"
        install-name="libxaw3d15">v&gt;=1.5e r&gt;=13</depend>
      <depend program="gcc" install-name="gcc44" add-path="prepend"
        systype="hppa*-hpux*|*-solaris2.[89]|*-osf*"
        type="build">v&gt;=4.4.6</depend>
      <depend program="jpeg" var="JPEG"
        install-name="libjpeg8">v&gt;=8b</depend>
      <depend program="libpng" var="LIBPNG"
        install-name="libpng14">v&gt;=1.4.4</depend>
      <depend program="xpm" var="XPM"
        install-name="xpm">v&gt;=3.4k</depend>
      <depend program="zlib" var="LIBZ"
        install-name="libz12">v&gt;=1.2.5</depend>
      <depend var="GCC_RT" install-name="gcc44r"
        systype="hppa*-hpux*|*-solaris2.[89]|*-osf*"/>
    </dependencies>

    <script-header>
<![CDATA[
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
xmkmf

# imake wants to put the system library path ahead of the TWW
# libraries, which makes the compiler choose system libraries instead
# of TWW libraries...
case "${SB_SYSTYPE}" in
*-linux*)
  ${SB_PATH_SED} -i -e '
s!USRLIBDIR = /usr/lib\(64\)\{0,1\}$!USRLIBDIR = dont-do-that!' Makefile
  ;;
esac
]]>
    </configure>

    <build>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib:/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  # error 1802: The _Complex type is not available on HP-PA systems.
  EXTRA_DEFINES="-DNO_COMPLEX_H -D_Complex_I=1.0fi \
-I/usr/contrib/X11R6/include"
  LDFLAGS="-L/usr/contrib/X11R6/lib"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-c99 -Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  # No _Complex implementation in vendor cc
  CFLAGS="-O2 -mcpu=ev5"
  EXTRA_DEFINES="-DNO_COMPLEX_H -D_Complex_I=1.0fi"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.[89])
  # No c99 complex type in sunstudio compiler for solaris 9 and older
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  EXTRA_DEFINES="-DNO_COMPLEX_H -D_Complex_I=1.0fi -Dlrint='(long)rint'"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  EXTRA_DEFINES="-DNO_COMPLEX_H"
  CC_LD_RT="-R" ;;
esac

gmake CC="${CC:-gcc}" CDEBUGFLAGS="${CFLAGS:--O2}" \
XAWLIB="${SB_VAR_LIBXAW3D+-L${SB_VAR_LIBXAW3D_LIB} \
${CC_LD_RT}${SB_VAR_LIBXAW3D_LIB}} -lXaw3d" \
${SB_VAR_LIBXAW3D+XAW3DINC=-I${SB_VAR_LIBXAW3D_INC}} \
${SB_VAR_XPM+XPMLIBDIR=${SB_VAR_XPM_LIB}} \
${SB_VAR_XPM+XPMINC=-I${SB_VAR_XPM_INC}} \
XPMLIBS="${SB_VAR_XPM+-L${SB_VAR_XPM_LIB} \
${CC_LD_RT}${SB_VAR_XPM_LIB}} -lXpm" \
${SB_VAR_JPEG+JPEGINCDIR="${SB_VAR_JPEG_INC}"} \
${SB_VAR_JPEG+JPEGLIBDIR="${SB_VAR_JPEG_LIB}"} \
JPEGLIB="${SB_VAR_JPEG+-L${SB_VAR_JPEG_LIB} \
${CC_LD_RT}${SB_VAR_JPEG_LIB}} -ljpeg" \
${SB_VAR_LIBPNG+PNGINCDIR="${SB_VAR_LIBPNG_INC} -I${SB_VAR_LIBZ_INC}"} \
${SB_VAR_LIBPNG+PNGLIBDIR="${SB_VAR_LIBPNG_LIB}"} \
PNGLIBS="${SB_VAR_LIBPNG+-L${SB_VAR_LIBPNG_LIB} -L${SB_VAR_LIBZ_LIB} \
${CC_LD_RT}${SB_VAR_LIBPNG_LIB}:${SB_VAR_LIBZ_LIB}} -lpng -lz" \
${SB_VAR_LIBZ+ZLIBDIR="${SB_VAR_LIBZ_LIB}"} \
EXTRA_LOAD_FLAGS="${SB_VAR_GCC_RT+-L${SB_VAR_GCC_RT_LIB} \
${CC_LD_RT}${SB_VAR_GCC_RT_LIB}} ${LDFLAGS+${LDFLAGS}}" \
${EXTRA_DEFINES+EXTRA_DEFINES="${EXTRA_DEFINES}"} \
EXTRA_LDOPTIONS="${SB_VAR_LIBXAW3D+-L${SB_VAR_LIBXAW3D_LIB}}" \
CCOPTIONS= LDPOSTLIB= LDPOSTLIBS= \
XFIGDOCDIR=${_docdir} XFIGLIBDIR=${SB_INSTALL_PREFIX}/lib
]]>
    </build>

    <install>
<![CDATA[
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_docdir}

gmake MAKE=gmake BINDIR="${SB_INSTALL_PREFIX}/bin" \
MANDIR="${SB_INSTALL_PREFIX}/man/man1" \
XFIGDOCDIR=${_docdir} XFIGLIBDIR="${SB_INSTALL_PREFIX}/lib" \
XAPPLOADDIR="${SB_INSTALL_PREFIX}/lib/app-defaults" \
INSTALL=${SB_PATH_INSTALL} MANNEWSUFFIX=man MANSUFFIX=1 \
install install.all

${SB_PATH_CHOWN} -R 0:0 ${SB_INSTALL_PREFIX}/lib/Libraries \
${_docdir}
]]>
    </install>

    <licenses>
      <license>
        <para align="center" skip="0">Brian V. Smith</para>
        <para align="center" skip="0">Lawrence Berkeley National
Laboratory</para>
        <para align="center" skip="0">xfig-bugs@epb1.lbl.gov</para>
        <para>Note that although I work at Lawrence Berkeley National
Laboratory (LBNL) I don't speak for LBNL nor do I represent LBNL with
respect to my work on TransFig and xfig, nor does LBL make any
representations about the suitability of this software for any
purpose.</para>
        <para>Here is the legal part:</para>
        <para>THE LAWRENCE BERKELEY NATIONAL LABORATORY DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL THE
AUTHORS BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES
OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,
WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION,
ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
SOFTWARE.</para>
        <para>And here is the copyright notice that you will find in
every source file:</para>
        <para skip="0">FIG : Facility for Interactive Generation of
figures</para>
        <para skip="0">Copyright (c) 1985-1988 by Supoj
Sutanthavibul</para>
        <para skip="0">Parts Copyright (c) 1989-2000 by Brian V.
Smith</para>
        <para skip="0">Parts Copyright (c) 1991 by Paul King</para>
        <para>Any party obtaining a copy of these files is granted,
free of charge, a full and unrestricted irrevocable, world-wide, paid
up, royalty-free, nonexclusive right and license to deal in this
software and documentation files (the "Software"), including without
limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons who receive copies from any such party to do so, with
the only requirement being that this copyright notice remain
intact.</para>
      </license>
    </licenses>

    <changelog>
      <change date="2012 January 16" revision="5"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Remove support for AIX 4.3, HP-UX 10.20, RHEL 3,
SLES, Solaris 6 and 7</para></item>
      </change>

      <change date="2011 May 5" revision="4"
      author="Gary V. Vaughan" email="gary@thewrittenword.com">
        <item><para>Update gcc dependency from 4.2.4 to
4.4.5</para></item>
        <item><para>Update libpng dependency from 1.2.9 to
1.4.4</para></item>
        <item><para>Update zlib dependency from 1.2.3 to
1.2.5</para></item>
      </change>

      <change date="2010 December 24" revision="3"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Apply patch for CVE-2010-4262 (<ulink url="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-4262">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-4262</ulink>).
A stack-based buffer overflow flaw was found in the way Xfig processed
certain FIG images. A remote attacker could create a FIG image with
specially-crafted color definition, and trick the local, unsuspecting
user into opening it, which could lead to xfig executable crash or,
potentially, arbitrary code execution with the privileges of the user
running the executable.</para></item>
      </change>

      <change date="2010 October 29" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>
    </changelog>
  </program>
</programs>
