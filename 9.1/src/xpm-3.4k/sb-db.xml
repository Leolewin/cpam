<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="xpm" version="3.4k" revision="18">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}</install-name>

    <sources>
      <source checksum="dd7c6df259912646671ab8cbd3fcafd7"
        checksum-type="md5" size="148887"
        path="src/xpm-3.4k.tar.gz"/>
      <patch checksum="1996f1ef2e307ce6017e65e068e9e5ef"
        checksum-type="md5" size="8358"
        path="src/xpm-3.4k.tww.patch"/>
      <patch checksum="4d5111b21e37ac23863315747e54cb21"
        checksum-type="md5" size="14286"
        path="src/xpm-3.4k.CVE-2004-0687_0688.patch"/>
      <patch checksum="491cfb57e11f50981f0f13e7a5fb14f6"
        checksum-type="md5" size="83418"
        path="src/xpm-3.4k.CVE-2004-0914.patch"/>
      <patch checksum="119cc73c55d055dc34c752f53e20d392"
        checksum-type="md5" size="1268"
        path="src/xpm-3.4k.CVE-2005-0605.patch"/>
    </sources>

    <module name="default">
      <validate>
        <depend program="xpm" module="64bit"
          systype="*-aix*|*-hpux11*|*-irix*|*-solaris2.[789]|*-solaris2.1?">v==3.4k</depend>
      </validate>

      <configure>
<![CDATA[
xmkmf -a
]]>
      </configure>

      <build>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  make CDEBUGFLAGS="-O2 -qmaxmem=-1 -qarch=ppc" \
  REQUIREDLIBS="-lX11" CC=xlc
  cd sxpm; rm -f sxpm
  make CC=xlc XPM_libdir="${SB_INSTALL_PREFIX}/lib \
-Wl,-blibpath:${SB_INSTALL_PREFIX}/lib:/usr/lib:/lib" ;;
*-osf*)
  make
  cd sxpm; rm -f sxpm
  make USR_libdirPATH=${SB_INSTALL_PREFIX}/lib ;;
ia64*-hpux*)
  make \
  CDEBUGFLAGS="-z +O2 +Onofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit" LOCAL_LDFLAGS="-Wl,+nodefaultrpath" \
  REQUIREDLIBS="-lX11"
  cd sxpm; rm -f sxpm
  make EXTRA_LOAD_FLAGS="-Wl,+b,${SB_INSTALL_PREFIX}/lib" ;;
*-hpux10*|*-hpux11.[01]*)
  make \
  CDEBUGFLAGS="-z +O2 +Onofltacc +ESlit +Oentrysched +DAportable \
+Odataprefetch +Onolimit" REQUIREDLIBS="-lX11"
  cd sxpm; rm -f sxpm
  make EXTRA_LOAD_FLAGS="-Wl,+s,+b,${SB_INSTALL_PREFIX}/lib" ;;
*-hpux*)
  make \
  CDEBUGFLAGS="-z +O2 +Onofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit" REQUIREDLIBS="-lX11"
  cd sxpm; rm -f sxpm
  make EXTRA_LOAD_FLAGS="-Wl,+s,+b,${SB_INSTALL_PREFIX}/lib" ;;
*-irix*)
  make CDEBUGFLAGS="-O2 -OPT:Olimit=0"
  cd sxpm
  make CDEBUGFLAGS="-O2 -OPT:Olimit=0" \
  LOCAL_LIBRARIES="-L../lib -lXpm -lXt -lSM -lICE -lXext -lX11" \
  USR_libdirPATH=${SB_INSTALL_PREFIX}/lib
  cd ../cxpm
  make ;;
x86_64*-linux*)
  make CDEBUGFLAGS="-O2" REQUIREDLIBS="-L/usr/X11R6/lib64 -lX11"
  cd sxpm; rm -f sxpm
  make CDEBUGFLAGS="-O2" XPM_libdir="${SB_INSTALL_PREFIX}/lib \
-Wl,-rpath,${SB_INSTALL_PREFIX}/lib" ;;
i?86*-linuxe[56]|i?86-suse-linux*)
  make CDEBUGFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro" \
  REQUIREDLIBS="-L/usr/X11R6/lib -lX11"
  cd sxpm; rm -f sxpm
  make CDEBUGFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro" \
  XPM_libdir="${SB_INSTALL_PREFIX}/lib \
-Wl,-rpath,${SB_INSTALL_PREFIX}/lib" ;;
*-linux*)
  make CDEBUGFLAGS="-O2" REQUIREDLIBS="-L/usr/X11R6/lib -lX11"
  cd sxpm; rm -f sxpm
  make CDEBUGFLAGS="-O2" XPM_libdir="${SB_INSTALL_PREFIX}/lib \
-Wl,-rpath,${SB_INSTALL_PREFIX}/lib" ;;
i?86*-solaris*)
  gmake MAKE=gmake \
  CDEBUGFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4" \
  REQUIREDLIBS="-L/usr/openwin/lib -lX11"
  (cd sxpm
   rm -f sxpm
   gmake CDEBUGFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4" \
   LOCAL_LDFLAGS="-L${SB_BUILD_PREFIX}/lib" \
   EXTRA_LOAD_FLAGS="-R${SB_INSTALL_PREFIX}/lib") ;;
*-solaris*)
  gmake MAKE=gmake CDEBUGFLAGS=-O REQUIREDLIBS="-L/usr/openwin/lib -lX11"
  (cd sxpm
   rm -f sxpm
   gmake CDEBUGFLAGS=-O LOCAL_LDFLAGS="-L${SB_BUILD_PREFIX}/lib" \
   EXTRA_LOAD_FLAGS="-R${SB_INSTALL_PREFIX}/lib") ;;
esac
]]>
      </build>

      <install>
<![CDATA[
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d \
${SB_INSTALL_PREFIX}/bin ${INSTALL_PREFIX}/lib \
${SB_INSTALL_PREFIX}/man/man1 ${INSTALL_PREFIX}/include

${SB_PATH_INSTALL} -m 644 -o root -g 0 lib/libXpm.a \
${SB_INSTALL_PREFIX}/lib
if [ -f "lib/libXpm.so.4.11" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so.4.11 \
  ${SB_INSTALL_PREFIX}/lib
  rm -f ${SB_INSTALL_PREFIX}/lib/libXpm.so
  ln -s ./libXpm.so.4.11 ${SB_INSTALL_PREFIX}/lib/libXpm.so
elif [ -f "lib/libXpm.so4.11" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so4.11 \
  ${SB_INSTALL_PREFIX}/lib
  rm -f ${SB_INSTALL_PREFIX}/lib/libXpm.so
  ln -s ./libXpm.so4.11 ${SB_INSTALL_PREFIX}/lib/libXpm.so
elif [ -f "lib/libXpm.sl" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.sl \
  ${SB_INSTALL_PREFIX}/lib
elif [ -f "lib/libXpm.so" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so \
  ${SB_INSTALL_PREFIX}/lib
fi

case "${SB_SYSTYPE}" in
*-aix[67]*)
  # /usr/lib/libXm.a loads libXpm.a. If runpath contains
  # ${SB_INSTALL_PREFIX_LIB}, our libXpm.a will be loaded
  # rather than /usr/lib/libXpm.a.
  rm ${SB_INSTALL_PREFIX_LIB}/libXpm.a ;;
*-linux*)
  ln -s ./libXpm.so.4.11 ${SB_INSTALL_PREFIX}/lib/libXpm.so.4 ;;
esac

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX}/include/X11
${SB_PATH_INSTALL} -m 644 -o root -g 0 lib/xpm.h \
${SB_INSTALL_PREFIX}/include/X11
# So <X11/Xpm.h> works too
[ ! -f "${SB_INSTALL_PREFIX}/include/xpm.h" ] && \
ln -s X11/xpm.h ${SB_INSTALL_PREFIX}/include/xpm.h

${SB_PATH_INSTALL} -m 755 -o root -g 0 cxpm/cxpm sxpm/sxpm \
${SB_INSTALL_PREFIX}/bin
${SB_PATH_INSTALL} -m 644 -o root -g 0 cxpm/cxpm.man \
${SB_INSTALL_PREFIX}/man/man1/cxpm.1
${SB_PATH_INSTALL} -m 644 -o root -g 0 sxpm/sxpm.man \
${SB_INSTALL_PREFIX}/man/man1/sxpm.1
]]>
      </install>
    </module>

    <module name="64bit"
    systype="*-aix*|*-hpux11*|*-irix*|*-solaris2.[789]|*-solaris2.1?">
      <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  _libdir="lib/ppc64" ;;
ia64*-hpux*)
  _libdir="lib/hpux64" ;;
*-hpux*)
  _libdir="lib/pa20_64" ;;
*-irix*)
  _libdir="lib64" ;;
i?86*-solaris*)
  _libdir="lib/amd64" ;;
*-solaris*)
  _libdir="lib/sparcv9" ;;
esac

case "${SB_SYSTYPE}" in
*-aix*)
  export OBJECT_MODE=64 ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-irix*)
  xmkmf -64 -mips4 -a ;;
*)
  xmkmf -a ;;
esac
]]>
      </configure>

      <build>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  make CDEBUGFLAGS="-O2 -q64 -qmaxmem=-1" \
  REQUIREDLIBS="-lX11" ;;
*-hpux*)
  make CDEBUGFLAGS="-z +O2 +Onofltacc +Olit=all +DD64 \
+Oentrysched +Odataprefetch +Onolimit" PICFLAGS="" \
  REQUIREDLIBS="-lX11" ;;
*-irix*)
  gmake MAKE=gmake CDEBUGFLAGS="-Wl,-woff,84 -O2 -OPT:Olimit=0" \
  LOCAL_LIBRARIES="-L../lib -lXpm -lXt -lSM -lICE -lXext -lX11" ;;
i?86*-solaris*)
  gmake MAKE=gmake CCOPTIONS="" PICFLAGS="-KPIC" \
  CDEBUGFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -xarch=amd64" \
  REQUIREDLIBS="-L/usr/openwin/lib -lX11" ;;
*-solaris*)
  gmake MAKE=gmake CCOPTIONS="" PICFLAGS="-KPIC" \
  CDEBUGFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -xarch=v9" \
  REQUIREDLIBS="-L/usr/openwin/lib -lX11" ;;
esac
]]>
      </build>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/lib/64 ]; then
  case "${SB_SYSTYPE}" in
  *-aix*|*-hpux*|*-solaris*)
    ln -s ./$(basename ${_libdir}) ${SB_INSTALL_PREFIX}/lib/64 ;;
  *-irix*)
    ln -s ../lib64 ${SB_INSTALL_PREFIX}/lib/64 ;;
  esac
fi

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX}/${_libdir}

cp lib/libXpm.a ${SB_INSTALL_PREFIX}/${_libdir}
if [ -f "lib/libXpm.so.4.11" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so.4.11 \
  ${SB_INSTALL_PREFIX}/${_libdir}
  rm -f ${SB_INSTALL_PREFIX}/${_libdir}/libXpm.so
  ln -s ./libXpm.so.4.11 ${SB_INSTALL_PREFIX}/${_libdir}/libXpm.so
elif [ -f "lib/libXpm.so4.11" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so4.11 \
  ${SB_INSTALL_PREFIX}/${_libdir}
  rm -f ${SB_INSTALL_PREFIX}/${_libdir}/libXpm.so
  ln -s ./libXpm.so4.11 ${SB_INSTALL_PREFIX}/${_libdir}/libXpm.so
elif [ -f "lib/libXpm.sl" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.sl \
  ${SB_INSTALL_PREFIX}/${_libdir}
elif [ -f "lib/libXpm.so" ]; then
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 lib/libXpm.so \
  ${SB_INSTALL_PREFIX}/${_libdir}
fi
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/lib/64 ${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <changelog>
      <change date="2010 December 17" revision="18"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Update gcc dependency from 4.2.4 to
4.4.5</para></item>
        <item><para>Add support for AIX 7.1</para></item>
        <item><para>Rebuild on AIX with -O2 -qmaxmem=-1
-qarch=ppc</para></item>
      </change>

      <change date="2010 October 23" revision="17"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>

      <change date="2009 January 14" revision="16"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Add support for SLES 10</para></item>
      </change>

      <change date="2008 September 16" revision="15"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 6.1</para></item>
      </change>

      <change date="2007 May 1" revision="14"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 5</para></item>
      </change>

      <change date="2006 May 12" revision="13"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Solaris 10/x86</para></item>
      </change>

      <change date="2005 November 18" revision="12"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for HP-UX 11.23/IA-64</para></item>
      </change>

      <change date="2005 September 17" revision="11"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for HP-UX 11.23/PA-RISC</para></item>
      </change>

      <change date="2005 April 26" revision="10"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for Solaris 10/SPARC</para></item>
      </change>

      <change date="2005 April 21" revision="9"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Apply patch for CAN-2004-0914 (<ulink url="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0914">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0914</ulink>),
fixing integer overflows, out-of-bounds memory accesses, directory
traversal, shell metacharacter, endless loops, and memory leaks, which
could allow remote attackers to obtain sensitive information, cause a
denial of service (application crash), or execute arbitary code via a
certain XPM image file.</para></item>
        <item><para>Apply patch for CAN-2005-0605 (<ulink url="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2005-0605">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2005-0605</ulink>),
fixing a potentially exploitable buffer overflow in
<command>scan.c</command> via a negative
<command>bitmap_unit</command> value. If an attacker tricked a user
into loading a malicious XPM image with an application that uses
libXpm, they could exploit this to execute arbitrary code with the
privileges of the user opening the image.</para></item>
      </change>

      <change date="2004 November 10" revision="8"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Apply patch to fix CAN-2003-0687 (<ulink url="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2003-0687">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2003-0687</ulink>),
stack-based buffer overflows in the xpmParseColors(),
ParseAndPutPixels(), and ParsePixels() functions allowing remote
attackers to execute arbitrary code via a malformed XPM image
file.</para></item>
        <item><para>Apply patch to fix CAN-2004-0688 (<ulink url="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2003-0688">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2003-0688</ulink>),
integer overflows in the xpmParseColors(),
XpmCreateImageFromXpmImage(), CreateXImage() ParsePixels(), and
ParseAndPutPixels() functions allowing remote attackers to execute
arbitrary code via a malformed XPM image file.</para></item>
      </change>

      <change date="2004 August 27" revision="7"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Search for X11 libraries on RHEL 3.0/AMD64 in
/usr/X11R6/lib64</para></item>
      </change>

      <change date="2003 May 19" revision="6"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Install shared library 755</para></item>
        <item><para>Include dependency on X11 library</para></item>
      </change>

      <change date="2003 April 4" revision="5"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 5.1 (same as AIX 4)</para></item>
        <item><para>Rebuild on AIX with "-O2 -qmaxmem=-1
-qarch=com"</para></item>
      </change>

      <change date="2003 January 30" revision="4"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Make include/xpm.h a link to include/X11/xpm.h
rather than a hard link to work around cross-directory link issues in
AFS</para></item>
      </change>
    </changelog>
  </program>
</programs>
