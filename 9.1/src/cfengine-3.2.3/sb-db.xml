<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="cfengine" version="3.2.3" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}323</install-name>

    <sources>
      <source checksum="be118dd95537221da38008845fc0d84a"
        checksum-type="md5" size="1128462"
        path="src/cfengine-3.2.3.tar.gz"/>
      <patch checksum="edc656df6dbf07e37b6f9f94dc0e25a2"
        checksum-type="md5" size="23268"
        path="src/cfengine-3.2.3.tww.patch"/>
      <patch checksum="bbf27f922b0f99de05d2df034fa7a490"
        checksum-type="md5" size="117103"
        path="src/cfengine-3.2.3.gnulib.patch"/>
      <patch checksum="ca13f530683a5aa7199dd2f5b4aba286"
        checksum-type="md5" size="342"
        path="src/cfengine-3.2.3.tww-gnulib.patch"/>
      <patch checksum="4a68676bb8b4d0aa3a26d52d0df68dcc"
        checksum-type="md5" size="1661158"
        path="src/cfengine-3.2.3.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend">v&gt;=2.4.3</depend>
      <depend program="db" var="LIBDB"
        install-name="libdb47">v&gt;=4.7.25</depend>
      <depend program="flex" var="FLEX" install-name="flex25"
        add-path="prepend" type="build">v&gt;=2.5.35</depend>
      <depend program="openssl" var="OPENSSL"
        install-name="libopenssl10">v&gt;=1.0.0e</depend>
      <depend program="pcre" var="LIBPCRE"
        install-name="libpcre811">v&gt;=8.11</depend>
      <depend program="tetex" install-name="tetex30"
        add-path="prepend" type="build">v&gt;=3.0</depend>
      <depend program="texinfo" install-name="texinfo413"
        add-path="prepend" type="build">v&gt;=4.13</depend>
      <depend program="perl" var="PERL"
        type="build">v==5.12.2</depend>
    </dependencies>

    <script-header>
<![CDATA[
_localstatedir="/var${SB_INSTALL_PREFIX}"

_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SYSTYPE}" in
*-aix*)
  CC=xlc_r CFLAGS="-O2 -ma -qlanglvl=extended -qmaxmem=-1 \
-qarch=ppc"
  LDFLAGS="-Wl,-brtl,-bnortllib,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch"
  CC_LD_RT="-Wl,+b," ;;
*-hpux11.11)
  CC=cc CFLAGS="-Ae -z +O2 +Ofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch"
  CC_LD_RT="-Wl,+s,+b,"

  export ac_cv_func_getaddrinfo=no ;;
*-hpux11.00)
  CC=cc CFLAGS="+O2 -Ae -z +ESlit +Ofltacc +DAportable \
+Oentrysched +Odataprefetch"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
 CC=c99 CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -nodtk -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBDB_INC} -I${SB_VAR_LIBPCRE_INC} \
${CPPFLAGS+${CPPFLAGS}}" LDFLAGS="-L${SB_VAR_FLEX_LIB} \
-L${SB_VAR_LIBPCRE_LIB} ${CC_LD_RT}${SB_VAR_LIBDB_LIB}:\
${SB_VAR_OPENSSL_LIB}:${SB_VAR_LIBPCRE_LIB} \
${LDFLAGS+${LDFLAGS}}" PERL=${SB_VAR_PERL}/bin/perl \
--without-sql --disable-silent-rules --disable-dependency-tracking \
--with-berkeleydb=${SB_VAR_LIBDB} --with-openssl=${SB_VAR_OPENSSL} \
--with-workdir=${_localstatedir} --docdir=${_docdir} \
--infodir="${SB_INSTALL_PREFIX}/info" \
--mandir="${SB_INSTALL_PREFIX}/man" --prefix=${SB_INSTALL_PREFIX}
]]>
    </configure>

    <build>
<![CDATA[
# include "conf.h" to get LFS flags before including <unistd.h>.
# avoids compile errors on AIX.
gmake -C src cf3lex.c

${SB_PATH_SED} -i -e "\
/begin standard C headers/ {
i\\
#include \"conf.h\"
i\\

}" src/cf3lex.c

gmake pkgdatadir=${_datadir}
]]>
    </build>

    <install>
<![CDATA[
gmake install pkgdatadir=${_datadir}

${SB_PATH_SED} -i -e "\
s!/var/cfengine!${_localstatedir}!g" \
${_datadir}/masterfiles/failsafe.cf

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_localstatedir}/bin \
${_localstatedir}/inputs ${_localstatedir}/lastseen \
${_localstatedir}/masterfiles ${_localstatedir}/outputs \
${_localstatedir}/reports ${_localstatedir}/state
${SB_PATH_INSTALL} -m 700 -o root -g 0 -d ${_localstatedir}/modules \
${_localstatedir}/ppkeys

for _bin in cf-agent cf-execd cf-promises cf-serverd; do
  ${SB_PATH_INSTALL} -m 755 -o root -g 0 \
  ${SB_INSTALL_PREFIX}/sbin/${_bin} ${_localstatedir}/bin
done
]]>
    </install>

    <uninstall>
<![CDATA[
rm -rf ${_localstatedir} ${SB_INSTALL_PREFIX}
]]>
    </uninstall>

    <licenses>
      <license>
        <para>This program is provided under the terms of the GNU
public license, with explicit permission to link with the OpenSSL
library.</para>
        <para>On some systems, code under the Frontier Artistic
License (/pub/snprintf) might become compiled. This is compatible with
the GPL.</para>
        <para>Users of the software may, at their option, choose the
COSL license below as part of the enterprise cfengine product.</para>
      </license>

      <license path="gpl-3.license"/>

      <license>
        <para align="center">COMMERCIAL OPEN SOURCE LICENSE</para>
        <para>This Cfengine commercial open source license ("COSL") is
entered into between Cfengine AS, a Norwegian company, as licensor,
having its registered address (at the time of writing) at
Forskningsparken, Oslo, Norway, business registration no. 892 847 282
("Cfengine") and</para>
        <orderedlist type="lower-alpha">
          <item><para>the Customer entity stipulated on the the
agreement front page ("Front page"),</para></item>
          <item><para>any entity or natural person downloading,
installing or taking the Software or any part of it into use,
or</para></item>
          <item><para>any entity or person who otherwise has agreed to
be bound by these terms (collectively the "Licensee").</para></item>
        </orderedlist>
        <orderedlist>
          <item><para>LICENSE</para>
          <orderedlist>
            <item><para>General</para>
            <para>The Software is licensed on a consecutive basis
(rental) or perpetually, as stipulated on the Front page. See 1.2 and
1.3 below respectively. The following shall apply to either type of
license grants.</para>
            <para>Subject to the terms of this COSL and other
agreement between the parties, Cfengine hereby grants to Licensee a
non-exclusive, non-transferable, non-sublicensable and limited license
to install, use, study and modify the number of copies of the Software
on the number of Instances stipulated on the Front page for use within
its organization.</para>
            <para>The number of Instances the Software may be
installed on may be changed by the Customer from time to time,
provided ample notice is given to Cfengine. See Front page for
reporting.</para>
            <para>The Licensee may modify, adapt and create
derivative works based upon the Software, for use within its
organisation and for sharing between other consecutive licensees under
the COSL. Therefore, the Licensee shall have access to the source code
of the Software. However, the Licensee shall not reproduce,
distribute, resell, rent, lease or disclose the Software in any manner
or form to any other third party not holding a COSL to the
Software.</para>
            <para>Licensee may not transfer any of its rights
under this COSL without the prior and express written consent of
Cfengine.</para>
            <para>Any Cfengine software component used by both the
Cfengine enterprise version and Cfengine community edition is licensed
under the terms of this COSL if the Licensee does not state in writing
to Cfengine that the Licensee instead wish to license the component in
question under the GNU General Public License (GPL) v.3.0 or other
applicable license.</para>
            <para>Third party software is licensed under the
license of such third party.</para></item>
            <item><para>Consecutive license grant (subscription)</para>
            <para>If the license grant is agreed to be consecutive
(see stipulation on Front page), it shall be effective for the period
the consecutive license fee (subscription fee) is paid and this
license is otherwise complied to. The payment of the consecutive
license fee entitles the Customer to Updates and New versions of the
Software (as stipulated in appendix 1).</para></item>
            <item><para>Perpetual license grant</para>
            <para>If the license grant is agreed to be perpetual
(see stipulation on Front page), the grant is for ever, provided the
license terms are complied to. The perpetual license grant is limited
to current the version of the Software at the Effective date. Updates
or New versions of the Software are not included, unless stated on the
Front page (subject to additional fee).</para></item>
          </orderedlist></item>
          <item><para>DEFINITIONS</para>
          <para>The following definitions shall apply to the
COSL:</para>
          <para>"Instances" means each physical or virtual computer
(server or client), onto which an installation of the Software takes
place.</para>
          <para>"New version" (of the Software) means a new edition of
the Software containing functionality or properties not present in the
previous edition of the Software.</para>
          <para>"Software" means:</para>
          <orderedlist type="lower-alpha">
            <item><para>the Cfengine enterprise edition Nova,
Constellation and Galaxy data centre administration software
downloaded by the Licensee or otherwise given access to including
bundled documentation and other material, as described at
www.cfengine.com/; and </para></item>
            <item><para>new versions and updates to such software
provided by Cfengine, and "Update" (of Software) means smaller
adjustments of the Software with the existing functionality, normally
by way of installation of new copy of the Software.</para></item>
          </orderedlist></item>
          <item><para>FEES</para>
          <para>The Licensee shall pay a license fee per Instance the
Software is installed on for the license granted herein;
either:</para>
          <orderedlist type="lower-alpha">
            <item><para>per time unit (as agreed) e.g. year, for
consecutive license grants, or </para></item>
            <item><para>once, for perpetual license grants, for the
number of Instances stated on the Front page, or any later
adjustments. See the Front page for further details.</para></item>
          </orderedlist></item>
          <item><para>INTELLECTUAL PROPERTY RIGHTS</para>
          <para>Cfengine and its suppliers does not by this COSL
transfer any copyrights or other intellectual property rights relating
to the Software to the Licensee. Such rights are protected by
intellectual property legislation in the United States, Europe and
other jurisdictions and by international treaty provisions. Cfengine
and its suppliers retain all rights in the Software that are not
expressly granted to the Licensee through this COSL.</para>
          <para>Licensee is not allowed to remove, alter or destroy any
proprietary, trademark or copyright markings or notices placed upon or
contained within the Software.</para></item>
          <item><para>TERMINATION</para>
          <para>Cfengine may terminate the COSL if the Licensee fails to
comply with the terms of this COSL, hereunder fails to pay the
stipulated fees. In the event of such termination, the Licensee shall
immediately stop using the Software, return any received media and
documentation, and destroy or permanently delete any installed
versions of the Software, and confirm such destruction or deletion in
writing within 7 days.</para></item>
          <item><para>IDEMNINFICATION</para>
          <para>If the Software (except for third party software) during
the term of the license grant is held by a court of competent
jurisdiction to infringe any third party intellectual property rights
and the Licensee incurs loss or expense as a result of such holding,
then Licenee's sole remedy shall be, and Cfengine will, at its option:
(i) obtain the right for Licensse to continue to use the Software
consistent with the COSL; (ii) modify the Software so that it becomes
non-infringing; (iii) replace the infringing component with a
non-infringing component, or (iv) refund monies paid by Licensee under
the Agreement during the prior six (6) months to the court holding
(for consecutive license grants) or a forth of any perpetual license
fee paid, and all Licensees rights and licenses under this Agreement
shall automatically terminate.</para>
          <para>The Licensee is aware that the Software is also
comprised of third party software, mostly open source software. Such
third party software are subject to its individual license terms, and
any claims shall be directed at the ultimate right holder to that
software. Consequently Cfengine is not liable for any defective title
in such third party software. See schedule 5 for a list of software
contained by the Software with related licenses.</para></item>
          <item><para>NO WARRANTY</para>
          <para>To the maximum extent permitted by law, Cfengine
disclaims any warranty for the Software (except as stated in clause
6). The Software, any services and any related documentation is
provided on an "as is" basis without warranty of any kind, whether
express or implied, including, but not limited to, implied warranties
of merchantability, fitness for a particular purpose or
non-infringement (except as stated in clause 6). Hereunder the parties
acknowledges that Cfengine does not warrant for the performance of any
data centre on which the Software runs, or the absence of any errors
in the Software, and that any such errors does not constitute a
contractual defect.</para></item>
          <item><para>LIABILITY</para>
          <para>The liability of the parties in contract, tort
(including negligence) or otherwise shall for all incidents during the
entire term of the COSL be limited to a fifth of the fees paid for a
perpetual license or the annual consecutive license fees paid for the
Software causing the damage or loss, up to a maximum of NOK 100 000.
Cfengine or its suppliers shall not be liable for any special,
incidental, indirect or consequential damages whatsoever (including,
without limitation, damages for loss of business profits, lost
savings, business interruption, loss of business information, personal
injury, loss of privacy, loss of goodwill or any other financial loss)
arising out of the use of or inability to use the Software, even if
advised of the possibility of such damages.</para></item>
          <item><para>THIRD-PARTY TERMS</para>
          <para>For third-party software that is made available to the
Licensee by Cfengine, the current terms of the relevant third party
software supplier shall apply.</para></item>
        </orderedlist>
      </license>
    </licenses>
  </program>
</programs>
