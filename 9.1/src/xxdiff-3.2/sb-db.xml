<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="xxdiff" version="3.2" revision="3">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}32</install-name>

    <sources>
      <source checksum="301ff399a1e4be8b68c38c3e27c0b1ad"
        checksum-type="md5" size="1341967"
        path="src/xxdiff-3.2.tar.bz2"/>
      <patch checksum="c179a5d3c81d2dacf4fc729373e6d411"
        checksum-type="md5" size="285387"
        path="src/xxdiff-3.2.tww.patch"/>
    </sources>

    <dependencies>
      <depend program="flex" install-name="flex25" add-path="prepend"
        type="build">v&gt;=2.5.35</depend>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="gcc" install-name="gcc44" add-path="prepend"
        systype="*-aix*|ia64*-hpux*|*-solaris*">v&gt;=4.4.6</depend>
      <depend program="qt" var="LIBQT" install-name="libqt33"
        add-path="prepend"
        systype="hppa*-hpux*|*-irix*|*-linux*|*-osf*">v&gt;=3.3.8</depend>
      <depend program="qt" var="LIBQT" install-name="libqt33"
        module="gcc44"
        systype="*-aix*|ia64*-hpux*|*-solaris*">v&gt;=3.3.8</depend>
      <depend program="qt" install-name="libqt33" module="gcc44"
        append="bin/gcc44" add-path="prepend"
        systype="*-aix*|ia64*-hpux*|*-solaris*">v&gt;=3.3.8</depend>
      <depend var="GCC_RT" install-name="gcc44r"
        systype="*-aix*|ia64*-hpux*|*-solaris*"/>
    </dependencies>

    <script-header>
<![CDATA[
_gccsubdir="gcc44"

export DOTQTDIR=${SB_BUILD_PREFIX}
export QTDIR=${SB_VAR_LIBQT-${_qtdir}}
]]>
    </script-header>

    <module name="default">
      <validate>
        <depend program="xxdiff"
          module="helper-scripts">v==3.2</depend>
      </validate>

      <script-header>
<![CDATA[
_gccsubdir="gcc44"

export DOTQTDIR=${SB_BUILD_PREFIX}
export QTDIR=${SB_VAR_LIBQT-${_qtdir}}
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  PLATFORM="aix-g++" ;;
ia64*-hpux*)
  PLATFORM="hpuxi-g++-32" ;;
*-hpux*)
  PLATFORM="hpux-acc" ;;
*-irix*)
  PLATFORM="irix-cc" ;;
x86_64*-linux*)
  PLATFORM="linux-g++-64" ;;
*-linux*)
  PLATFORM="linux-g++" ;;
*-osf*)
  PLATFORM="tru64-cxx" ;;
i?86*-solaris*)
  PLATFORM="solarisx86-g++" ;;
*-solaris*)
  PLATFORM="solaris-g++" ;;
esac

# vsnprintf() substitute for platforms without it
case "${SB_SYSTYPE}" in
*-osf*)
  grep tru64-cxx src/xxdiff.pro >/dev/null || {
    cat >>src/xxdiff.pro <<_EOT_
tru64-cxx:QMAKE_CXXFLAGS+= -model ansi -std gnu \
-D__USE_STD_IOSTREAM -DCOMPILER_COMPAQCXX
_EOT_
  }
  ;;
esac


case "${SB_SYSTYPE}" in
*)
  ${SB_PATH_SED} -i -e "\
s|@TRIO_SOURCES@||;" src/xxdiff.pro
  ;;
esac

case "${SB_SYSTYPE}" in
*-aix*|ia64*-hpux*|*-solaris*)
  _qt_inc="${SB_VAR_LIBQT_INC}/${_gccsubdir}"
  _qt_lib="${SB_VAR_LIBQT_LIB}/${_gccsubdir}"
  _qt_uic="${SB_VAR_LIBQT}/bin/${_gccsubdir}/uic" ;;
esac

QMAKESPEC=${PLATFORM} gmake -C src -f Makefile.bootstrap makefile

${SB_PATH_SED} -i -e "\
s!\$(QTDIR)/bin/uic!${_qt_uic:-${SB_VAR_LIBQT-${_qtdir}}/bin/uic}!g; \
s!\$(QTDIR)/include!${_qt_inc:-${SB_VAR_LIBQT-${_qtdir}}/include}!g; \
s!\$(QTDIR)/lib!${_qt_lib:-${SB_VAR_LIBQT-${_qtdir}}/lib}!g" \
src/Makefile
]]>
      </configure>

      <build>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  gmake -C src LFLAGS="-Wl,-brtl,\
-blibpath:${SB_VAR_GCC_RT_LIB}:/usr/lib" ;;
ia64*-hpux*)
  gmake -C src LFLAGS="-Wl,+b,${SB_VAR_GCC_RT_LIB}" ;;
*-solaris*)
  gmake -C src ${SB_VAR_GCC_RT+LFLAGS="-R${SB_VAR_GCC_RT_LIB}"} ;;
*)
  gmake -C src ;;
esac
]]>
      </build>

      <install>
<![CDATA[
${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${SB_INSTALL_PREFIX} \
${SB_INSTALL_PREFIX}/bin ${SB_INSTALL_PREFIX}/man/man1
${SB_PATH_INSTALL} -m 755 -o root -g 0 bin/xxdiff \
${SB_INSTALL_PREFIX}/bin
${SB_PATH_INSTALL} -m 755 -o root -g 0 src/xxdiff.1 \
${SB_INSTALL_PREFIX}/man/man1
]]>
      </install>
    </module>

    <module name="helper-scripts">
      <dependencies replace="0">
        <depend program="python" var="PYTHON"
          install-name="python26">v&gt;=2.6.7</depend>
      </dependencies>

      <script-header>
<![CDATA[
_install_prefix="${SB_INSTALL_PREFIX_LIB}/python"
]]>
      </script-header>

      <configure>
<![CDATA[
:
]]>
      </configure>

      <build>
<![CDATA[
${SB_VAR_PYTHON}/bin/python setup.py build
]]>
      </build>

      <install>
<![CDATA[
${SB_VAR_PYTHON}/bin/python setup.py install --skip-build \
--install-lib=${_install_prefix} --prefix=${SB_INSTALL_PREFIX}

for _bin in svn-foreign xx-diff-proxy xx-match xx-svn-diff \
xx-cond-replace xx-encrypted xx-pyline xx-svn-resolve \
xx-cvs-diff xx-filter xx-rename xx-cvs-revcmp \
xx-find-grep-sed xx-sql-schemas; do
  ${SB_PATH_SED} -i "2{i\

i\
import sys
i\

i\
sys.path.append(\"${_install_prefix}\")
i\

}" ${SB_INSTALL_PREFIX}/bin/${_bin}
done
]]>
      </install>
    </module>

    <licenses>
      <license path="gpl-2.license"/>
    </licenses>

    <notes>
      <change from="3.2b4" to="3.2">
        <item><para>Implemented an Python package that contains much
code to write scripts around xxdiff.  All the xxdiff-* scripts have
been integrated in the Python package and renamed for convenience.
New features: a warning is issued in decision when accepting or
rejecting, if incompatible selections have been made.  The build
system was converted from tmake to qmake.  Fixed a few minor
bugs.</para></item>
        <item><para>In decision mode, if there are at least one
selection from each side, if the user leaves with A or R, pop a
confirmation box.  This is important to avoid errors.  It is way too
easy to select for merge and exit with A.  I've been caught many
times. (dup: In decision mode, we should warn the user when selections
have been made and the user does not exit with
"merged".)</para></item>
        <item><para>Applied patch from for qt-3.0
compat.</para></item>
        <item><para>Applied changes from for Qt4
compilation.</para></item>
        <item><para>Added changes to add new feature
--prompt-for-files for Mac OSX startup with file dialog asking the
user what to diff.</para></item>
        <item><para>Applied patch for xxdiff.pro for Mac
OSX.</para></item>
        <item><para>Added a default binding for SaveAsMerged on
Ctrl+M, after I saw the comment from the Monotone docs.</para></item>
        <item><para>Finally ported the build system from tmake to
qmake!</para></item>
        <item><para>Caught error gracefully when xxdiff is missing in
the user's path.</para></item>
        <item><para>Fixed xx-cvs-diff review/accept mode (still need
to test it more).</para></item>
        <item><para>Changed the one-file input syntax from
xx-cond-replace: You must now always pass two parameters.  If you want
to get input from stdin, use - as the first argument.</para></item>
        <item><para>Ran pychecker and fixed a ton of little latent
bugs.</para></item>
      </change>

      <change from="3.2b3" to="3.2b4">
        <item><para>**ATTENTION ATTENTION** Renamed all the xxdiff-*
scripts to their equivalent xx-* scripts.  This is done to shorten the
names, and to clearly mark the transition between the old and the new
codebase.  I know it's evil, and I don't do this very often, but there
is so much code that is on top of xxdiff being called by these scripts
now, that to include the full xxdiff name in them does not make so
much sense anymore.  They all leverage xxdiff, but they do so much
more.  So there.  If you got annoyed by this, please send me email,
otherwise I'll never know.</para></item>
        <item><para>xx-rename: we now support multiple lists of rename
pairs in one run.</para></item>
        <item><para>Renamed cvs-revcomp to cvs-revcmp.</para></item>
        <item><para>Worked on xxdiff.el somewhat, not
finished.</para></item>
        <item><para>Integrated code from , so that cvsxxdiff.py is now
xxdiff-cvs-revcmp.  Thanks!</para></item>
        <item><para>Applied bug fixes for xxdiff-cvs-diff.</para></item>
        <item><para>Added documentation for
xxdiff-sql-schema</para></item>
      </change>

      <change from="3.2b1" to="3.2b3">
        <item><para>xxdiff/invoke.py: refactored the xxdiff invocation
functions to accept open files as stdin.</para></item>
        <item><para>xxdiff-svn-diff: Fixed bug with diff of
directories crashing: we're not ignoring directories and symlinks
appropriately.</para></item>
        <item><para>xxdiff-svn-diff: Implemented history for file
review.  xxdiff-svn-diff remembers the list of files it has already
viewed in previous sessions, as long as the list of pathnames
(considered as absolute) are the same.  This information is saved,
along with the merge comments in the user's $HOME/.xxdiff-svn-diff
directory under an appropriate hash.</para></item>
        <item><para>xxdiff-svn-diff: Allowed an explicitly specified
file (via --comments-file) to be recycled;  this is useful if you
interrupted the preview process and you do not want to lose the
comments you made.  By specifying the same filename, the file is not
overwritten and its contents are thus recycled.</para></item>
        <item><para>xxdiff-svn-diff: Ignoring the specified comments
file if it is within the Subversion directory that we want to diff.
So you can do this at the root of your checkout, and it works::
<command>xxdiff-svn-diff -cC .comments</command></para></item>
        <item><para>xxdiff-svn-diff: can optionally spawn a comments
editor window and commit after review.  A nice process to commit to
Subversion with this is this: <command>xxdiff-svn-diff
-fc</command></para>
        <para>This will:</para>
        <unorderedlist>
          <item><para>Run svn-foreign to handle unregistered files,
if necessary</para></item>
          <item><para>Asynchronously spawn an editor window with the
list of files to be reviewed, for you to write your merge comments
while you review your changes with the xxdiffs in the
background;</para></item>
          <item><para>Run the changes preview with
xxdiffs</para></item>
          <item><para>Wait for you editor to
terminate.</para></item>
          <item><para>Commit the changes to
Subversion.</para></item>
        </unorderedlist></item>
        <item><para>xxdiff-svn-diff: can optionally run svn-foreign
before the file preview (in the same process).</para></item>
        <item><para>svn-foreign: Added backups to svn-foreign, for
deleted files.  svn-foreign can still be copied and used independently
from the xxdiff library, and the backups feature is only available if
the xxdiff libs are found.</para></item>
        <item><para>Moved svn-foreign into the xxdiff scripts
packages, so that its functionality can be reused in-process.  (Note
to packagers: feel free to install it or not along with the rest of
the xxdiff-scripts.  When used by itself, it is not really tied to
xxdiff but it is a really useful program.)</para></item>
      </change>

      <change from="3.1" to="3.2b1">
        <item><para>**IMPORTANT** This release focuses on a complete
overhaul of the infrastructure for making Python scripts around
xxdiff.  There is now a Python package that is to be distributed and
installed with xxdiff, and all the scripts share code in there.  For
the full juicy details, see:: doc/xxdiff-scripts.html</para></item>
        <item><para>  Note to packagers: you now have to include a
Python distutils install in addition to the C++ xxdiff code.  This is
done like this:: (as root)#  <command>python setup.py
install</command> All the Python scripts now depend on Python-2.4 or
higher.</para></item>
        <item><para>Completely rewrote all the Python
scripts.</para></item>
        <item><para>Fixed some bugs in the scripts.</para></item>
        <item><para>Improved the way that backup files are
saved.</para></item>
        <item><para>Wrote global, general documentation about the
scripts and removed the automatically-generated
documentation.</para></item>
        <item><para>Added an example about how to provide another
transformer with xxdiff verification (in documentation)</para></item>
        <item><para>Ported all old child process code (like popen) in
the scripts to the subprocess module.</para></item>
        <item><para>xxdiff-resolve: Created a new script that finds
all the files that are still in conflict and invokes a 3-way merge
algorithm to resolve them.</para></item>
        <item><para>xxdiff-svn-diff: There is a new script
``xxdiff-svn-diff`` that can be used to view all the changes in a
subversion checkout.  It drives the show itself, rather than being
invoked by Subversion itself.  This has several
advantages.</para></item>
        <item><para>Add new options to selection code:</para>
        <unorderedlist>
          <item><para>--select-grep: Among the files selected by
filename, select only those which match the given regexp (or multiple
clauses)</para></item>
          <item><para>--ignore-grep: Among the files selected by
filename, ignore those which match the given regexp (or multiple
clauses)</para></item>
        </unorderedlist></item>
        <item><para>Some (but few) of the short options have changed
during the complete revamp of the Python scripts.  You should review
your calling scripts if they use short option names.</para></item>
        <item><para>Created xxdiff-rename, a script that allows one to
perform global renames (this is similar in purpose to the most common
use case for xxdiff-find-grep-sed).  Also: xxdiff-rename does not use
external processes to perform the replacement, it's all done from
within Python.  This should make it possible to run easily under
Windows.</para></item>
        <item><para>Created xxdiff-filter, a script that runs the
transformation loop using a UNIX command filter (see
docs).</para></item>
        <item><para>Made an infrastructure to process files in
transformation loops. xxdiff-find-grep-sed was rewritten in those
terms.</para></item>
        <item><para>xxdiff-diff-proxy: Included patch  for return code
and ignoring stderr [1329298].</para></item>
        <item><para>The xxdiff-subversion proxy script that is used to
be invoked from ``svn diff`` has been renamed to
``xxdiff-diff-proxy``.</para></item>
        <item><para>Created lib/python directory to hold shared code
between all the Python tools, thereby reducing redundancy.  The price
to pay for this is that you cannot simply copy the xxdiff-* scripts in
a bin directory anymore, to run them, you must also install the xxdiff
python library.  A setup.py file is provided for this
purpose.</para>
        <para>I finally did this because the cost of redundant code
was becoming annoying in the presence of my desire to code new tools.
I did not want to have to cut-n-paste anymore, in the name of having
every script be self-contained. Installing a Python library is not
such a big deal anyway, and I judge that there is enough code by now
to warrant it.  In addition, this will make it possible for people
that want to write their own scripts to reuse some of the
infrastructure that I provide for the already existing scripts.</para>
        <para>Note to packagers: you should be able to install
the xxdiff Python library in the most usual way for Python programs::
(as root)# <command>python setup.py install</command></para></item>
        <items name="Changes not related to the scripts:">
          <item><para>Incorporated patch for building RPMs (untested,
I don't have a RH box),</para></item>
          <item><para>Fixed pointer ownership bug that occurs on BSD,
using user-submitted patch and review [1382170].</para></item>
          <item><para>Applied user submitted patch, which fixes the
destination directory for file copy in directory diffs mode, to add
the appropriate destination directory. [1210548]</para></item>
          <item><para>Fixed line number in --single mode
[1351955].</para></item>
          <item><para>Applied user submitted patch for unescapeChars()
bug [1094008].</para></item>
          <item><para>When using --exit-on-same, output something if
we're in decision mode.</para></item>
          <item><para>Created ports subdirectory, added files for MAC
OSX.</para></item>
          <item><para>Added patch for building x86_64
rpm.</para></item>
          <item><para>WARNING!!!  Some of the switches have changed,
in the name of consistency. You will need to review your
scripts.</para></item>
        </items>
      </change>

      <platform name="HP-UX 11.00">
        <para>Patch <command>PHSS_22543</command> providing the
<command>libstd_v2</command> Standard C++ library is required as the
HP C++ compiler was used.</para>
      </platform>

      <platform name="Tru64 UNIX">
        <para>The latest C++ runtime library is required due to the
usage of the latest Compaq C++ compiler. It is available from the
following locations:</para>
        <unorderedlist>
          <item><para>package CXXREDIST651V37.tar in the support
directory of the CD</para></item>
          <item><para>online support directory <ulink url="ftp://support.thewrittenword.com/dists">ftp://support.thewrittenword.com/dists</ulink></para></item>
          <item><para>directly from Compaq at <ulink url="ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm">ftp://ftp.compaq.com/pub/products/C-CXX/Tru64/cxx/cxxredist.htm</ulink></para></item>
        </unorderedlist>
      </platform>
    </notes>

    <changelog>
      <change date="2012 January 16" revision="3"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Update bison dependency from 2.3 to
2.4.3</para></item>
        <item><para>Update gcc dependency from 4.2.4 to
4.4.6</para></item>
        <item><para>Update python dependency from 2.5.2 to
2.6.7</para></item>
        <item><para>Add support for AIX 7.1</para></item>
        <item><para>Remove support for HP-UX 10.20, RHEL3, SLES,
Solaris 6 and 7</para></item>
      </change>

      <change date="2011 July 2" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>
    </changelog>
  </program>
</programs>
