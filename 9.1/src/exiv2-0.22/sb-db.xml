<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="exiv2" version="0.22" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>lib${SB_PROG_NAME}02</install-name>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="pkgconfig" install-name="pkgconfig02"
        add-path="prepend" type="build">v&gt;=0.25</depend>
      <depend program="expat" var="LIBEXPAT"
        install-name="libexpat20">v&gt;=2.0.1</depend>
      <depend program="gettext" var="GETTEXT"
        install-name="gettext018"
        add-path="prepend">v&gt;=0.18.1.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv113"
        add-path="prepend">v&gt;=1.13.1</depend>
      <depend program="zlib" var="LIBZ"
        install-name="libz12">v&gt;=1.2.5</depend>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_gccsubdir="gcc44"
]]>
    </script-header>

    <module name="default">
      <sources>
        <source checksum="84d7d5b1802529efca8ac3d6e6a97e3a"
          checksum-type="md5" size="3482572"
          path="src/exiv2-0.22.tar.gz"/>
        <patch checksum="748f4cf37be29ca77c2b4bfedc835359"
          checksum-type="md5" size="48649"
          path="src/exiv2-0.22.tww.patch"/>
        <patch checksum="68c4a085862b3712283a8a86d5e0ac34"
          checksum-type="md5" size="2105665"
          path="src/exiv2-0.22.auto.patch"/>
        <patch checksum="2230b1f561599ff20ec5ec1e33ae40c2"
          checksum-type="md5" size="13771"
          path="src/dynamic_cast.patch"
          systype="*-aix*"/>
      </sources>

      <dependencies replace="0">
        <depend program="gcc" install-name="gcc44" add-path="prepend"
          systype="*-hpux11.00|*-solaris*">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"
          systype="*-hpux11.00|*-solaris*"/>
      </dependencies>

      <validate>
        <depend program="exiv2" module="gcc44"
          systype="*-aix*|*-hpux11.[123]*|*-irix*|*-linux*|*-osf*">v==0.22</depend>
      </validate>

      <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_gccsubdir="gcc44"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CXX=xlC CXXFLAGS="-O2 -qro -qroconst -qnotempinc \
-qnotemplateregistry -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux11.00)
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux11.11)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CXX=aCC CXXFLAGS="-AA -z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CXX=CC CXXFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-ptused -FE:template_in_elf_section -O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings"
  CXX=cxx CXXFLAGS="-O2 -arch ev5 -model ansi -msym \
-readonly_strings -timplicit_local -D__USE_STD_IOSTREAM"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CXXFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis";
  CXXFLAGS="-O2 -mcpu=ultrasparc -mvis";
  CC_LD_RT="-R" ;;
esac

case "${SB_SYSTYPE}" in
*-hpux11.00|*-solaris*)
  _libdir=${SB_INSTALL_PREFIX_LIB}/${_gccsubdir} ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBEXPAT_INC}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="${SB_VAR_GCC_RT+-L${SB_VAR_GCC_RT_LIB}} \
${SB_VAR_LIBEXPAT+-L${SB_VAR_LIBEXPAT_LIB}} \
${SB_VAR_GCC_RT+${CC_LD_RT}${SB_VAR_GCC_RT_LIB}} \
${SB_VAR_GETTEXT+${CC_LD_RT}${SB_VAR_GETTEXT_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_LIBEXPAT+${CC_LD_RT}${SB_VAR_LIBEXPAT_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
${SB_VAR_GETTEXT+--with-libintl-prefix=${SB_VAR_GETTEXT}} \
${SB_VAR_LIBICONV+--with-libiconv-prefix=${SB_VAR_LIBICONV}} \
${SB_VAR_LIBZ+--with-zlib=${SB_VAR_LIBZ}} \
--disable-visibility --mandir="${SB_INSTALL_PREFIX}/man" \
--datadir=${_datadir} --datarootdir=${_datadir} \
--docdir=${_docdir} ${ARGS+${ARGS}} \
--libdir=${_libdir:-${SB_INSTALL_PREFIX_LIB}} \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" config/exiv2.pc
]]>
      </configure>
    </module>

    <module name="gcc44"
    systype="*-aix*|*-hpux11.[123]*|*-irix*|*-linux*|*-osf*">
      <sources>
        <source checksum="84d7d5b1802529efca8ac3d6e6a97e3a"
          checksum-type="md5" size="3482572"
          path="src/exiv2-0.22.tar.gz"/>
        <patch checksum="748f4cf37be29ca77c2b4bfedc835359"
          checksum-type="md5" size="48649"
          path="src/exiv2-0.22.tww.patch"/>
        <patch checksum="68c4a085862b3712283a8a86d5e0ac34"
          checksum-type="md5" size="2105665"
          path="src/exiv2-0.22.auto.patch"/>
      </sources>

      <dependencies replace="0">
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"/>
      </dependencies>

      <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
_gccsubdir="gcc44"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc"
  CXXFLAGS="-O2 -mcpu=powerpc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CFLAGS="-O2 -mips4"
  CXXFLAGS="-O2 -mips4"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CFLAGS="-O2 -mcpu=ev5"
  CXXFLAGS="-O2 -mcpu=ev5"
  CC_LD_RT="-Wl,-rpath," ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBEXPAT_INC}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
LDFLAGS="${SB_VAR_GCC_RT+-L${SB_VAR_GCC_RT_LIB}} \
${SB_VAR_LIBEXPAT+-L${SB_VAR_LIBEXPAT_LIB}} \
${SB_VAR_GCC_RT+${CC_LD_RT}${SB_VAR_GCC_RT_LIB}} \
${SB_VAR_GETTEXT+${CC_LD_RT}${SB_VAR_GETTEXT_LIB}} \
${SB_VAR_LIBICONV+${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${SB_VAR_LIBZ+${CC_LD_RT}${SB_VAR_LIBZ_LIB}} \
${SB_VAR_LIBEXPAT+${CC_LD_RT}${SB_VAR_LIBEXPAT_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
${SB_VAR_GETTEXT+--with-libintl-prefix=${SB_VAR_GETTEXT}} \
${SB_VAR_LIBICONV+--with-libiconv-prefix=${SB_VAR_LIBICONV}} \
${SB_VAR_LIBZ+--with-zlib=${SB_VAR_LIBZ}} \
--mandir="${SB_INSTALL_PREFIX}/man" --docdir=${_docdir} \
--datadir=${_datadir} --datarootdir=${_datadir} ${ARGS+${ARGS}} \
--libdir="${SB_INSTALL_PREFIX_LIB}/${_gccsubdir}" \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" config/exiv2.pc
]]>
      </configure>

      <install>
<![CDATA[
gmake -C src install-lib
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX_LIB}/${_gccsubdir}
]]>
      </uninstall>
    </module>

    <licenses>
      <license path="gpl-2.license"/>
    </licenses>

    <notes>
      <change from="0.21.1" to="0.22">
        <item><para>This release adds support to access previews and
read and write XMP metadata in Postscript images. It also introduces a
new MSVC project for 64 bit builds as well as many smaller features
and bugfixes, all of which are listed in the ChangeLog as
usual.</para></item>
      </change>

      <change from="0.21" to="0.21.1">
        <item><para>This release fixes several bugs that were present
in 0.21 and is binary compatible with the previous version. As usual,
the ChangeLog lists all changes in detail.</para></item>
      </change>

      <change from="0.20" to="0.21">
        <item><para>This release adds read and write support for
Samsung SRW images and Samsung makernotes. The exiv2 library now
accepts a custom error handler and has a setting to control which
messages are generated. The exiv2 command line tool has a new 'quiet'
option which uses the new functionality to suppress all library
warnings. Some important API changes will allow many future image
format and makernote enhancements to be done in a binary compatible
fashion. The new exiv2.hpp umbrella header file further shields
applications from library changes. The ChangeLog lists these and
various smaller enhancements, bug fixes and tag updates in
detail.</para></item>
      </change>

      <change from="0.19" to="0.20">
        <item><para>This release includes Sony, Nikon and Pentax
makernote updates and a significant performance improvement for Nikon
makernotes. Writing to Minolta raw images (ORF) is now supported.
Several TIFF tags and the XMP KDE Image Program Interface (kipi)
schema, iView Media Pro schema and Microsoft Expression Media schema
have been added. See the ChangeLog for a complete list of all
enhancements and bugfixes in this release.</para></item>
      </change>

      <change from="0.18.2" to="0.19">
        <item><para>This release has a dramatically reduced memory
footprint when writing to TIFF and TIFF-based images as the images are
no longer completely loaded into memory. In addition it improves
performance of read operations for such files by about a factor six on
Windows. It also provides extended Nikon makernote support. Exiv2 is
now able to read and write many additional Nikon makernote tags,
including encrypted tags. The XMP toolkit used by Exiv2 has been
upgraded to the latest available version, iptc4xmpExt and plus XMP
schemas have been added and several XMP conversion issues fixed. The
ChangeLog lists all these enhancements and various other features and
bugs that have been addressed for this release.</para></item>
      </change>

      <change from="0.18.1" to="0.18.2">
        <item><para>This release fixes several important issues found
with PNG write-support, writing to certain NEF images and writing
comments to JPG images, among others. It also contains minor Nikon and
Minolta lens updates and updates Polish translations. The ChangeLog
has the complete list of changes, as usual.</para></item>
      </change>

      <change from="0.18" to="0.18.1">
        <item><para>This release adds write-support for Adobe
Photoshop PSD images, read-support for Panasonic RW2 images, Panasonic
and Nikon makernote updates, and a number of improvements under the
hood and bug fixes, detailed in the ChangeLog. It also includes a new
utility, organize.</para></item>
      </change>

      <change from="0.18-pre2" to="0.18">
        <item><para>Here is the final 0.18 release with write-support
for TIFF, DNG, NEF, PEF, PNG and JP2 images, makernote updates and
access to image previews. On Windows, Exiv2 can now be built as a
DLL.</para></item>
        <item><para>In addition to the changes in the 0.18
pre-releases, the Exiv2 command line utility has new options to show
all (Exif, IPTC and XMP) metadata and to list and extract preview
images, while the library enhancements are mostly bug fixes and minor
features. See the ChangeLog for details.</para></item>
      </change>

      <change from="0.18-pre1" to="0.18-pre2">
        <item><para>With this pre-release it is now possible to build
an Exiv2 Windows DLL.</para></item>
        <item><para>A new API was added to access image previews of
any image. In addition to Exif thumbnails this allows retrieving
various other previews from RAW images and Exif MakerNotes through a
common interface.</para></item>
        <item><para>Another backward-compatible API change allows
advanced Exif pretty-printing functions to refer to all Exif
tags.</para></item>
        <item><para>Further Exif improvements and fixes are detailed
in the ChangeLog.</para></item>
        <item><para>Again, please use this pre-release to test with
backups of your images and to adapt applications to the modified
interface, and raise issues in the forum. Your feedback is important
to finalizing release 0.18.</para></item>
      </change>

      <change from="0.17.1" to="0.18-pre1">
        <item><para>This pre-release adds write-support for TIFF, DNG,
NEF, PEF, PNG and JP2 images and provides the basis for write-support
for other TIFF-like RAW formats.</para></item>
        <item><para>The library's API was streamlined and internal
symbols removed from the ABI. The benefits of this change are
manifold. In particular, the reduced API is easier to work with and
will ultimately be more stable.</para></item>
        <item><para>Under the hood, the TIFF parser code was
consolidated: JPEG images now also use the new TIFF parser to read and
write Exif metadata and the old obsolete code was
removed.</para></item>
        <item><para>See the ChangeLog for a complete list of changes
and links to even more details.</para></item>
        <item><para>Please use this pre-release to test with backups
of your images and to adapt applications to the modified interface,
and raise issues in the forum. This feedback is key to finalizing
release 0.18.</para></item>
      </change>

      <change from="0.17" to="0.17.1">
        <item><para>This is a bugfix release for some important
issues, some of which were introduced with the previous release. See
the ChangeLog for details.</para></item>
      </change>

      <change from="0.16" to="0.17">
        <item><para>This release considerably extends the
functionality for dealing with XMP. It includes conversion of Exif and
IPTC to/from XMP, XMP sidecar files and XMP pretty printing
functionality. It also adds support for JPEG 2000 (JP2) and
Photoshop</para></item>
      </change>
    </notes>
  </program>
</programs>
