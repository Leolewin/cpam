<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="tar" version="1.26" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}12</install-name>

    <sources>
      <source checksum="2cee42a2ff4f1cd4f9298eeeb2264519"
        checksum-type="md5" size="2339773"
        path="src/tar-1.26.tar.bz2"/>
      <patch checksum="c5ee754f86757bab0a6c8b1eeb45e94f"
        checksum-type="md5" size="15862"
        path="src/tar-1.26.tww.patch"/>
      <patch checksum="6960597d35e06fc55ee8bf1ea3ec39db"
        checksum-type="md5" size="852749"
        path="src/tar-1.26.gnulib.patch"/>
      <patch checksum="898cb643d15b5f80a7adc9e25af6ab83"
        checksum-type="md5" size="2456474"
        path="src/tar-1.26.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="gettext" var="GETTEXT"
        install-name="gettext018"
        add-path="prepend">v&gt;=0.18.1.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv113"
        add-path="prepend">v&gt;=1.13.1</depend>
    </dependencies>

    <script-header>
<![CDATA[
_datadir="${SB_INSTALL_PREFIX}/share"
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc_r CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"

  export ac_cv_func_getppriv=no ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit" ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit" ;;
*-irix*)
  CC=c99 CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0" ;;
*-freebsd*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -msym -arch ev5 -readonly_strings" ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
${LDFLAGS+LDFLAGS="${LDFLAGS}"} \
${SB_VAR_LIBICONV+--with-libiconv-prefix=${SB_VAR_LIBICONV}} \
${SB_VAR_GETTEXT+--with-libintl-prefix=${SB_VAR_GETTEXT}} \
--program-prefix=g --disable-dependency-tracking \
--datarootdir=${_datadir} --datadir=${_datadir} \
--disable-silent-rules --infodir="${SB_INSTALL_PREFIX}/info" \
--mandir="${SB_INSTALL_PREFIX}/man" \
--prefix=${SB_INSTALL_PREFIX}

gmake configure

# recreate GNU info files
rm doc/*.info* || :
]]>
    </configure>

    <build>
<![CDATA[
gmake MAKEINFOFLAGS="--no-split"
]]>
    </build>

    <test>
<![CDATA[
gmake check
]]>
    </test>

    <install>
<![CDATA[
gmake install

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_docdir}/texinfo
${SB_PATH_INSTALL} -m 644 -o root -g 0 doc/*.texi ${_docdir}/texinfo

rmdir ${SB_INSTALL_PREFIX}/sbin || :

# Remove lib/charset.alias
rm -rf ${SB_INSTALL_PREFIX}/lib
]]>
    </install>

    <licenses>
      <license path="gpl-3.license"/>
    </licenses>

    <notes>
      <change from="1.25" to="1.26">
        <items name="Bugfixes">
          <item><para>Fix the --verify option, which broke in version
1.24.</para></item>
          <item><para>Fix storing long sparse file names in PAX
archives.</para></item>
          <item><para>Fix correctness of --atime-preserve=replace</para>
          <para>tar --atime-preserve=replace no longer tries to
restore atime of zero-sized files.</para></item>
          <item><para>Work around POSIX incompatibilities on FreeBSD,
NetBSD and Tru64</para></item>
          <item><para>Fix bug with --one-file-system
--listed-incremental</para>
          <para>When invoked with these two options, tar 1.25 would
add only the top-level directory to the archive, but not its
contents.</para></item>
        </items>
      </change>

      <change from="1.24" to="1.25">
        <item><para>Fix extraction of empty directories with the -C
option in effect.</para></item>
        <item><para>Fix extraction of device nodes.</para></item>
        <item><para>Make sure name matching occurs before eventual name
transformation.</para>
        <para>Tar 1.24 changed the ordering of name matching and name
transformation so that the former saw already transformed file names.
This made it impossible to match file names in certain cases.  It is
fixed now.</para></item>
        <item><para>Fix the behavior of tar -x --overwrite on hosts
lacking O_NOFOLLOW.</para></item>
        <item><para>Improve the testsuite.</para></item>
        <item><para>Alternative decompression programs.</para>
        <para>If extraction from a compressed archive fails because
the corresponding compression program is not installed and the following
two conditions are met, tar retries extraction using an alternative
decompressor:</para>
        <orderedlist>
          <item><para>Another compression program supported by tar
is able to handle this compression format.</para></item>
          <item><para>The compression program was not explicitly
requested in the command line by the use of such options as -z, -j,
etc.</para></item>
        </orderedlist>
        <para>For example, if `compress' is not available, tar will
try `gzip'.</para></item>
      </change>

      <change from="1.23" to="1.24">
        <item><para>The --full-time option.</para>
        <para>New command line option `--full-time' instructs tar to
output file time stamps to the full resolution.</para></item>
        <items name="Bugfixes">
          <item><para>More reliable directory traversal when creating
archives</para>
          <para>Tar now checks for inconsistencies caused when a file
system is modified while tar is creating an archive.  In the new
approach, tar maintains a cache of file descriptors to directories, so
it uses more file descriptors than before, but it adjusts to system
limits on the number of file descriptors.  Tar also takes more care when
a file system is modified while tar is extracting from an
archive.</para>
          <para>The new checks are implemented via the openat and
related calls standardized by POSIX.1-2008.  On an older system where
these calls do not exist or do not return useful results, tar emulates
the calls at some cost in efficiency and reliability.</para></item>
          <item><para>Symbolic link attributes</para>
          <para>When extracting symbolic links, tar now restores
attributes such as last-modified time and link permissions, if the
operating system supports this.  For example, recent versions of the
Linux kernel support setting times on symlinks, and some BSD kernels
also support symlink permissions.</para></item>
          <item><para>--dereference consistency</para>
          <para>The --dereference (-h) option now applies to files
that are copied into or out of archives, independently of other options.
For example, if F is a symbolic link and archive.tar contains a
regular-file member also named F, "tar --overwrite -x -f archive.tar F"
now overwrites F itself, rather than the file that F points to.  (To
overwrite the file that F points to, add the --dereference (-h) option.)
Formerly, --dereference was intended to apply only when using the -c
option, but the implementation was not consistent.</para>
          <para>Also, the --dereference option no longer affects
accesses to other files, such as archives and time stamp files.
Symbolic links to these files are always followed.  Previously, the
links were usually but not always followed.</para></item>
          <item><para>Spurious error diagnostics on broken pipe.</para>
          <para>When receiving SIGPIPE, tar would exit with error
status and "write error" diagnostics. In particular, this occurred if
invoked as in the example below:</para>
          <screen>
tar tf archive.tar | head -n 1
          </screen></item>
          <item><para>--remove-files</para>
          <para>`Tar --remove-files' failed to remove a directory
which contained symlinks to another files within that
directory.</para></item>
          <item><para>--test-label behavior</para>
          <para>In case of a mismatch, `tar --test-label LABEL' exits
with code 1, not 2 as it did in previous versions.</para>
          <para>The `--verbose' option used with `--test-label'
provides additional diagnostics.</para>
          <para>Several volume labels may be specified in a command
line, e.g.:</para>
          <screen>
tar --test-label -f archive 'My volume' 'New volume' 'Test volume'
          </screen>
          <para>In this case, tar exits with code 0 if any one of the
arguments matches the actual volume label.</para></item>
          <item><para>--label used with --update</para>
          <para>The `--label' option can be used with `--update' to
prevent accidental update of an archive:</para>
          <screen>
tar -rf archive --label 'My volume' .
          </screen>
          <para>This did not work in previous versions, in spite of
what the docs said.</para></item>
          <item><para>--record-size and --tape-length (-L) options</para>
          <para>Usual size suffixes are allowed for these options.
For example, -L10k stands for a 10 kilobyte tape length.</para></item>
          <item><para>Fix dead loop on extracting existing symlinks with
the -k option.</para></item>
        </items>
      </change>

      <change from="1.22" to="1.23">
        <item><para>Record size autodetection</para>
        <para>When listing or extracting archives, the actual
record size is reported only if the archive is read from a device (as
opposed to regular files and pipes).</para></item>
        <item><para>Seekable archives</para>
        <para>When a read-only operation (e.g. --list or
--extract) is requested on a regular file, tar attemtps to speed up
accesses by using lseek.</para></item>
        <item><para>New command line option `--warning'</para>
        <para>The `--warning' command line option allows to suppress
or enable particular warning messages during `tar' run.  It takes a
single argument (a `keyword'), identifying the class of warning
messages to affect.  If the argument is prefixed with `no-', such
warning messages are suppressed.  For example,<command>tar
--warning=no-alone-zero-block -x -f archive</command> suppresses the
output of `A lone zero block' diagnostics, which is normally issued if
`archive' ends with a single block of zeros.</para>
        <para>See Tar Manual, section 3.9 "Controlling Warning
Messages", for a detailed discussion.</para></item>
        <item><para>New command line option `--level'</para>
        <para>The `--level=N' option sets the incremental dump
level N.  It is valid when used in conjunction with the -c and
--listed-incremental options.  So far the only meaningful value for N
is 0.  The `--level=0' option forces creating the level 0 dump, by
truncating the snapshot file if it exists.</para></item>
        <item><para>Files removed during incremental
dumps</para>
        <para>If a file or directory is removed while incremental
dump is in progress, tar exact actions depend on whether this file was
explicitly listed in the command line, or was found during file system
scan.</para>
        <para>If the file was explicitly listed in the command line,
tar issues error message and exits with the code 2, meaning fatal
error.</para>
        <para>Otherwise, if the file was found during the file
system scan, tar issues a warning, saying "File removed before we read
it", and sets exit code to 1, which means "some files differ". If the
--warning=no-file-removed option is given, no warning is issued and
exit code remains 0.</para></item>
        <item><para>Modification times of PAX extended
headers.</para>
        <para>Modification times in ustar header blocks of extended
headers are set to mtimes of the corresponding archive members.  This
can be overridden by the
<command>--pax-opion='exthdr.mtime=STRING'</command> command line
option.  The STRING is either number of seconds since the Epoch or a
`Time reference' (see below).</para>
        <para>Modification times in ustar header blocks of global
extended headers are set to the time when tar was invoked.</para>
        <para>This can be overridden by the
<command>--pax-opion='globexthdr.mtime=STRING'</command> command line
option.  The STRING is either number of seconds since the Epoch or a
`Time reference' (see below).</para></item>
        <item><para>Time references in --pax-option
argument.</para>
        <para>Any value from the --pax-option argument that is
enclosed in a pair of curly braces represents a time reference.  The
string between the braces is understood either as a textual time
representation, as described in chapter 7, "Date input formats", of
the Tar manual, or as a name of an existing file, starting with `/' or
`.'.  In the latter case, it is replaced with the modification time of
that file.</para></item>
        <item><para>Environment of --to-command script.</para>
        <para>The environment passed to the --to-command script is
extended with the following variables:</para>
        <screen>
TAR_VERSION          GNU tar version number
TAR_ARCHIVE          The name of the archive
TAR_VOLUME           Ordinal number of the volume
TAR_FORMAT           Format of the archive
TAR_BLOCKING_FACTOR  Current blocking factor
        </screen></item>
        <items name="Bugfixes">
          <item><para>Fix handling of hard link targets by -c
--transform.</para></item>
          <item><para>Fix hard links recognition with -c
--remove-files.</para></item>
          <item><para>Fix restoring files from backup (debian bug
#508199).</para></item>
          <item><para>Correctly restore modes and permissions on
existing directories.</para></item>
          <item><para>The --remove-files option removes files only if
they were succesfully stored in the archive.</para></item>
          <item><para>Fix storing and listing of the volume labels in
POSIX format.</para></item>
          <item><para>Improve algorithm for splitting long file names
(ustar format).</para></item>
          <item><para>Fix possible memory overflow in the rmt client
code (CVE-2010-0624).</para></item>
        </items>
      </change>

      <change from="1.21" to="1.22">
        <item><para>Support for xz compression</para>
        <para>Tar uses xz for compression if one of the following
conditions is met:</para>
        <orderedlist>
          <item><para>The option --xz or -J (see below) is
used.</para></item>
          <item><para>The xz binary is set as compressor using
--use-compress-program option.</para></item>
          <item><para>The file name of the archive being created
ends in `.xz' and auto-compress option (-a) is used.</para></item>
        </orderedlist>
        <para>Xz is used for decompression if one of the following
conditions is met:</para>
        <orderedlist>
          <item><para>The option --xz or -J is used.</para></item>
          <item><para>The xz binary is set as compressor using
--use-compress-program option.</para></item>
          <item><para>The file is recognized as xz compressed stream
data.</para></item>
        </orderedlist></item>
        <item><para>Short option -J reassigned as a short equivalent
of --xz</para></item>
        <item><para>New option -I</para>
        <para>The -I option is assigned as a short equivalent for
--use-compress-program.</para></item>
        <item><para>The --no-recursive option works in incremental
mode.</para></item>
      </change>

      <change from="1.20" to="1.21">
        <item><para>New short option -J - A shortcut for
--lzma.</para></item>
        <item><para>New option --lzop</para></item>
        <item><para>New option --no-auto-compress</para>
        <para>Cancels the effect of previous --auto-compress
(-a) option.</para></item>
        <item><para>New option --no-null</para>
        <para>Cancels the effect of previous --null
option.</para></item>
        <item><para>Compressed format recognition</para>
        <para>If tar is unable to determine archive compression
format, it falls back to using archive suffix to determine
it.</para></item>
        <item><para>VCS support.</para>
        <para>Using --exclude-vcs handles also files used
internally by Bazaar, Mercurial and Darcs.</para></item>
        <item><para>Transformation scope flags</para>
        <para>Name transformation expressions understand additional
flags that control type of archive members affected by them.  The
flags are:</para>
        <unorderedlist>
          <item><para>r: Apply transformation to regular archive
members.</para></item>
          <item><para>s: Apply transformation to symbolic link
targets.</para></item>
          <item><para>h:  Apply transformation to hard link
targets.</para></item>
        </unorderedlist>
        <para>Corresponding upper-case letters negate the meaning,
so that `H' means ``do not apply transformation to hard link
targets.''</para>
        <para>The scope flags are listed in the third part of an `s'
expression, e.g.:<command>tar --transform
's|^|/usr/local/|S'</command></para>
        <para>Default is `rsh', which means that transformations are
applied to both regular archive members and to the targets of symbolic
and hard links.  If several transform expressions are used, the
default flags can be changed using `flags=' statement before the
expressions, e.g.: <command>tar --transform
'flags=S;s|^|/usr/local/|S'</command></para></item>
        <items name="Bugfixes">
          <item><para>The --null option disabled handling of tar
options in list files.  This is fixed.</para></item>
          <item><para>Fixed record size autodetection.  If detected
record size differs from the expected value (either default, or set on
the command line), tar always prints a warning if verbosity level is
set to 1 or greater, i.e. if either -t or -v option is
given.</para></item>
        </items>
      </change>
    </notes>
  </program>
</programs>
