<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="postfix" version="2.8.4" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}284</install-name>

    <sources>
      <source checksum="a9fdd0f204e7ca0b7d32fd0b9f8f8c72"
        checksum-type="md5" size="3646391"
        path="src/postfix-2.8.4.tar.gz"/>
      <patch checksum="78fe64ceea9126c255da685d7b99e052"
        checksum-type="md5" size="3625"
        path="src/postfix-2.8.4.tww.patch"/>
    </sources>

    <dependencies>
      <depend user="postfix"/>

      <depend group="postdrop"/>

      <depend program="cyrus-sasl" var="LIBSASL"
        install-name="libsasl21">v&gt;=2.1.25</depend>
      <depend program="openldap" var="OPENLDAP"
        install-name="openldap24">v&gt;=2.4.26</depend>
      <depend program="db" var="LIBDB"
        install-name="libdb47">v&gt;=4.7.25</depend>
      <depend program="openssl" var="LIBOPENSSL"
        install-name="libopenssl10">v&gt;=1.0.0e</depend>
      <depend program="pcre" var="LIBPCRE"
        install-name="libpcre811">v&gt;=8.11</depend>
      <depend program="perl" add-path="prepend"
        type="build">v==5.12.2</depend>
    </dependencies>

    <script-header>
<![CDATA[
_localstatedir="/var${SB_INSTALL_PREFIX}"
_sysconfdir="/etc${SB_INSTALL_PREFIX}"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-Ae -z +O2 +Ofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
*-freebsd*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"

  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CC=cc CFLAGS="-O2 -nodtk -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"

  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"

  CC_LD_RT="-R" ;;
esac

gmake makefiles CC="${CC:-gcc}" OPT="${CFLAGS:--O2}" DEBUG= \
CCARGS="${ARGS+${ARGS}} \
-DDEF_COMMAND_DIR=\\\"${SB_INSTALL_PREFIX}/sbin\\\" \
-DDEF_DATA_DIR=\\\"${_localstatedir}/data\\\" \
-DDEF_CONFIG_DIR=\\\"${_sysconfdir}\\\" \
-DDEF_DAEMON_DIR=\\\"${SB_INSTALL_PREFIX}/libexec\\\" \
-DDEF_MAILQ_PATH=\\\"${SB_INSTALL_PREFIX}/bin/mailq\\\" \
-DDEF_MANPAGE_DIR=\\\"${SB_INSTALL_PREFIX}/man\\\" \
-DDEF_NEWALIAS_PATH=\\\"${SB_INSTALL_PREFIX}/bin/newaliases\\\" \
-DDEF_SAMPLE_DIR=\\\"${SB_INSTALL_PREFIX}/contrib\\\" \
-DDEF_SENDMAIL_PATH=\\\"${SB_INSTALL_PREFIX}/sbin/sendmail\\\" \
-DDEF_QUEUE_DIR=\\\"${_localstatedir}\\\" \
-DDEF_README_DIR=\\\"${SB_INSTALL_PREFIX}/doc/readme-files\\\" \
${SB_VAR_LIBDB+-DHAS_DB -I${SB_VAR_LIBDB_INC}} \
${SB_VAR_OPENLDAP+-DHAS_LDAP -I${SB_VAR_OPENLDAP_INC}} \
${SB_VAR_LIBOPENSSL+-DUSE_TLS -I${SB_VAR_LIBOPENSSL_INC}} \
${SB_VAR_LIBPCRE+-DHAS_PCRE -I${SB_VAR_LIBPCRE_INC}} \
${SB_VAR_LIBSASL+-DUSE_SASL_AUTH -I${SB_VAR_LIBSASL_INC}/sasl} \
${CPPFLAGS+${CPPFLAGS}}" \
AUXLIBS="${SB_VAR_LIBDB+-L${SB_VAR_LIBDB_LIB} \
${CC_LD_RT}${SB_VAR_LIBDB_LIB} -ldb} \
${SB_VAR_OPENLDAP+-L${SB_VAR_OPENLDAP_LIB} \
${CC_LD_RT}${SB_VAR_OPENLDAP_LIB} -lldap -llber} \
${SB_VAR_LIBOPENSSL+-L${SB_VAR_LIBOPENSSL_LIB} \
${CC_LD_RT}${SB_VAR_LIBOPENSSL_LIB} -lssl -lcrypto} \
${SB_VAR_LIBPCRE+-L${SB_VAR_LIBPCRE_LIB} \
${CC_LD_RT}${SB_VAR_LIBPCRE_LIB} -lpcre} \
${SB_VAR_LIBSASL+-L${SB_VAR_LIBSASL_LIB} \
${CC_LD_RT}${SB_VAR_LIBSASL_LIB} -lsasl2} \
${LDFLAGS+${LDFLAGS}}"
]]>
    </configure>

    <install>
<![CDATA[
${SHELL} postfix-install -non-interactive

${SB_PATH_CHGRP} -hR 0 ${SB_INSTALL_PREFIX} ${_sysconfdir}

# fix permission on postqueue and postdrop
${SB_PATH_CHGRP} postdrop ${SB_INSTALL_PREFIX}/sbin/postdrop \
${SB_INSTALL_PREFIX}/sbin/postqueue
${SB_PATH_CHMOD} g+s ${SB_INSTALL_PREFIX}/sbin/postdrop \
${SB_INSTALL_PREFIX}/sbin/postqueue

# redo mailq/newaliases link
rm ${SB_INSTALL_PREFIX}/bin/mailq ${INSTALL_PREFIX}/bin/newaliases
(cd ${SB_INSTALL_PREFIX}/bin
 ln -s ${SB_INSTALL_PREFIX}/sbin/sendmail mailq
 ln -s ${SB_INSTALL_PREFIX}/sbin/sendmail newaliases)

${SB_PATH_SED} -i -e "\
/alias_maps = netinfo:/ {
a\\
alias_maps = hash:${_sysconfdir}/aliases
}
/alias_database = hash:\/etc\/aliases, hash:/ {
a\\
alias_database = hash:${_sysconfdir}/aliases
}
/mail_version/ {
a\\
smtpd_banner = \$myhostname ESMTP \$mail_name (\$mail_version)
}" ${_sysconfdir}/main.cf
]]>
    </install>

    <uninstall>
<![CDATA[
rm -rf ${_localstatedir} ${_sysconfdir} ${SB_INSTALL_PREFIX}
]]>
    </uninstall>

    <licenses>
      <license>
        <para>IBM PUBLIC LICENSE VERSION 1.0 - SECURE MAILER</para>
        <para>THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS
OF THIS IBM PUBLIC LICENSE ("AGREEMENT").  ANY USE, REPRODUCTION OR
DISTRIBUTION OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS
AGREEMENT.</para>
        <orderedlist>
          <item><para>DEFINITIONS</para>
          <unorderedlist>
            <item><para>"Contribution" means:</para>
            <orderedlist type="lower-alpha">
              <item><para>in the case of International Business Machines
Corporation ("IBM"), the Original Program, and</para></item>
              <item><para>in the case of each Contributor,</para>
              <orderedlist type="lower-roman">
                <item><para>changes to the Program, and</para></item>
                <item><para>additions to the Program; where such changes
and/or additions to the Program originate from and are distributed by
that particular Contributor.  A Contribution 'originates' from a
Contributor if it was added to the Program by such Contributor itself
or anyone acting on such Contributor's behalf.</para></item>
              </orderedlist>
              <para>Contributions do not include additions to the Program
which:</para>
              <orderedlist type="lower-roman">
                <item><para>are separate modules of software distributed
in conjunction with the Program under their own license agreement,
and</para></item>
                <item><para>are not derivative works of the
Program.</para></item>
              </orderedlist></item>
            </orderedlist></item>
            <item><para>"Contributor" means IBM and any other entity
that distributes the Program.</para></item>
            <item><para>"Licensed Patents " mean patent claims
licensable by a Contributor which are necessarily infringed by the use
or sale of its Contribution alone or when combined with the
Program.</para></item>
            <item><para>"Original Program" means the original version
of the software accompanying this Agreement as released by IBM,
including source code, object code and documentation, if
any.</para></item>
            <item><para>"Program" means the Original Program and
Contributions.</para></item>
            <item><para>"Recipient" means anyone who receives the
Program under this Agreement, including all
Contributors.</para></item>
          </unorderedlist></item>
          <item><para>GRANT OF RIGHTS</para>
          <orderedlist type="lower-alpha">
            <item><para>Subject to the terms of this Agreement, each
Contributor hereby grants Recipient a non-exclusive, worldwide,
royalty-free copyright license to reproduce, prepare derivative works
of, publicly display, publicly perform, distribute and sublicense the
Contribution of such Contributor, if any, and such derivative works,
in source code and object code form.</para></item>
            <item><para>Subject to the terms of this Agreement, each
Contributor hereby grants Recipient a non-exclusive, worldwide,
royalty-free patent license under Licensed Patents to make, use, sell,
offer to sell, import and otherwise transfer the Contribution of such
Contributor, if any, in source code and object code form.  This patent
license shall apply to the combination of the Contribution and the
Program if, at the time the Contribution is added by the Contributor,
such addition of the Contribution causes such combination to be
covered by the Licensed Patents.  The patent license shall not apply
to any other combinations which include the Contribution.  No hardware
per se is licensed hereunder.</para></item>
            <item><para>Recipient understands that although each
Contributor grants the licenses to its Contributions set forth herein,
no assurances are provided by any Contributor that the Program does
not infringe the patent or other intellectual property rights of any
other entity. Each Contributor disclaims any liability to Recipient
for claims brought by any other entity based on infringement of
intellectual property rights or otherwise.  As a condition to
exercising the rights and licenses granted hereunder, each Recipient
hereby assumes sole responsibility to secure any other intellectual
property rights needed, if any.  For example, if a third party patent
license is required to allow Recipient to distribute the Program, it
is Recipient's responsibility to acquire that license before
distributing the Program.</para></item>
            <item><para>Each Contributor represents that to its
knowledge it has sufficient copyright rights in its Contribution, if
any, to grant the copyright license set forth in this
Agreement.</para></item>
          </orderedlist></item>
          <item><para>REQUIREMENTS</para>
          <para>A Contributor may choose to distribute the Program
in object code form under its own license agreement, provided
that:</para>
          <orderedlist type="lower-alpha">
            <item><para>it complies with the terms and conditions of
this Agreement; and</para></item>
            <item><para>its license agreement:</para>
            <orderedlist type="lower-roman">
              <item><para>effectively disclaims on behalf of all
Contributors all warranties and conditions, express and implied,
including warranties or conditions of title and non-infringement, and
implied warranties or conditions of merchantability and fitness for a
particular purpose;</para></item>
              <item><para>effectively excludes on behalf of all
Contributors all liability for damages, including direct, indirect,
special, incidental and consequential damages, such as lost profits;
</para></item>
              <item><para>states that any provisions which differ
from this Agreement are offered by that Contributor alone and not by
any other party; and</para></item>
              <item><para>states that source code for the Program is
available from such Contributor, and informs licensees how to obtain
it in a reasonable manner on or through a medium customarily used for
software exchange.</para></item>
            </orderedlist></item>
          </orderedlist>
          <para>When the Program is made available in source code
form:</para>
          <orderedlist type="lower-alpha">
            <item><para>it must be made available under this
Agreement; and</para></item>
            <item><para>a copy of this Agreement must be included with
each copy of the Program.</para></item>
          </orderedlist>
          <para>Each Contributor must include the following in a
conspicuous location in the Program:</para>
          <screen>
Copyright (c) 1997,1998,1999, International Business Machines
Corporation and others. All Rights Reserved.
          </screen>
          <para>In addition, each Contributor must identify itself
as the originator of its Contribution, if any, in a manner that
reasonably allows subsequent Recipients to identify the originator of
the Contribution.</para></item>
          <item><para>COMMERCIAL DISTRIBUTION</para>
          <para>Commercial distributors of software may accept certain
responsibilities with respect to end users, business partners and the
like.  While this license is intended to facilitate the commercial use
of the Program, the Contributor who includes the Program in a
commercial product offering should do so in a manner which does not
create potential liability for other Contributors. Therefore, if a
Contributor includes the Program in a commercial product offering,
such Contributor ("Commercial Contributor") hereby agrees to defend
and indemnify every other Contributor ("Indemnified Contributor")
against any losses, damages and costs (collectively "Losses") arising
from claims, lawsuits and other legal actions brought by a third party
against the Indemnified Contributor to the extent caused by the acts
or omissions of such Commercial Contributor in connection with its
distribution of the Program in a commercial product offering.  The
obligations in this section do not apply to any claims or Losses
relating to any actual or alleged intellectual property infringement.
In order to qualify, an Indemnified Contributor must:</para>
          <orderedlist type="lower-alpha">
            <item><para> promptly notify the Commercial Contributor in
writing of such claim, and </para></item>
            <item><para>allow the Commercial Contributor to control,
and cooperate with the Commercial Contributor in, the defense and any
related settlement negotiations.  The Indemnified Contributor may
participate in any such claim at its own expense.</para></item>
          </orderedlist>
          <para>For example, a Contributor might include the Program
in a commercial product offering, Product X.  That Contributor is then
a Commercial Contributor.  If that Commercial Contributor then makes
performance claims, or offers warranties related to Product X, those
performance claims and warranties are such Commercial Contributor's
responsibility alone.  Under this section, the Commercial Contributor
would have to defend claims against the other Contributors related to
those performance claims and warranties, and if a court requires any
other Contributor to pay any damages as a result, the Commercial
Contributor must pay those damages.</para></item>
          <item><para>NO WARRANTY</para>
          <para>EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, THE
PROGRAM IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT
LIMITATION, ANY WARRANTIES OR CONDITIONS OF TITLE, NON-INFRINGEMENT,
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Each Recipient is
solely responsible for determining the appropriateness of using and
distributing the Program and assumes all risks associated with its
exercise of rights under this Agreement, including but not limited to
the risks and costs of program errors, compliance with applicable
laws, damage to or loss of data, programs or equipment, and
unavailability or interruption of operations.</para></item>
          <item><para>DISCLAIMER OF LIABILITY</para>
          <para>EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT,
NEITHER RECIPIENT NOR ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED
AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF
THE USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS
GRANTED HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGES.</para></item>
          <item><para>GENERAL</para>
          <para>If any provision of this Agreement is invalid or
unenforceable under applicable law, it shall not affect the validity
or enforceability of the remainder of the terms of this Agreement, and
without further action by the parties hereto, such provision shall be
reformed to the minimum extent necessary to make such provision valid
and enforceable.</para>
          <para>If Recipient institutes patent litigation against a
Contributor with respect to a patent applicable to software (including
a cross-claim or counterclaim in a lawsuit), then any patent licenses
granted by that Contributor to such Recipient under this Agreement
shall terminate as of the date such litigation is filed.  In addition,
If Recipient institutes patent litigation against any entity
(including a cross-claim or counterclaim in a lawsuit) alleging that
the Program itself (excluding combinations of the Program with other
software or hardware) infringes such Recipient's patent(s), then such
Recipient's rights granted under Section 2(b) shall terminate as of
the date such litigation is filed.</para>
          <para>All Recipient's rights under this Agreement shall
terminate if it fails to comply with any of the material terms or
conditions of this Agreement and does not cure such failure in a
reasonable period of time after becoming aware of such noncompliance.
If all Recipient's rights under this Agreement terminate, Recipient
agrees to cease use and distribution of the Program as soon as
reasonably practicable.  However, Recipient's obligations under this
Agreement and any licenses granted by Recipient relating to the
Program shall continue and survive.</para>
          <para>IBM may publish new versions (including revisions) of
this Agreement from time to time.  Each new version of the Agreement
will be given a distinguishing version number.  The Program (including
Contributions) may always be distributed subject to the version of the
Agreement under which it was received. In addition, after a new
version of the Agreement is published, Contributor may elect to
distribute the Program (including its Contributions) under the new
version. No one other than IBM has the right to modify this Agreement.
Except as expressly stated in Sections 2(a) and 2(b) above, Recipient
receives no rights or licenses to the intellectual property of any
Contributor under this Agreement, whether expressly, by implication,
estoppel or otherwise.  All rights in the Program not expressly
granted under this Agreement are reserved.</para>
          <para>This Agreement is governed by the laws of the State of
New York and the intellectual property laws of the United States of
America. No party to this Agreement will bring a legal action under
this Agreement more than one year after the cause of action arose.
Each party waives its rights to a jury trial in any resulting
litigation.</para></item>
        </orderedlist>
      </license>

      <license>
        <para>Included for the use of the fix_strcasecmp.c module
which works around a Solaris problem.</para>
        <para>Copyright (c) 1987, 1993</para>
        <para>The Regents of the University of California.  All
rights reserved.</para>
        <para>Redistribution and use in source and binary forms,
with or without modification, are permitted provided that the
following conditions are met:</para>
        <orderedlist>
          <item><para>Redistributions of source code must retain the
above copyright notice, this list of conditions and the following
disclaimer.</para></item>
          <item><para>Redistributions in binary form must reproduce the
above copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials provided with
the distribution.</para></item>
          <item><para>All advertising materials mentioning features or
use of this software must display the following
acknowledgement:</para>
          <screen>
This product includes software developed by the University of
  California, Berkeley and its contributors.
Neither the name of the University nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
          </screen></item>
        </orderedlist>

        <para>THIS SOFTWARE IS PROVIDED BY THE REGENTS AND
CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE FOR ANY
DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</para>
      </license>

      <license>
        <unorderedlist>
          <item><para>Author</para>
          <para>Postfix/TLS support was originally developed by
Lutz Jaenicke of Brandenburg University of Technology, Cottbus,
Germany.</para></item>
          <item><para>License</para>
          <para>This software is free. You can do with it whatever
you want. I would however kindly ask you to acknowledge the use of
this package, if you are going use it in your software, which you
might be going to distribute. I would also like to receive a note if
you are a satisfied user :-)</para></item>
          <item><para>Acknowledgements:</para>
          <para>This package is based on the OpenSSL package as
provided by the ``OpenSSL Project''.</para></item>
          <item><para>Disclaimer</para>
          <para>This software is provided ``as is''. You are using it
at your own risk. I will take no liability in any case.</para>
          <para>This software package uses strong cryptography, so
even if it is created, maintained and distributed from liberal
countries in Europe (where it is legal to do this), it falls under
certain export/import and/or use restrictions in some other parts of
the world.</para>
          <para>PLEASE REMEMBER THAT EXPORT/IMPORT AND/OR USE OF
STRONG CRYPTOGRAPHY SOFTWARE, PROVIDING CRYPTOGRAPHY HOOKS OR EVEN
JUST COMMUNICATING TECHNICAL DETAILS ABOUT CRYPTOGRAPHY SOFTWARE IS
ILLEGAL IN SOME PARTS OF THE WORLD. SO, WHEN YOU IMPORT THIS PACKAGE
TO YOUR COUNTRY, RE-DISTRIBUTE IT FROM THERE OR EVEN JUST EMAIL
TECHNICAL SUGGESTIONS OR EVEN SOURCE PATCHES TO THE AUTHOR OR OTHER
PEOPLE YOU ARE STRONGLY ADVICED TO PAY CLOSE ATTENTION TO ANY
EXPORT/IMPORT AND/OR USE LAWS WHICH APPLY TO YOU. THE AUTHOR OF
PFIXTLS IS NOT LIABLE FOR ANY VIOLATIONS YOU MAKE HERE. SO BE
CAREFULLY YOURSELF, IT IS YOUR RESPONSIBILITY.</para></item>
        </unorderedlist>
      </license>
    </licenses>

    <notes>
      <change from="2.7.0" to="2.8.0">
        <items name="Major changes - restart Postfix">
          <item><para>If you upgrade from Postfix 2.6 or earlier, you
must execute "postfix stop" and "postfix start" before you can use the
postscreen(8) daemon.  This is needed because the Postfix 2.6 "pass"
master service type did not work reliably on some
systems.</para></item>
          <item><para>If you upgrade from Postfix 2.7, or from Postfix
2.8 before July 25, 2010, you must execute "postfix reload" (or
"postfix stop" followed by "postfix start"). This is needed because
the queue manager to delivery agent protocol has changed. Failure to
do this results in repeated logging of warnings with:</para>
          <screen>
warning: unexpected attribute rewrite_context ...
          </screen>
          <para>If the warning does not go away after restarting
Postfix, examine the output from this command:</para>
          <screen>
strings -af /usr/libexec/postfix/* | grep mail_version=
          </screen>
          <para>(where /usr/libexec/postfix is the value of
main.cf:daemon_directory) and update the executables that have a
version string that differs from the other programs.</para></item>
        </items>

        <items name="Major changes - DNSBL/DNSWL support">
          <item><para>[Feature 20101126] Support for address patterns
in DNS blacklist and whitelist lookup results.</para>
          <para>For example, "reject_rbl_client
example.com=127.0.0.[2;4;6..8]" will reject clients when the lookup
result is 127.0.0.2, 127.0.0.4, 127.0.0.6, 127.0.0.7, or
127.0.0.8.</para>
          <para>The setting "postscreen_dnsbl_sites =
example.com=127.0.0.[2;4;6..8]" rejects the same clients.</para>
          <para>An IPv4 address pattern has four fields separated by
".".  Each field is either a decimal number, or a sequence inside "[]"
that contains one or more ";"-separated decimal numbers or
number..number ranges.</para>
          <para>Thus, any pattern field can be a sequence inside
"[]", but a "[]" sequence cannot span multiple address fields, and a
pattern field cannot contain both a number and a "[]" sequence at the
same time.</para>
          <para>This means that the pattern 1.2.[3.4] is not valid
(the sequence [3.4] cannot span two address fields) and the pattern
1.2.3.3[6..9] is also not valid (the last field cannot be both number
3 and sequence [6..9] at the same time).</para>
          <para>The syntax for IPv4 patterns is as follows:</para>
          <screen>
v4pattern = v4field "." v4field "." v4field "." v4field
v4field = v4octet | "[" v4sequence "]"
v4octet = any decimal number in the range 0 through 255
v4sequence = v4seq_member | v4sequence ";" v4seq_member
v4seq_member = v4octet | v4octet ".." v4octet
          </screen></item>
          <item><para>[Feature 20101105] The Postfix SMTP server now
supports DNS-based whitelisting with several safety features:
permit_dnswl_client whitelists a client by IP address, and
permit_rhswl_client whitelists a client by its hostname.  These
features use the same syntax as reject_rbl_client and
reject_rhsbl_client, respectively. The main difference is that they
return PERMIT instead of REJECT.</para>
          <para>Whitelisting is primarily a tool to reduce the false
positive rate of DNS blocklist lookups.  Client name whitelisting
should not be used to make exceptions to access rules. The reason is
that client name lookup can fail unpredictably due to some temporary
outage.</para>
          <para>For safety reasons, permit_dnswl_client and
permit_rhswl_client are silently ignored when they would override
reject_unauth_destination. Also for safety reasons, the result is
DEFER_IF_REJECT when DNS whitelist lookup fails (this result will be
made configurable).</para></item>
        </items>

        <items name="Major changes - sqlite support">
          <item><para>[Feature 20100617] Support for read-only sqlite
database access. See SQLITE_README and sqlite_table(5) for
details.</para></item>
        </items>

        <items name="Major changes - Milter support">
          <item><para>[Incompat 20101103] Postfix now requests default
delivery status notifications when adding a recipient with the Milter
smfi_addrcpt action, instead of "never notify" as with Postfix
automatically-added recipients (always_bcc and
sender/recipient_bcc_maps).</para></item>
        </items>

        <items name="Major changes - alias expansion">
          <item><para>[Incompat 20101202] Postfix now reports a
temporary delivery error when the result of virtual alias expansion
would exceed the virtual_alias_recursion_limit or
virtual_alias_expansion_limit. Previously, Postfix would silently drop
the excess recipients and deliver the message.</para></item>
          <item><para>[Incompat 20101006] To avoid repeated delivery
to mailing lists with pathological nested alias configurations, the
local(8) delivery agent now keeps the owner-alias attribute of a
parent alias, when delivering mail to a child alias that does not have
its own owner alias.</para>
          <para>With this change, local addresses from that
child alias will be written to a new queue file, and a temporary error
with one local address will no longer result in repeated delivery to
other mailing list members.  Specify "reset_owner_alias = yes" for the
older, more fragile, behavior.</para>
          <para>The postconf(5) manpage entry for
"reset_owner_alias" has more background information on this
issue.</para></item>
        </items>

        <items name="Major changes - dns lookup">
          <item><para>[Incompat 20100827] The Postfix SMTP client no
longer appends the local domain when looking up a DNS name without
".".  Specify "smtp_dns_resolver_options = res_defnames" to get the
old behavior, which may produce unexpected results.</para></item>
        </items>

        <items name="Major changes - logging">
          <item><para>[Incompat 20100728] The format of the
"postfix/smtpd[pid]: queueid: client=host[addr]" logfile record has
changed. When available, the before-filter client information and the
before-filter queue ID are now appended to the end of the
record.</para></item>
          <item><para>[Feature 20100728] Improved message tracking
across SMTP-based content filters.  The logging example below is from
an after-filter SMTP server. Here, 951F692462F is a before-filter
queue ID, hades.porcupine.org is a before-filter SMTP client, while
6B4A9924782 is the after-filter queue ID, and localhost[127.0.0.1] is
the SMTP-based content filter that sends mail into the after-filter
SMTP server.</para>
          <screen>
postfix/smtpd[4074]: 6B4A9924782: 
    client=localhost[127.0.0.1],
    orig_queue_id=951F692462F
    orig_client=hades.porcupine.org[168.100.189.10]
          </screen></item>
        </items>

        <items name="Major changes - reply footer">
          <item><para>[Feature 20110105] The SMTP server now supports
contact information that is appended to "reject" responses. This
includes SMTP server responses that aren't logged to the maillog file,
such as responses to syntax errors, or unsupported
commands.</para>
          <screen>
Example:
   smtpd_reject_footer = For assistance, call 800-555-0101.

Server response:
   550-5.5.1 &lt;user@example&gt; Recipient address rejected: User unknown
   550 5.5.1 For assistance, call 800-555-0101.
          </screen>
          <para>This feature supports macro expansion
($client_address, $localtime, etc.), as documented in the postconf(5)
manpage.</para>
          <para>This feature is also supported as
postscreen_reject_footer using the same setting as smtpd_reject_footer
by default.</para></item>
        </items>

        <items name="Major changes - rfc compliance">
          <item><para>[Incompat 20101206] Postfix by default no longer
adds a "To: undisclosed-recipients:;" header when no recipient
specified in the message header.  The Internet mail RFCs have
supported messages without recipient header for almost 10 years
now.</para>
          <para>For backwards compatibility, specify:</para>
          <screen>
/etc/postfix/main.cf
   undisclosed_recipients_header = To: undisclosed-recipients:;
          </screen>
          <para>Note: both the ":" and ";" are
required.</para></item>
        </items>

        <items name="Major changes - tls support">
          <item><para>[Incompat 20110102] The Postfix SMTP server now
always re-computes the SASL mechanism list after successful completion
of the STARTTLS command. Earlier versions only re-computed the
mechanism list when the values of smtp_sasl_tls_security_options and
smtp_sasl_security_options differ.  This could produce incorrect
results, because the Dovecot authentication server may change
responses when the SMTP session is encrypted.</para></item>
          <item><para>[Incompat 20110102] The smtpd_starttls_timeout
default value is now stress-dependent.  By default, TLS negotiations
must now complete under overload in 10s instead of 300s.</para></item>
          <item><para>[Feature 20101223] The new
tls_disable_workarounds parameter specifies a list or bit-mask of
OpenSSL bug work-arounds to disable. This may be necessary if one of
the work-arounds enabled by default in OpenSSL proves to pose a
security risk, or introduces an unexpected interoperability issue.
Some bug work-arounds known to be problematic are disabled in the
default value of the parameter when linked with an OpenSSL library
that could be vulnerable. See postconf(5) and TLS_README for
details.</para></item>
          <item><para>With "tls_preempt_cipherlist = yes" the Postfix
SMTP server will choose its most preferred cipher that is supported
(offered) by the client. This can lead to a more secure or performant
cipher choice, but may also introduce interoperability problems when a
client announces support for a cipher that does not work.  See
postconf(5) and TLS_README for details.</para></item>
          <item><para>[Feature 20101217] The lower-level code in the
TLS engine was simplified by removing an unnecessary layer of data
copying. OpenSSL now writes directly to the network. The difference in
performance should be hardly noticeable.</para></item>
          <item><para>[Incompat 20100610] Postfix no longer appends
the system-supplied default CA certificates to the lists specified
with *_tls_CAfile or with *_tls_CApath. This prevents third-party
certificates from getting mail relay permission with the
permit_tls_all_clientcerts feature.</para>
          <para>Unfortunately this change may cause
compatibility problems when configurations rely on certificate
verification for other purposes. Specify "tls_append_default_CA = yes"
for backwards compatibility.</para></item>
        </items>

        <items name="Major changes - postscreen">
          <item><para>See html/POSTSCREEN_README.html for an
introduction to postscreen (or the text version,
README_FILES/POSTSCREEN_README). The text below summarizes milestones
in reverse chronological order.</para></item>
          <item><para>[Incompat 20110111] The postscreen_access_list
feature replaces the postscreen_whitelist_networks and
postscreen_blacklist_networks features. Reason: CIDR-style access maps
are some 100x faster than the code that implemented the
postscreen_white/blacklist_networks support.  CIDR maps can match
about 100 million CIDR patterns/second on a modern CPU, which is not
blindingly fast but adequate for the near future.</para></item>
          <item><para>[Feature 20110102] STARTTLS support for the
postscreen(8) daemon. This is implemented by a new tlsproxy(8) daemon
that you will need to enable in master.cf (see POSTSCREEN_README for
instructions). tlsproxy(8) implements its own tlsproxy_mumble versions
of TLS-related smtpd_mumble parameters. This leaves no confusion about
which parameters will affect tlsproxy(8) behavior, but it adds another
25 parameters to the documentation.</para></item>
          <item><para>[Incompat 20100912] If your DNSBL queries have a
"secret" in the domain name, you must now censor this information from
the postscreen(8) SMTP replies.  For example:</para>
          <screen>
/etc/postfix/main.cf:
    postscreen_dnsbl_reply_map = texthash:/etc/postfix/dnsbl_reply

/etc/postfix/dnsbl_reply:
    # Secret DNSBL name        Name in postscreen(8) replies
    secret.zen.spamhaus.org    zen.spamhaus.org
          </screen>
          <para>The texthash: format is similar to hash: except
that there is no need to run postmap(1) before the file can be used,
and that it does not detect changes after the file is read. It is new
with Postfix version 2.8.</para></item>
          <item><para>[Incompat 20100912] The postscreen "continue"
action is now called "ignore".  The old name is still supported but no
longer documented.</para></item>
          <item><para>[Incompat 20100912] The postscreen_hangup_action
parameter was removed. Postscreen now always behaves as if
"postscreen_hangup_action = drop".</para></item>
          <item><para>[Incompat 20100912] The
postscreen_cache_retention_time default was increased from 1d to 7d,
to avoid deleting results from expensive deep SMTP protocol tests too
quickly.</para></item>
          <item><para>[Feature 20100912] SMTP protocol engine for deep
protocol tests, and for logging the helo/sender/recipient information
when postscreen rejects an attempt to deliver mail.</para>
          <para>The postscreen SMTP protocol engine implements a
number of deep protocol tests and defers or rejects all attempts to
deliver mail. The first test detects unauthorized SMTP command
pipelining (an SMTP client sends multiple commands, instead of sending
one command and waiting for the server response); a second deep
protocol test implements the Postfix SMTP server's
smtpd_forbidden_commands feature (a client sends commands such as
CONNECT, GET, POST); and a third deep protocol test detects spambots
that send SMTP commands that end in newline instead of
carriage-return/newline.  Real spambots rarely make this mistake, but
poorly-written software often does.</para>
          <para>Deep protocol tests are disabled by default,
because the built-in SMTP engine cannot not hand off the "live"
connection from a good SMTP client to a Postfix SMTP server process.
To work around this, postscreen(8) defers attempts to deliver mail
with a 4XX status, and waits for the client to disconnect. The next
time a good client connects, it will be allowed to talk to a Postfix
SMTP server process to deliver mail.</para></item>
          <item><para>[Feature 20100830] Postscreen DNSBL support is
extended with optional fixed-string filters, with optional integral
weight factors, and with an adjustable threshold to block SMTP clients
with DNSBL score &gt;= that threshold. Reply filters will be implemented
later.</para>
          <para>The updated postscreen configuration syntax
is:</para>
          <screen>
postscreen_dnsbl_sites = domain[=ipaddr][*weight] ...
postscreen_dnsbl_threshold = score
          </screen>
          <para>Elements inside [] are optional, ipaddr is an IPv4
address, and weight and score are integral numbers. The [] are not
part of the postscreen_dnsbl_sites input.  By default, weight and
score are equal to 1, and entries without filter will match any
non-error DNSBL reply.  Use a negative weight value for
whitelisting.</para>
          <para>Examples:</para>
          <para>To use example.com as a high-confidence blocklist,
and to block mail with example.net and example.org only when both
agree, use:</para>
          <screen>
postscreen_dnsbl_threshold = 2
postscreen_dnsbl_sites = example.com*2, example.net, example.org
          </screen>
          <para>To filter only DNSBL replies containing 127.0.0.4,
use:</para>
          <screen>
postscreen_dnsbl_sites = example.com=127.0.0.4
          </screen>
          <para>See also postconf(5) for the fine
details.</para></item>
          <item><para>[Incompat 20100101] When periodic cache cleanup
is enabled (the default), the postscreen(8) server now requires that
the cache database supports the "delete" and "sequence" operations.
To disable periodic cache cleanup specify a zero
postscreen_cache_cleanup_interval value.</para></item>
          <item><para>[Feature 20100101] Periodic cache cleanup for
the postscreen(8) cache database. The time between cache cleanup runs
is controlled with the postscreen_cache_cleanup_interval (default:
12h) parameter. Cache cleanup increases the database access latency,
so this should not be run more often than necessary.</para>
          <para>In addition, the postscreen_cache_retention_time
(default: 1d) parameter specifies how long to keep an expired entry in
the cache. This prevents a client from being logged as "NEW" after its
record expired only a little while ago.</para></item>
          <item><para>[Feature 20091008] Prototype postscreen(8)
server that runs a number of time-consuming checks in parallel for all
incoming SMTP connections, before clients are allowed to talk to a
real Postfix SMTP server. It detects clients that start talking too
soon, or clients that appear on DNS blocklists, or clients that hang
up without sending any command.</para>
          <para>By doing these checks in a single postscreen(8)
process, Postfix can avoid wasting one SMTP server process per
connection. A side benefit of postscreen(8)'s DNSBL lookups is that
DNS records are already cached before the Postfix SMTP server looks
them up later.</para>
          <para>postscreen(8) maintains a temporary whitelist of
positive decisions. Once an SMTP client is whitelisted, it is
immediately forwarded to a real Postfix SMTP server process without
further checking.</para>
          <para>By default, the program logs only statistics, and it
does not run any checks on clients in mynetworks (primarily, to avoid
problems with buggy SMTP implementations in network appliances).  The
logging function alone is already useful for research.</para></item>
        </items>
      </change>

      <change from="2.6.x" to="2.7">
        <items name="Major changes - performance">
          <item><para>[Feature 20100101] Periodic cache cleanup for
the verify(8) cache database. The time between cache cleanup runs is
controlled with the address_verify_cache_cleanup_interval (default:
12h) parameter. Cache cleanup increases the database access latency,
so this should not be run more often than necessary.</para></item>
          <item><para>[Feature 20091109] Improved before-queue filter
performance.  With "smtpd_proxy_options = speed_adjust", the Postfix
SMTP server receives the entire message before it connects to a
before-queue content filter. This means you can run more SMTP server
processes with the same number of running content filter processes,
and thus, handle more mail. This feature is off by default until it is
proven to create no new problems.</para>
          <para>This addresses a concern of people in Europe who
want to reject all bad mail with a before-queue filter. The
alternative, an after-queue filter, means they would have to discard
bad mail (which is illegal) or bounce bad mail (which violates good
network citizenship).</para>
          <para>NOTE 1: When this feature is turned on, a filter
cannot selectively reject recipients of a multi-recipient message.  It
is OK to reject all recipients of the same multi-recipient message, as
is deferring or accepting all recipients of the same multi-recipient
message.</para>
          <para>NOTE 2: This feature increases the minimum amount of
free queue space by $message_size_limit. The extra space is needed to
save the message to a temporary file.</para>
          <para>To keep the performance overhead low, the same
temporary file is reused with successive mail transactions (the file
is of course truncated before reuse, so there is no information
leakage).</para></item>
        </items>

        <items name="Major changes - sender reputation">
          <item><para>[Feature 20100117] The FILTER action in access
maps or header/body_checks now supports sender reputation schemes that
dynamically choose the SMTP source IP address. Typically, mail is
split into classes, and all mail in class X is sent out from an SMTP
client IP address that is reserved for class X.</para>
          <para>This is implemented by specifying FILTER actions
with empty next-hop destinations in access maps or header/body_checks,
and by configuring in master.cf one Postfix SMTP client for each SMTP
source IP address, where each client has its own "-o myhostname" and
"-o smtp_bind_address" settings.</para></item>
          <item><para>[Feature 20091209]
sender_dependent_default_transport_maps, a per-sender override for
default_transport. The original motivation is to use different output
channels (with different source IP addresses) for different sender
addresses, in order to keep their IP-based reputations separate from
each other.</para>
          <para>The result value syntax is that of
default_transport, not transport_maps. Thus,
sender_dependent_default_transport_maps does not support the special
transport_maps result value syntax for null transport, null nexthop,
or null email address.</para>
          <para>This feature makes
sender_dependent_relayhost_maps pretty much redundant (though
sender_dependent_relayhost_maps will often be easier to use because
that is the only thing people want to override).</para></item>
        </items>

        <items name="Major changes - address verification">
          <item><para>[Incompat 20100101] The verify(8) service now
uses a persistent cache by default (address_verify_map =
btree:$data_directory/verify_cache). To disable, specify
"address_verify_map =" in main.cf.</para>
          <para>When periodic cache cleanup is enabled (the
default), the verify(8) server now requires that the cache database
supports the "delete" and "sequence" operations.  To disable periodic
cache cleanup specify a zero address_verify_cache_cleanup_interval
value.</para></item>
          <item><para>[Feature 20100101] Periodic cache cleanup for
the verify(8) cache database. The time between cache cleanup runs is
controlled with the address_verify_cache_cleanup_interval (default:
12h) parameter. Cache cleanup increases the database access latency,
so this should not be run more often than necessary.</para></item>
        </items>

        <items name="Major changes - content filter">
          <item><para>[Incompat 20100117] The meaning of an empty
filter next-hop destination has changed (for example, "content_filter
= foo:" or "FILTER foo:"). Postfix now uses the recipient domain,
instead of using $myhostname as in Postfix 2.6 and earlier.  To
restore the old behavior specify "default_filter_nexthop =
$myhostname", or specify a non-empty next-hop content filter
destination.</para>
          <para>This compatibility option is not needed with
SMTP-based content filters, because these always have an explicit
next-hop destination.</para>
          <para>With pipe-based filters that specify no next-hop
destination, the compatibility option restores the FIFO order of
deliveries. Without the compatibility option, the delivery order for
filters without next-hop destination changes to round-robin domain
selection.</para></item>
          <item><para>[Feature 20100117] The FILTER action in access
maps or header/body_checks now supports sender reputation schemes that
dynamically choose the SMTP source IP address. Typically, mail is
split into classes, and all mail in class X is sent out from an SMTP
client IP address that is reserved for class X.</para>
          <para>This is implemented by specifying FILTER actions
with empty next-hop destinations in access maps or header/body_checks,
and by configuring in master.cf one Postfix SMTP client for each SMTP
source IP address, where each client has its own "-o myhostname" and
"-o smtp_bind_address" settings.</para></item>
          <item><para>[Feature 20091109] Improved before-queue filter
performance.  With "smtpd_proxy_options = speed_adjust", the Postfix
SMTP server receives the entire message before it connects to a
before-queue content filter. This means you can run more SMTP server
processes with the same number of running content filter processes,
and thus, handle more mail. This feature is off by default until it is
proven to create no new problems.</para>
          <para>This addresses a concern of people in Europe who
want to reject all bad mail with a before-queue filter. The
alternative, an after-queue filter, means they would have to discard
bad mail (which is illegal) or bounce bad mail (which violates good
network citizenship).</para>
          <para>NOTE 1: When this feature is turned on, a filter
cannot selectively reject recipients of a multi-recipient message.  It
is OK to reject all recipients of the same multi-recipient message, as
is deferring or accepting all recipients of the same multi-recipient
message.</para>
          <para>NOTE 2: This feature increases the minimum amount of
free queue space by $message_size_limit. The extra space is needed to
save the message to a temporary file.</para>
          <para>To keep the performance overhead low, the same
temporary file is reused with successive mail transactions (the file
is of course truncated before reuse, so there is no information
leakage).</para></item>
        </items>

        <items name="Major changes - milter">
          <item><para>[Feature 20090606] Support for header checks on
Milter-generated message headers.  This can be used, for example, to
control mail flow with Milter-generated headers that carry indicators
for badness or goodness. For details, see the postconf(5) section for
"milter_header_checks". Currently, all header_checks features are
implemented except PREPEND.  </para></item>
        </items>

        <items name="Major changes - multi-instance support">
          <item><para>[Incompat 20090606] The "postmulti -e destroy"
command no longer attempts to remove files that are created AFTER
"postmulti -e create".  It still works as expected immediately after
creating an instance by mistake.  Trying to automatically remove other
files is too risky because Postfix-owned directories are by design not
trusted.</para></item>
        </items>
      </change>

      <note type="installation">
        <para>Postfix has been configured with Berkeley DB, LDAP,
PCRE, and OpenSSL support. The <command>DB_README</command>,
<command>LDAP_README</command>, <command>PCRE_README</command>, and
<command>TLS_README</command> files in the documentation directory,
<command>${SB_INSTALL_PREFIX}/doc/readme-files</command>, contain
information on using these options.</para>
        <para>Because sendmail is installed by default from the OS
vendor, the startup script must be disabled in order for postfix to
bind to the SMTP port. Nothing is done in the postinstall script to
disable the vendor sendmail startup script. Due to possible upgrades
to the OS-provided sendmail installation by the vendor, patches
applied after installing postfix could re-enable the vendor-installed
sendmail. Care will need to be taken when patching systems.</para>
        <para>A special user, "<command>postfix</command>", and two
special groups, "<command>postfix</command>" and
"<command>postdrop</command>", must be created for postfix to operate
correctly. These accounts must be created prior to
installation.</para>
      </note>

      <note type="configuration">
        <para>Configuration files for Postfix are found in the
<command>/etc${SB_INSTALL_PREFIX}</command> directory. The
<command>/var${SB_INSTALL_PREFIX}</command> directory contains the queue directory
and a directory containing the PID of the master Postfix
process.</para>
      </note>
    </notes>
  </program>
</programs>
