<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="netcdf" version="4.0" revision="3">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>lib${SB_PROG_NAME}40</install-name>

    <sources>
      <source checksum="afc057b07b6e6843556dcfbc4ced402c"
        checksum-type="md5" size="11584002"
        path="src/netcdf-4.0.tar.gz"/>
      <patch checksum="3781dc02d7e7634b8a62174ee97b49a8"
        checksum-type="md5" size="13734"
        path="src/netcdf-4.0.tww.patch"/>
      <patch checksum="b6993f05577a326ac4d2d258f535d42f"
        checksum-type="md5" size="3251206"
        path="src/netcdf-4.0.auto.patch"/>
    </sources>

    <test>
<![CDATA[
gmake test
]]>
    </test>

    <module name="default">
      <dependencies>
        <depend program="gcc" install-name="gcc44" add-path="prepend"
          systype="*-aix*|*-hpux*|*-irix*|*-osf*">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"
          systype="*-aix*|*-hpux*|*-irix*|*-osf*"/>
        <depend program="hdf5" var="LIBHDF5" install-name="libhdf518"
          systype="*-linux*|*-solaris*">v&gt;=1.8.2</depend>
        <depend program="hdf5" var="LIBHDF5" install-name="libhdf518"
          module="gcc44"
          systype="*-aix*|*-hpux*|*-irix*|*-osf*">v&gt;=1.8.2</depend>
        <depend program="zlib" var="LIBZ"
          install-name="libz12">v&gt;=1.2.5</depend>
      </dependencies>

      <validate>
        <depend program="netcdf" module="64bit"
          systype="*-solaris*">v==4.0</depend>
        <depend program="netcdf" module="gcc44"
          systype="*-linux*|*-solaris*">v==4.0</depend>
        <depend program="netcdf" module="64bit-gcc44"
          systype="*-solaris*">v==4.0</depend>
      </validate>

      <script-header>
<![CDATA[
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc"
  CXXFLAGS="-O2 -mcpu=powerpc"
  FC=gfortran FCFLAGS="-O2 -mcpu=powerpc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:"

  _gcc=gcc44
  ARGS="--libdir=${SB_INSTALL_PREFIX_LIB}/${_gcc}"
  ;;
ia64*-hpux*)
  FC=gfortran
  CC_LD_RT="-Wl,+b,"

  _gcc=gcc44
  ARGS="--libdir=${SB_INSTALL_PREFIX_LIB}/gcc44" ;;
*-hpux*)
  FC=gfortran
  CC_LD_RT="-Wl,+b,"

  _gcc=gcc44
  ARGS="--libdir=${SB_INSTALL_PREFIX_LIB}/${_gcc}" ;;
*-irix*|*-osf*)
  FC=gfortran
  CC_LD_RT="-Wl,-rpath,"

  _gcc=gcc44
  ARGS="--libdir=${SB_INSTALL_PREFIX_LIB}/${_gcc}" ;;
i?86*-linuxe4)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  FFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  FC=gfortran FCFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linuxe4*)
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  FC=gfortran
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CXX=CC CXXFLAGS="-xO2 -xtarget=pentium4"
  FC=f95 FCFLAGS="-xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 -xarch=v8plusa"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -xarch=v8plusa"
  FC=f95 FCFLAGS="-xO2 -xtarget=ultra2 -xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CXX=CC CXXFLAGS="-xO2 -xtarget=ultra2 -m32 -xarch=sparcvis"
  FC=f95 FCFLAGS="-xO2 -xtarget=ultra2 -m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
FC=${FC:-} FCFLAGS="${FCFLAGS:--O2}" \
F77="${FC-g77}" FFLAGS="${FFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBHDF5_INC}${_gcc+/${_gcc}}" \
LDFLAGS="-L${SB_VAR_LIBHDF5_LIB}${_gcc+/${_gcc}} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${SB_VAR_GCC_RT+-L${SB_VAR_GCC_RT_LIB}} \
${CC_LD_RT}${SB_VAR_LIBHDF5_LIB}${_gcc+/${_gcc}}\
${SB_VAR_GCC_RT+:${SB_VAR_GCC_RT_LIB}}\
${SB_VAR_LIBZ+:${SB_VAR_LIBZ_LIB}} ${LDFLAGS+${LDFLAGS}}" \
ac_cv_type_long_long_int=yes \
ac_cv_type_unsigned_long_long_int=yes \
${SB_VAR_LIBZ+--with-zlib=${SB_VAR_LIBZ}} \
--with-hdf5=/do/not/substitute/a/relative/dir \
--with-netcdf-c-lib=/do/not/want \
--enable-docs-install --enable-f77 ${FC:+--enable-f90} \
--enable-netcdf-4 --enable-shared --enable-static \
--disable-dependency-tracking ${ARGS+${ARGS}} \
--docdir=${_docdir} --infodir=${SB_INSTALL_PREFIX}/info \
--mandir=${SB_INSTALL_PREFIX}/man \
--prefix=${SB_INSTALL_PREFIX}

gmake configure

# libtool-1.5.x does not have an 'FC' tag?
${SB_PATH_SED} -i -e 's!--mode=!--tag=F77 --mode=!;' f90/Makefile
]]>
      </configure>

      <test>
<![CDATA[
gmake test
]]>
      </test>

      <install>
<![CDATA[
gmake install

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_docdir}/texinfo
${SB_PATH_INSTALL} -m 644 -o root -g 0 man/*.texi \
man/simple_xy.cdl man/simple_xy_wr.c man/simple_xy_rd.c \
man/simple_xy_wr.f man/simple_xy_rd.f man/simple_xy_wr.f90 \
man/simple_xy_rd.f90 man/simple_xy_wr.cpp man/simple_xy_rd.cpp \
man/sfc_pres_temp.cdl man/sfc_pres_temp_wr.c \
man/sfc_pres_temp_rd.c man/sfc_pres_temp_wr.f \
man/sfc_pres_temp_rd.f man/sfc_pres_temp_wr.f90 \
man/sfc_pres_temp_rd.f90 man/sfc_pres_temp_wr.cpp \
man/sfc_pres_temp_rd.cpp man/pres_temp_4D.cdl \
man/pres_temp_4D_wr.c man/pres_temp_4D_rd.c \
man/pres_temp_4D_wr.f man/pres_temp_4D_wr.f90 \
man/pres_temp_4D_rd.f90 man/pres_temp_4D_wr.cpp \
man/pres_temp_4D_rd.cpp ${_docdir}/texinfo
]]>
      </install>
    </module>

    <module name="64bit"
    systype="*-solaris*">
      <dependencies>
        <depend program="hdf5" var="LIBHDF5" install-name="libhdf518"
          module="64bit">v&gt;=1.8.2</depend>
        <depend program="zlib" var="LIBZ" install-name="libz12"
          module="64bit">v&gt;=1.2.5</depend>
      </dependencies>

      <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
i?86-*solaris*)
  _libdir="lib/amd64" ;;
*-solaris*)
  _libdir="lib/sparcv9" ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -m64 \
-xarch=sse2"
  CXX=CC CXXFLAGS="-xO2 -xtarget=opteron -m64 -xarch=sse2"
  FC=f95 FCFLAGS="-xO2 -xtarget=opteron -m64 -xarch=sse2" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -xarch=v9"
  CXX=CC CXXFLAGS="-xO2 -xtarget=generic -xarch=v9"
  FC=f95 FCFLAGS="-xO2 -xtarget=generic -xarch=v9" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -m64 \
-xarch=sparc"
  CXX=CC CXXFLAGS="-xO2 -xtarget=generic -m64 -xarch=sparc"
  FC=f95 FCFLAGS="-xO2 -xtarget=generic -m64 -xarch=sparc" ;;
esac
CC_LD_RT="-R"

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
FC="${FC:-}" FCFLAGS="${FCFLAGS:--O2}" \
F77="${FC}" FFLAGS="${FCFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBHDF5_INC}/64" \
LDFLAGS="-L${SB_VAR_LIBHDF5}/${_libdir} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ}/${_libdir}} \
${CC_LD_RT}${SB_VAR_LIBHDF5}/${_libdir}\
${SB_VAR_LIBZ+:${SB_VAR_LIBZ}/${_libdir}}" \
ac_cv_type_long_long_int=yes \
ac_cv_type_unsigned_long_long_int=yes \
--with-hdf5=/do/not/substitute/a/relative/dir \
--with-netcdf-c-lib=/do/not/want \
--enable-f90 --enable-netcdf-4 \
--enable-shared --enable-static \
--disable-dependency-tracking ${ARGS+${ARGS}} \
--libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
--prefix=${SB_INSTALL_PREFIX}

gmake configure

# libtool-1.5.x does not have an 'FC' tag?
${SB_PATH_SED} -i -e 's!--mode=!--tag=F77 --mode=!;' f90/Makefile
]]>
      </configure>

      <test>
<![CDATA[
gmake test
]]>
      </test>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/lib/64 ]; then
  case "${SB_SYSTYPE}" in
  *-solaris*)
    ln -s ./$(basename ${_libdir}) ${SB_INSTALL_PREFIX}/lib/64 ;;
  esac
fi

gmake -C cxx install-libLTLIBRARIES
gmake -C libsrc4 install-libLTLIBRARIES
gmake -C fortran install-libLTLIBRARIES
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/lib/64 ${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <module name="gcc44"
    systype="*-linux*|*-solaris*">
      <dependencies>
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"/>
        <depend program="hdf5" var="LIBHDF5" install-name="libhdf518"
          module="gcc44">v&gt;=1.8.2</depend>
        <depend program="zlib" var="LIBZ"
          install-name="libz12">v&gt;=1.2.5</depend>
      </dependencies>

      <script-header>
<![CDATA[
_gcc="gcc44"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  FFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CXXFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  FFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CXXFLAGS="-O2 -mcpu=ultrasparc -mvis"
  FFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
F77="gfortran" FFLAGS="${FFLAGS:--O2}"  \
CPPFLAGS="-I${SB_VAR_LIBHDF5_INC}/${_gcc}" \
LDFLAGS="-L${SB_VAR_GCC_RT_LIB} \
-L${SB_VAR_LIBHDF5}/lib/${_gcc} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ_LIB}} \
${CC_LD_RT}${SB_VAR_LIBHDF5}/lib/gcc44:\
${SB_VAR_GCC_RT_LIB}}\
${SB_VAR_LIBZ+:${SB_VAR_LIBZ_LIB}} \
${LDFLAGS+${LDFLAGS}}" \
ac_cv_type_long_long_int=yes \
ac_cv_type_unsigned_long_long_int=yes \
--with-hdf5=/do/not/substitute/a/relative/dir \
--with-netcdf-c-lib=/do/not/want \
--enable-f77 --disable-f90 --enable-netcdf-4 \
--enable-shared --enable-static \
--disable-dependency-tracking ${ARGS+${ARGS}} \
--libdir="${SB_INSTALL_PREFIX}/lib/${_gcc}" \
--prefix=${SB_INSTALL_PREFIX}

gmake configure

# libtool-1.5.x does not have an 'FC' tag?
${SB_PATH_SED} -i -e 's!--mode=!--tag=F77 --mode=!;' f90/Makefile
]]>
      </configure>

      <test>
<![CDATA[
gmake test
]]>
      </test>

      <install>
<![CDATA[
gmake -C cxx install-libLTLIBRARIES
gmake -C libsrc4 install-libLTLIBRARIES
gmake -C fortran install-libLTLIBRARIES
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX_LIB}/${_gcc}
]]>
      </uninstall>
    </module>

    <module name="64bit-gcc44"
    systype="*-solaris*">
      <dependencies>
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"/>
        <depend program="hdf5" var="LIBHDF5" install-name="libhdf518"
          module="64bit-gcc44">v&gt;=1.8.2</depend>
        <depend program="zlib" var="LIBZ" install-name="libz12"
          module="64bit">v&gt;=1.2.5</depend>
      </dependencies>

      <script-header>
<![CDATA[
_gcc="gcc44"

case "${SB_SYSTYPE}" in
i?86-*solaris*)
  _gcc_arch="amd64"
  _dep_libdir="lib/amd64"
  _libdir="lib/${_gcc}/amd64" ;;
*-solaris*)
  _gcc_arch="sparcv9"
  _dep_libdir="lib/sparcv9"
  _libdir="lib/${_gcc}/sparcv9" ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
i?86*-solaris*)
  CFLAGS="-O2 -m64"
  CXXFLAGS="-O2 -m64"
  FFLAGS="-O2 -m64"
  CC_LD_RT="-R" ;;
*-solaris*)
  CFLAGS="-O2 -m64 -mcpu=v9"
  CXXFLAGS="-O2 -m64 -mcpu=v9"
  FFLAGS="-O2 -m64 -mcpu=v9"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CXX="${CXX:-g++}" CXXFLAGS="${CXXFLAGS:--O2}" \
F77=gfortran FFLAGS="${FFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBHDF5_INC}/${_gcc}/64" \
LDFLAGS="-L${SB_VAR_GCC_RT_LIB}/${_gcc_arch} \
-L${SB_VAR_LIBHDF5}/${_libdir} \
${SB_VAR_LIBZ+-L${SB_VAR_LIBZ}/${_dep_libdir}} \
${CC_LD_RT}${SB_VAR_GCC_RT_LIB}/${_gcc_arch}:\
${SB_VAR_LIBHDF5}/${_libdir}\
${SB_VAR_LIBZ+:${SB_VAR_LIBZ}/${_dep_libdir}}" \
ac_cv_type_long_long_int=yes \
ac_cv_type_unsigned_long_long_int=yes \
--with-hdf5=/do/not/substitute/a/relative/dir \
--with-netcdf-c-lib=/do/not/want \
--libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
${ARGS+${ARGS}} --disable-dependency-tracking \
--enable-f77 --disable-f90 --enable-netcdf-4 \
--enable-shared --enable-static \
--libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
--prefix=${SB_INSTALL_PREFIX}

gmake configure

# libtool-1.5.x does not have an 'FC' tag?
${SB_PATH_SED} -i -e 's!--mode=!--tag=F77 --mode=!;' f90/Makefile
]]>
      </configure>

      <test>
<![CDATA[
gmake test
]]>
      </test>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/lib/${_gcc}/64 ]; then
  case "${SB_SYSTYPE}" in
  *-solaris*)
    ln -s ./$(basename ${_libdir}) \
    ${SB_INSTALL_PREFIX}/lib/${_gcc}/64 ;;
  esac
fi

gmake -C cxx install-libLTLIBRARIES
gmake -C libsrc4 install-libLTLIBRARIES
gmake -C fortran install-libLTLIBRARIES
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/lib/${_gcc}/64 \
${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <notes>
      <change from="3.6.x" to="4.0">
        <item><para>Introduced the use of HDF5 as a storage layer,
which allows use of groups, user-defined types, multiple unlimited
dimensions, compression, data chunking, parallel I/O, and other
features. See the netCDF Users Guide for more
information.</para></item>
      </change>

      <change from="3.6.2" to="3.6.3">
        <item><para>In ncdump and ncgen, added CDL support for UTF-8
encoding of characters in names and for escaped special chars in
names.  Made sure UTF-8 names are normalized using NFC rules before
storing or comparing.</para></item>
        <item><para>Handle IEEE NaNs and infinities in a
platform-independent way in ncdump output.</para></item>
        <item><para>Added support for ARM representation of
doubles</para></item>
        <item><para>Fixed bug in C++ API creating 64-bit offset files.
(See <ulink url="http://www.unidata.ucar.edu/software/netcdf/docs/known_problems.html#cxx_64-bit">http://www.unidata.ucar.edu/software/netcdf/docs/known_problems.html#cxx_64-bit</ulink>.)</para></item>
        <item><para>Fixed bug for variables larger than 4 GB. (See
<ulink url="http://www.unidata.ucar.edu/software/netcdf/docs/known_problems.html#large_vars_362">http://www.unidata.ucar.edu/software/netcdf/docs/known_problems.html#large_vars_362</ulink>.)</para></item>
        <item><para>Changed the configure.ac to build either 3.6.x or
4.x build from the same configure.ac.</para></item>
        <item><para>Build now checks gfortran version and handles it
cleanly, also Portland Group in Intel fortran, with various
configurations.</para></item>
        <item><para>A Fortran netcdf.inc file is now created at build
time, based on the setting of --disable-v2. </para></item>
        <item><para>Documentation has been fixed in several
places.</para></item>
        <item><para>Upgraded to automake 1.10, autoconf 2.62, and
libtool 2.2.2.</para></item>
        <item><para>Includes missing Windows Visual Studio build
files.</para></item>
        <item><para>Fixed missing include of config.h in a C++ test
program.</para></item>
        <item><para>Fixed maintainer-clean in man
directory.</para></item>
        <item><para>Fixed --enable-c-only and make
check.</para></item>
        <item><para>Fixed behavior when opening a zero-length
file.</para></item>
        <item><para>Many portability enhancements to build cleanly on
various platforms. </para></item>
        <item><para>Turned on some old test programs which were not
being used in the build.</para></item>
      </change>

      <note type="usage">
        <para>Versions of the library for the vendor compiler and GCC
4.4.6 are available in the following directories:</para>
        <screen>
${SB_INSTALL_PREFIX}/lib            # Vendor compiler
${SB_INSTALL_PREFIX}/lib/gcc44      # GCC 4.4.6
        </screen>

        <para>64-bit versions of the library on Solaris 8+ for the
vendor compiler and GCC 4.4.6 are available in the following
directories:</para>
        <screen>
${SB_INSTALL_PREFIX}/lib/64         # Vendor compiler
${SB_INSTALL_PREFIX}/lib/gcc44/64   # GCC 4.4.6
        </screen>

        <para>The Fortran 90 libraries are only available on
Solaris and RHEL 5.x.</para>
      </note>
    </notes>

    <changelog>
      <change date="2012 January 25" revision="3"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Update gcc dependency from 4.2.4 to
4.4.6</para></item>
        <item><para>Add support for AIX 7.1</para></item>
        <item><para>Remove support for Solaris 6 and 7, RHEL 3 and
SLES 10</para></item>
      </change>

      <change date="2010 November 2" revision="2"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>
    </changelog>
  </program>
</programs>
