<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="razor-agents" version="2.85" revision="2">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>razor28</install-name>

    <sources>
      <source checksum="014d08db40187cb1316482191566b012"
        checksum-type="md5" size="81691"
        path="src/razor-agents-2.85.tar.bz2"/>
      <patch checksum="31877af3a0ec6f91d7ef28e3ffff68bd"
        checksum-type="md5" size="2219"
        path="src/razor-agents-2.85.tww.patch"/>
    </sources>

    <dependencies>
      <depend program="Digest-SHA1"
        module="5.12.2">v&gt;=2.11</depend>
      <depend program="URI" module="5.12.2">v&gt;=1.59</depend>
      <depend program="gcc" install-name="gcc44"
        add-path="prepend">v&gt;=4.4.6</depend>
      <depend program="perl" var="PERL">v==5.12.2</depend>
    </dependencies>

    <configure>
<![CDATA[
${SB_VAR_PERL}/bin/perl Makefile.PL \
PREFIX=${SB_INSTALL_PREFIX} \
INSTALLSITELIB=${SB_INSTALL_PREFIX_LIB} \
INSTALLSITEARCH=${SB_INSTALL_PREFIX_LIB}
]]>
    </configure>

    <build>
<![CDATA[
gmake

${SB_PATH_SED} -i -e "\
s!@prefix@!${SB_INSTALL_PREFIX}!" blib/script/*
]]>
    </build>

    <test>
<![CDATA[
gmake test
]]>
    </test>

    <install>
<![CDATA[
gmake install

rm ${SB_INSTALL_PREFIX}/bin/razor-client

rm -rf ${SB_INSTALL_PREFIX}/lib/5.12.2 \
${SB_INSTALL_PREFIX}/lib/auto/razor-agents
]]>
    </install>

    <notes>
      <change from="2.83" to="2.84">
        <item><para>Update discovery hostname</para></item>
      </change>

      <change from="2.82" to="2.83">
        <item><para>Remove all uses of $' from code. This removes a
global regex engine slowdown. [issues.apache.org #5312]</para></item>
        <item><para>Comment out or replace shell commands with Perl
equivalents. This removes the prerequisites of uname(1) and GNU
mkdir(1).</para></item>
      </change>

      <change from="2.81" to="2.82">
        <item><para>Always disconnect from discovery server after
performing discovery. This fixes a long standing bug wherein
razor-report and razor-check would attempt to report to or check
against the discovery servers.</para></item>
      </change>

      <change from="2.80" to="2.81">
        <item><para>Update service policy</para></item>
      </change>

      <change from="2.79" to="2.80">
        <item><para>Untaint filenames loaded from the config file.
[Bug #1395719]</para></item>
      </change>

      <change from="2.78" to="2.79">
        <item><para>Change C++ comments to C comments. [Patch
#1431589]</para></item>
      </change>

      <change from="2.77" to="2.78">
        <item><para>When registering with a username and password,
accept existing credentials if they authenticate
successfully</para></item>
        <item><para>When autoregistering, attempt to write a test
identity before attempting to register credentials</para></item>
        <item><para>Always remove the existing identity symlink before
overwriting, as -e $fn can return false for a symlink that still
exists</para></item>
        <item><para>Added several error checks to the register
process</para></item>
        <item><para>Disconnect from the register server before
returning when errors occur</para></item>
        <item><para>Ensure that checks and reports are sent to the
appropriate servers. [Bug #1267559]</para></item>
      </change>

      <change from="2.76" to="2.77">
        <item><para>Fixed corrupted distribution</para></item>
      </change>

      <change from="2.75" to="2.76">
        <item><para>When no reporter identity is found, attempt to
register automatically</para></item>
        <item><para>When -home is specified on the command line,
default global_razorhome to the provided value. [Gentoo
#101070]</para></item>
      </change>

      <change from="2.74" to="2.75">
        <item><para>Removed two debugging statements accidentally
checked into 2.74</para></item>
        <item><para>Applied syslog patch from Debian bug #295727 to
reintroduce support for 'sys-syslog' and 'syslog' log targets.
[Feature #1229433]</para></item>
        <item><para>Modified Makefile.PL to honor DESTDIR when
installing section 5 man pages. [Bug #1227167]</para></item>
        <item><para>Fixed failure for razor-agents to exit with error
when unknown parameters were specified. [Bug #1229450]</para></item>
        <item><para>Fixed bug for when razor-agents was invoked
without ``-f'' but reading from STDIN, causing the shell to be
unusable until the forked background process was killed off. [Bug
#1229887]</para></item>
      </change>

      <change from="2.72" to="2.74">
        <item><para>Fixed handling of configuration options; under
certain circumstances, neither the defaults nor the configuration file
would set necessary variables such as
listfile_discovery.</para></item>
        <item><para>Fixed handling of -home option; when provided, it
will be accepted without further checks</para></item>
        <item><para>Fixed installation of man(5) pages by non-root
users to local man directories. [Patch #1227162]</para></item>
        <item><para>Reverted a patch that was intended to add support
for overriding razorhome under certain circumstances. The patch
introduced new issues with external program integration (eg. Amavis).
[Bug #1074391]</para></item>
        <item><para>Corrected a spelling error in a debug
message</para></item>
        <item><para>Added several defined checks to avoid unnecessary
warnings when manipulating server lists</para></item>
        <item><para>Corrected the preprocessing fix shipped with 2.70
and updated the test suite to match. [Bug #1001417]</para></item>
        <item><para>Updated preproc implementation (deHTMLxs) to match
other clients</para></item>
      </change>

      <note type="configuration">
        <para>To report SPAM to Vipul's Razor, an identity must be
created with the following command. This creates
<command>~/.razor/identity</command> with a unique id.</para>
        <screen>
$ razor-admin -register
        </screen>

        <para>The <command>razor-check</command> command checks a mail
against the distributed Razor Catalogue by communicating with a Razor
Catalogue Server. <command>razor-check(1)</command> contains procmail
rules to check incoming mail against the Razor Catalogue.</para>
      </note>
    </notes>

    <changelog>
      <change date="2012 January 19" revision="2"
      author="Peter O'Gorman" email="pogma@thewrittenword.com">
        <item><para>Update Digest-SHA1 dependency from 2.11 to
2.13</para></item>
        <item><para>Update URI dependency from 1.37 to
1.59</para></item>
        <item><para>Update perl dependency from 5.8.8 to
5.12.2</para></item>
        <item><para>Update gcc dependency from 4.2.4 to
4.4.6</para></item>
      </change>
    </changelog>
  </program>
</programs>
