<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="libpcap" version="1.2.0" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>${SB_PROG_NAME}12</install-name>

    <sources>
      <source checksum="dfb8aa690b7a29821bfa183025436569"
        checksum-type="md5" size="597758"
        path="src/libpcap-1.2.0.tar.gz"/>
      <patch checksum="e40fbdbec50f2a35058415f41ce630d5"
        checksum-type="md5" size="40667"
        path="src/libpcap-1.2.0.tww.patch"/>
      <patch checksum="34555c025c9e2614ab145dbe4bed18e9"
        checksum-type="md5" size="739523"
        path="src/libpcap-1.2.0.gnulib.patch"/>
      <patch checksum="cd03c62f8ba2808e1bb859f06db475bd"
        checksum-type="md5" size="1432494"
        path="src/libpcap-1.2.0.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="bison" install-name="bison24"
        add-path="prepend" type="build">v&gt;=2.4.3</depend>
      <depend program="flex" install-name="flex25" add-path="prepend"
        type="build">v&gt;=2.5.35</depend>
    </dependencies>

    <script-header>
<![CDATA[
_docdir="${SB_INSTALL_PREFIX}/doc"
]]>
    </script-header>

    <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Onofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b,"

  ARGS="--enable-ipv6" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="+O2 -Ae -z +Onofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Onofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  ARGS="--enable-ipv6" ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--enable-ipv6" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  ARGS="--enable-ipv6" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R"

  ARGS="--enable-ipv6" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R"

  ARGS="--enable-ipv6" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R"

  ARGS="--enable-ipv6" ;;
esac

# missing is a directory in the original tarball
rm -rf missing
mv automake-missing missing

# ensure that scanner.c, grammar.c get rebuilt
rm -f scanner.c grammar.c

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
LDFLAGS="${LDFLAGS+${LDFLAGS}}" --disable-dependency-tracking \
--mandir="${SB_INSTALL_PREFIX}/man" ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" libpcap.pc
]]>
    </configure>

    <install>
<![CDATA[
gmake install

${SB_PATH_INSTALL} -m 755 -o root -g 0 -d ${_docdir}
${SB_PATH_INSTALL} -m 644 -o root -g 0 README README.aix \
README.hpux README.linux README.tru64 ${_docdir}
]]>
    </install>

    <licenses>
      <license>
        <para>Redistribution and use in source and binary forms, with
or without modification, are permitted provided that the following
conditions are met:</para>
        <orderedlist>
          <item><para>Redistributions of source code must retain the
above copyright notice, this list of conditions and the following
disclaimer.</para></item>
          <item><para>Redistributions in binary form must reproduce
the above copyright notice, this list of conditions and the following
disclaimer in the documentation and/or other materials provided with
the distribution.</para></item>
          <item><para>The names of the authors may not be used to
endorse or promote products derived from this software without
specific prior written permission.</para></item>
        </orderedlist>

        <para>THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.</para>
      </license>
    </licenses>

    <notes>
      <change from="1.1.2" to="1.2.0">
        <item><para>Changes to error handling for
pcap_findalldevs().</para></item>
        <item><para>Fix the calculation of the frame size in
memory-mapped captures.</para></item>
        <item><para>Add a link-layer header type for STANAG 5066
D_PDUs.</para></item>
        <item><para>Add a link-layer type for a variant of 3GPP TS
27.010.</para></item>
        <item><para>Noted real nature of LINKTYPE_ARCNET.</para></item>
        <item><para>Add a link-layer type for DVB-CI.</para></item>
        <item><para>Fix configure-script discovery of VLAN acceleration
support. see
http://netoptimizer.blogspot.com/2010/09/tcpdump-vs-vlan-tags.html</para></item>
        <item><para>Linux, HP-UX, AIX, NetBSD and OpenBSD
compilation/conflict fixes.</para></item>
        <item><para>Protect against including AIX 5.x's
&lt;net/bpf.h&gt; having been included.</para></item>
        <item><para>Add DLT_DBUS, for raw D-Bus messages.</para></item>
        <item><para>Treat either EPERM or EACCES as "no soup for
you".</para></item>
        <item><para>Changes to permissions on DLPI
systems.</para></item>
        <item><para>Add DLT_IEEE802_15_4_NOFCS for 802.15.4
interfaces.</para></item>
      </change>

      <change from="1.1.1" to="1.1.2">
        <item><para>Return DLT_ values, not raw LINKTYPE_ values from
pcap_datalink() when reading pcap-ng files</para></item>
        <item><para>Add support for "wlan ra" and "wlan ta", to check
the RA and TA of WLAN frames that have them</para></item>
        <item><para>Don't crash if "wlan addr{1,2,3,4}" are used without
802.11 headers</para></item>
        <item><para>Do filtering on USB and Bluetooth
capturing</para></item>
        <item><para>On FreeBSD/SPARC64, use -fPIC - it's apparently
necessary</para></item>
        <item><para>Check for valid port numbers (fit in a 16-bit
unsigned field) in "port" filters</para></item>
        <item><para>Reject attempts to put savefiles into non-blocking
mode</para></item>
        <item><para>Check for "no such device" for the "get the media
types" ioctl in *BSD</para></item>
        <item><para>Improve error messages from bpf_open(), and let it
do the error handling</para></item>
        <item><para>Return more specific errors from
pcap_can_set_rfmon(); fix documentation</para></item>
        <item><para>Update description fetching code for FreeBSD, fix
code for OpenBSD</para></item>
        <item><para>Ignore /sys/net/dev files if we get ENODEV for them,
not just ENXIO; fixes handling of bonding devices on Linux</para></item>
        <item><para>Fix check for a constant 0 argument to
BPF_DIV</para></item>
        <item><para>Use the right version of ar when
cross-building</para></item>
        <item><para>Free any filter set on a savefile when the savefile
is closed</para></item>
        <item><para>Include the CFLAGS setting when configure was run in
the compiler flags</para></item>
        <item><para>Add support for 802.15.4 interfaces on
Linux</para></item>
      </change>

      <change from="1.1.0" to="1.1.1">
        <item><para>Update CHANGES to reflect more of the changes in
1.1.0.</para></item>
        <item><para>Fix build on RHEL5.</para></item>
        <item><para>Fix shared library build on AIX.</para></item>
      </change>

      <change from="1.0.0" to="1.1.0">
        <item><para>Add SocketCAN capture support</para></item>
        <item><para>Add Myricom SNF API support</para></item>
        <item><para>Update Endace DAG and ERF support</para></item>
        <item><para>Add support for shared libraries on Solaris,
HP-UX, and AIX</para></item>
        <item><para>Build, install, and un-install shared libraries by
default; don't build/install shared libraries on platforms we don't
support</para></item>
        <item><para>Fix building from a directory other than the
source directory</para></item>
        <item><para>Fix compiler warnings and builds on some
platforms</para></item>
        <item><para>Update config.guess and config.sub</para></item>
        <item><para>Support monitor mode on mac80211 devices on
Linux</para></item>
        <item><para>Fix USB memory-mapped capturing on Linux; it
requires a new DLT_ value</para></item>
        <item><para>On Linux, scan /sys/class/net for devices if we
have it; scan it, or /proc/net/dev if we don't have /sys/class/net,
even if we have getifaddrs(), as it'll find interfaces with no
addresses</para></item>
        <item><para>Add limited support for reading pcap-ng
files</para></item>
        <item><para>Fix BPF driver-loading error handling on
AIX</para></item>
        <item><para>Support getting the full-length interface
description on FreeBSD</para></item>
        <item><para>In the lexical analyzer, free up any addrinfo
structure we got back from getaddrinfo().</para></item>
        <item><para>Add support for BPF and libdlpi in OpenSolaris
(and SXCE)</para></item>
        <item><para>Hyphenate "link-layer" everywhere</para></item>
        <item><para>Add /sys/kernel/debug/usb/usbmon to the list of
usbmon locations</para></item>
        <item><para>In pcap_read_linux_mmap(), if there are no frames
available, call poll() even if we're in non-blocking mode, so we pick
up errors, and check for the errors in question.</para></item>
        <item><para>Note that poll() works on BPF devices is Snow
Leopard</para></item>
        <item><para>If an ENXIO or ENETDOWN is received, it may mean
the device has gone away.  Deal with it.</para></item>
        <item><para>For BPF, raise the default capture buffer size to
from 32k to 512k</para></item>
        <item><para>Support ps_ifdrop on Linux</para></item>
        <item><para>Added a bunch of #ifdef directives to make
wpcap.dll (WinPcap) compile under cygwin.</para></item>
        <item><para>Changes to Linux mmapped captures.</para></item>
        <item><para>Fix bug where create_ring would fail for
particular snaplen and buffer size combinations</para></item>
        <item><para>Update pcap-config so that it handles libpcap
requiring additional libraries</para></item>
        <item><para>Add workaround for threadsafeness on
Windows</para></item>
        <item><para>Add missing mapping for DLT_ENC &lt;-&gt;
LINKTYPE_ENC</para></item>
        <item><para>DLT: Add DLT_CAN_SOCKETCAN</para></item>
        <item><para>DLT: Add Solaris ipnet</para></item>
        <item><para>Don't check for DLT_IPNET if it's not
defined</para></item>
        <item><para>Add link-layer types for Fibre Channel
FC-2</para></item>
        <item><para>Add link-layer types for Wireless
HART</para></item>
        <item><para>Add link-layer types for AOS</para></item>
        <item><para>Add link-layer types for DECT</para></item>
        <item><para>Autoconf fixes (AIX, HP-UX, OSF/1, Tru64
cleanups)</para></item>
        <item><para>Install headers unconditionally, and include
vlan.h/bluetooth.h if enabled</para></item>
        <item><para>Autoconf fixes+cleanup</para></item>
        <item><para>Support enabling/disabling bluetooth
(--{en,dis}able-bluetooth)</para></item>
        <item><para>Support disabling SITA support
(--without-sita)</para></item>
        <item><para>Return -1 on failure to create packet ring (if
supported but creation failed)</para></item>
        <item><para>Fix handling of 'any' device, so that it can be
opened, and no longer attempt to open it in Monitor mode</para></item>
        <item><para>Add support for snapshot length for USB
Memory-Mapped Interface</para></item>
        <item><para>Fix configure and build on recent Linux
kernels</para></item>
        <item><para>Fix memory-mapped Linux capture to support
pcap_next() and pcap_next_ex()</para></item>
        <item><para>Fixes for Linux USB capture</para></item>
        <item><para>DLT: Add DLT_LINUX_EVDEV</para></item>
        <item><para>DLT: Add DLT_GSMTAP_UM</para></item>
        <item><para>DLT: Add DLT_GSMTAP_ABIS</para></item>
      </change>

      <platform name="Tru64 UNIX">
        <para>For applications linked against libpcap to work, the
kernel must be compiled to support the packetfilter(7) pseudo-device
driver. This is done by adding the option '<command>options
PACKETFILTER</command>' to your kernel configuration file in
<command>/sys/conf/[KERNEL CONFIG]</command>. Once added, recompile
the kernel with '<command>doconfig -c [KERNEL CONFIG]</command>' and
reboot to use the new kernel. The packetfilter devices must be created
as well:</para>
        <screen>
$ /bin/su
# cd /dev
# ./MAKEDEV pfilt
        </screen>

        <para>Finally, the interface you wish to listen on must be
allowed to enter promiscuous mode. This is done as follows:</para>
        <screen>
# /usr/sbin/pfconfig +promisc [INTERFACE]
# /usr/sbin/pfconfig +copyall [INTERFACE]
        </screen>
      </platform>
    </notes>
  </program>
</programs>
