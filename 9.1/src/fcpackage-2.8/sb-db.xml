<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="fcpackage" version="2.8" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>fcpackage28</install-name>

    <sources>
      <source checksum="8b79e3185dd63a6dbff204dc6043c080"
        checksum-type="md5" size="1906974"
        path="src/fcpackage-2.8.tar.bz2"/>
      <patch checksum="716df15bd58a5f6b3aa94a20bbf7eee6"
        checksum-type="md5" size="202987"
        path="src/fcpackage-2.8.tww.patch"/>
      <patch checksum="cc9819432d7db61311294c485e6513fa"
        checksum-type="md5" size="5328815"
        path="src/fcpackage-2.8.auto.patch"/>
      <source checksum="e7ca1ed90e9d8de22249e453d1cffd8e"
        checksum-type="md5" size="3975"
        path="src/25-dejavu-lgc-fonts.conf"
        noop="1" var="DEJAVU_LGC"/>
    </sources>

    <dependencies>
      <depend program="pkgconfig" install-name="pkgconfig02"
        add-path="prepend" type="build">v&gt;=0.25</depend>
      <depend var="FONTS" install-name="fonts11"
        set-var-only="1"/>
    </dependencies>

    <script-header>
<![CDATA[
_datadir_fonts="${SB_VAR_FONTS}/share"
_sysconfdir="${SB_INSTALL_PREFIX}/etc"
_docdir="${SB_INSTALL_PREFIX}/doc"

_localstatedir="/var${SB_INSTALL_PREFIX}"
]]>
    </script-header>

    <module name="default">
      <dependencies replace="0">
        <depend program="expat" var="LIBEXPAT"
          install-name="libexpat20">v&gt;=2.0.1</depend>
        <depend program="freetype" var="LIBTTF"
          install-name="libttf24">v&gt;=2.4.6</depend>
        <depend program="libiconv" var="LIBICONV"
          install-name="libiconv113">v&gt;=1.13.1</depend>
        <depend program="zlib" var="LIBZ"
          install-name="libz12">v&gt;=1.2.5</depend>
      </dependencies>

      <validate>
        <depend program="fcpackage" module="64bit"
          systype="*-aix*|*-hpux*|*-irix*|*-solaris*">v==2.8</depend>
        <depend program="fonts" module="dejavu-lgc">v==1.1</depend>
      </validate>

      <script-header>
<![CDATA[
_datadir_fonts="${SB_VAR_FONTS}/share"
_sysconfdir="${SB_INSTALL_PREFIX}/etc"
_docdir="${SB_INSTALL_PREFIX}/doc"

_localstatedir="/var${SB_INSTALL_PREFIX}"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix[67]*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:"

  # Static Xrender.a causes problems, the one in /usr/lib has a shr.o
  # member that other libraries in /usr/lib want.
  ARGS="--disable-static" ;;
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC=cc CFLAGS="+O2 -z +Ofltacc +Olit=all +Onoentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="+O2 -z -Ae +Ofltacc +ESlit +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s -Wl,+b," ;;
*-hpux*)
  CC=cc CFLAGS="+O2 -z +Ofltacc +Olit=all +Onoentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"
  EXTRA_FONT_DIR="/usr/share/fonts" ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"
  EXTRA_FONT_DIR="/usr/share/fonts" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -Xc -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -Xc -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="${SB_VAR_LIBICONV+-I${SB_VAR_LIBICONV_INC}} \
${CPPFLAGS+${CPPFLAGS}}" \
LDFLAGS="${SB_VAR_LIBICONV+-L${SB_VAR_LIBICONV_LIB} \
${CC_LD_RT}${SB_VAR_LIBICONV_LIB}} \
${CC_LD_RT}${SB_VAR_LIBEXPAT_LIB} ${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="${SB_VAR_LIBTTF_LIB}/pkgconfig\
${SB_VAR_LIBZ+:${SB_VAR_LIBZ_LIB}/pkgconfig}" \
--with-expat-includes=${SB_VAR_LIBEXPAT_INC} \
--with-expat-lib=${SB_VAR_LIBEXPAT_LIB} \
${_localstatedir+--with-cache-dir="${_localstatedir}/cache"} \
--with-confdir=${_sysconfdir} --with-docdir=${_docdir} \
--with-default-fonts=${_datadir_fonts} ac_cv_prog_HASDOCBOOK=no \
--disable-silent-rules --docdir=${_docdir} \
--disable-dependency-tracking ${ARGS+${ARGS}} \
--mandir="${SB_INSTALL_PREFIX}/man" --prefix=${SB_INSTALL_PREFIX}

${SB_PATH_CHMOD} +x config/install-sh

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" \
fontconfig/fontconfig.pc libXft/xft.pc libXrender/xrender.pc

# force correct architecture for fc-arch
case "${SB_SYSTYPE}" in
*-aix*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be32d4/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
ia64*-hpux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be32d8/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-hpux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be32d8/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-irix*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be32d8/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
x86_64*-linux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^le64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-linux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^le32d4/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-osf*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^le64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
i?86*-solaris*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^le32d4/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-solaris*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be32d8/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
esac
]]>
      </configure>

      <test>
<![CDATA[
gmake -C fontconfig check
]]>
      </test>

      <install>
<![CDATA[
gmake install

_s_fonts_prefix=$(echo ${SB_VAR_FONTS} | sed 's!/!\\/!g')

for _fontdir in /usr/openwin/lib/X11/fonts/F3 \
/usr/openwin/lib/X11/fonts/TrueType /usr/openwin/lib/X11/fonts/Type1 \
/usr/openwin/lib/X11/fonts/Type3 /usr/openwin/lib/X11/fonts/Xt+ \
/usr/lib/X11/fonts/TrueType /usr/lib/X11/fonts/Type1 \
/usr/lib/X11/fonts/ms.st /usr/lib/X11/fonts/type1.st \
/usr/share/fonts /usr/share/X11/fonts/Type1 \
/usr/share/X11/fonts/OTF; do
  [ ! -d ${_fontdir} ] && continue

  # exclude some directories on some platforms
  case "${SB_SYSTYPE}:${_fontdir}" in
  *-aix*:/usr/lib/X11/fonts/Type1)
    continue ;;
  esac

  ${SB_PATH_SED} -i -e "\
/${_s_fonts_prefix}/ {
i\\
        <dir>${_fontdir}</dir>
}" ${_sysconfdir}/fonts.conf
done

if [ "${_localstatedir+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
/~\/.fontconfig/ {
i\\
        <cachedir>${_localstatedir}/cache</cachedir>
}" ${_sysconfdir}/fonts.conf
else
  rmdir ${SB_INSTALL_PREFIX}/var/cache/fontconfig
  rmdir ${SB_INSTALL_PREFIX}/var/cache
  rmdir ${SB_INSTALL_PREFIX}/var
fi

# default to DejaVU LGC font
${SB_PATH_INSTALL} -m 644 -o root -g 0 \
${SB_SRC_DEJAVU_LGC} ${_sysconfdir}/conf.avail
${SB_PATH_LN} -s \
../conf.avail/$(basename ${SB_SRC_DEJAVU_LGC}) \
${_sysconfdir}/conf.d/$(basename ${SB_SRC_DEJAVU_LGC})
]]>
      </install>
    </module>

    <module name="64bit"
    systype="*-aix*|*-hpux*|*-irix*|*-solaris*">
      <dependencies replace="0">
        <depend program="expat" var="LIBEXPAT"
          install-name="libexpat20" module="64bit">v&gt;=2.0.1</depend>
        <depend program="freetype" var="LIBTTF" install-name="libttf24"
          module="64bit">v&gt;=2.4.6</depend>
        <depend program="libiconv" var="LIBICONV"
          install-name="libiconv113"
          module="64bit">v&gt;=1.13.1</depend>
        <depend program="zlib" var="LIBZ" install-name="libz12"
          module="64bit">v&gt;=1.2.5</depend>
      </dependencies>

      <script-header replace="0">
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  _libdir=lib/ppc64 ;;
ia64*-hpux*)
  _libdir=lib/hpux64 ;;
*-hpux*)
  _libdir=lib/pa20_64 ;;
*-irix*)
  _libdir=lib64 ;;
i?86*-solaris*)
  _libdir=lib/amd64 ;;
*-solaris*)
  _libdir=lib/sparcv9 ;;
esac

case "${SB_SYSTYPE}" in
*-aix*)
  export OBJECT_MODE=64 ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix[67]*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -q64 -qmaxmem=-1"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"

  # Static Xrender.a causes problems, the one in /usr/lib has a shr.o
  # member that other libraries in /usr/lib want.
  ARGS="--disable-static" ;;
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -q64 -qmaxmem=-1"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib" ;;
ia64*-hpux*)
  CC=cc CFLAGS="+O2 +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  CC=cc CFLAGS="+O2 +Ofltacc +Olit=all +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  case "${SB_SYSTYPE}" in
  *-hpux11.31)
    ARGS="--build=hppa64-hp-hpux11.31" ;;
  *-hpux11.23)
    ARGS="--build=hppa64-hp-hpux11.23" ;;
  *-hpux11.11)
    ARGS="--build=hppa64-hp-hpux11.11" ;;
  *-hpux11.00)
    ARGS="--build=hppa64-hp-hpux11.00" ;;
  esac ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -64 -mips4 -O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -m64 \
-xarch=sse2"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -Xc -xO2 -xtarget=generic \
-xarch=v9"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -Xc -xO2 -xtarget=generic \
-m64 -xarch=sparc"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="-I${SB_VAR_LIBICONV_INC} ${CPPFLAGS+${CPPFLAGS}}" \
LDFLAGS="-L${SB_VAR_LIBICONV}/${_libdir} \
-L${SB_VAR_LIBEXPAT}/${_libdir} -L${SB_VAR_LIBTTF}/${_libdir} \
${CC_LD_RT}${SB_VAR_LIBICONV}/${_libdir}:\
${SB_VAR_LIBEXPAT}/${_libdir} ${LDFLAGS+${LDFLAGS}}" \
PKG_CONFIG_PATH="${SB_VAR_LIBTTF}/${_libdir}/pkgconfig:\
${SB_VAR_LIBZ}/${_libdir}/pkgconfig" ac_cv_prog_HASDOCBOOK=no \
--with-expat-includes=${SB_VAR_LIBEXPAT_INC} \
--with-expat-lib=${SB_VAR_LIBEXPAT}/${_libdir} \
--with-confdir=${_sysconfdir} --with-docdir=${_docdir} \
--with-default-fonts=${_datadir_fonts} \
--libdir=${SB_INSTALL_PREFIX}/${_libdir} \
--disable-silent-rules --docdir=${_docdir} \
--disable-dependency-tracking ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_CHMOD} +x config/install-sh

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!" \
fontconfig/fontconfig.pc libXft/xft.pc libXrender/xrender.pc

# force correct architecture for fc-arch
case "${SB_SYSTYPE}" in
*-aix*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
ia64*-hpux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-hpux*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-irix*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
i?86*-solaris*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^le64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
*-solaris*)
  ${SB_PATH_SED} -i -n -e "\
/^@@@/ p; \
/^be64/ p" fontconfig/fc-arch/fcarch.tmpl.h ;;
esac
]]>
      </configure>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/lib/64 ]; then
  case "${SB_SYSTYPE}" in
  *-aix*|*-hpux*|*-solaris*)
    ln -s ./$(basename ${_libdir}) ${SB_INSTALL_PREFIX}/lib/64 ;;
  *-irix*)
    ln -s ../lib64 ${SB_INSTALL_PREFIX}/lib/64 ;;
  esac
fi

gmake -C fontconfig install-pkgconfigDATA
gmake -C fontconfig/src install-libLTLIBRARIES
gmake -C libXrender install-pkgconfigDATA
gmake -C libXrender/src install-libLTLIBRARIES
gmake -C libXft install-pkgconfigDATA
gmake -C libXft/src install-libLTLIBRARIES
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/lib/64 ${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <notes>
      <note type="configuration">
        <para>The default font search path is defined in the
configuration file <command>${SB_INSTALL_PREFIX}/etc/fonts.conf</command>. To add
additional paths, add additional "<command>&lt;dir&gt;</command>"
elements.</para>
      </note>
    </notes>
  </program>
</programs>
