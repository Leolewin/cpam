<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="apr-util" version="1.3.12" revision="1">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>libaprutil13</install-name>

    <sources>
      <source checksum="0f671b037ca62751a8a7005578085560"
        checksum-type="md5" size="607646"
        path="src/apr-util-1.3.12.tar.bz2"/>
      <patch checksum="5630ce6bedde2b4d66634e490a886119"
        checksum-type="md5" size="33434"
        path="src/apr-util-1.3.12.tww.patch"/>
      <patch checksum="45fe945078058716ed7d17baaa15f91f"
        checksum-type="md5" size="560703"
        path="src/apr-util-1.3.12.auto.patch"/>
    </sources>

    <dependencies>
      <depend program="db" var="LIBDB"
        install-name="libdb47">v&gt;=4.7.25</depend>
      <depend program="expat" var="LIBEXPAT"
        install-name="libexpat20">v&gt;=2.0.1</depend>
      <depend program="libiconv" var="LIBICONV"
        install-name="libiconv113">v&gt;=1.13.1</depend>
      <depend program="postgresql" var="PGSQL"
        module="libruntime">v==9.0.6</depend>
      <depend program="sqlite" var="LIBSQLITE"
        install-name="libsqlite37">v&gt;=3.7.7.1</depend>
      <depend program="openldap" var="OPENLDAP"
        install-name="openldap24">v&gt;=2.4.26</depend>
      <depend program="mysql" var="MYSQL"
        module="libruntime">v==5.5.15</depend>
    </dependencies>

    <script-header>
<![CDATA[
_db_ver=db47
]]>
    </script-header>

    <module name="default">
      <dependencies replace="0">
        <depend program="apr" var="LIBAPR" install-name="libapr14"
          add-path="prepend">v&gt;=1.4.5</depend>
      </dependencies>

      <validate>
        <depend program="apr-util" module="64bit"
          systype="*-aix*|*-hpux*|*-irix*|*-solaris*">v==1.3.12</depend>
        <depend program="apr-util" module="gcc44">v==1.3.12</depend>
      </validate>

      <script-header>
<![CDATA[
_db_ver=db47
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib" ;;
ia64*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b,"
  LDFLAGS="-Wl,+nodefaultrpath" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
*-freebsd*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath,"

  ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath,"

  ;;
*-osf*)
  CC=cc CFLAGS="-O2 -nodtk -arch ev5 -msym -readonly_strings"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="${SB_VAR_LIBDB+-I${SB_VAR_LIBDB_INC}}" \
LDFLAGS="${SB_VAR_LIBDB+-L${SB_VAR_LIBDB_LIB} \
${CC_LD_RT}${SB_VAR_LIBDB_LIB}} ${LDFLAGS+${LDFLAGS}}" \
${SB_VAR_LIBICONV+--with-iconv} \
${SB_VAR_LIBICONV+--with-iconv-include=${SB_VAR_LIBICONV_INC}} \
${SB_VAR_LIBICONV+--with-iconv-lib=${SB_VAR_LIBICONV_LIB}} \
--with-berkeley-db --with-dbm=${_db_ver} \
${SB_VAR_LIBDB+--with-berkeley-db-include=${SB_VAR_LIBDB_INC}} \
${SB_VAR_LIBDB+--with-berkeley-db-lib=${SB_VAR_LIBDB_LIB}} \
${SB_VAR_OPENLDAP+ac_cv_header_ldap_ssl_h=no} \
${SB_VAR_OPENLDAP+--with-ldap} \
${SB_VAR_OPENLDAP+--with-ldap-include=${SB_VAR_OPENLDAP_INC}} \
${SB_VAR_OPENLDAP+--with-ldap-lib=${SB_VAR_OPENLDAP_LIB}} \
${SB_VAR_LIBSQLITE+--with-sqlite3} \
${SB_VAR_LIBSQLITE+--with-sqlite3-include=${SB_VAR_LIBSQLITE_INC}} \
${SB_VAR_LIBSQLITE+--with-sqlite3-lib=${SB_VAR_LIBSQLITE_LIB}} \
${SB_VAR_MYSQL+--with-mysql} \
${SB_VAR_MYSQL+--with-mysql-include=${SB_VAR_MYSQL_INC}} \
${SB_VAR_MYSQL+--with-mysql-lib=${SB_VAR_MYSQL_LIB}} \
${SB_VAR_PGSQL+--with-pgsql} \
${SB_VAR_PGSQL+--with-pgsql-include=${SB_VAR_PGSQL_INC}} \
${SB_VAR_PGSQL+--with-pgsql-lib=${SB_VAR_PGSQL_LIB}} \
ac_cv_path_MYSQL_CONFIG= \
ac_cv_path_PGSQL_CONFIG= \
--enable-layout=TWW \
${SB_VAR_LIBEXPAT+--with-expat} \
${SB_VAR_LIBEXPAT+--with-expat-include=${SB_VAR_LIBEXPAT_INC}} \
${SB_VAR_LIBEXPAT+--with-expat-lib=${SB_VAR_LIBEXPAT_LIB}} \
${ARGS+${ARGS}} --libdir=${SB_INSTALL_PREFIX_LIB} \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\) -l!-L\1 ${CC_LD_RT}\1 -l!" apu-1-config

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" apr-util.pc

# add runtime path to database directories
if [ "${SB_VAR_MYSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L${SB_VAR_MYSQL_LIB}!-L${SB_VAR_MYSQL_LIB} \
${CC_LD_RT}${SB_VAR_MYSQL_LIB} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
if [ "${SB_VAR_PGSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L${SB_VAR_PGSQL_LIB}!-L${SB_VAR_PGSQL_LIB} \
${CC_LD_RT}${SB_VAR_PGSQL_LIB} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
]]>
      </configure>

      <install>
<![CDATA[
gmake install

${SB_PATH_CHOWN} -hR 0:0 ${SB_INSTALL_PREFIX_LIB}
]]>
      </install>
    </module>

    <module name="64bit"
    systype="*-aix*|*-hpux*|*-irix*|*-solaris*">
      <dependencies>
        <depend program="apr" var="LIBAPR" install-name="libapr14"
          module="64bit" append="bin/64"
          add-path="prepend">v&gt;=1.4.5</depend>
        <depend program="db" var="LIBDB" install-name="libdb47"
          module="64bit">v&gt;=4.7.25</depend>
        <depend program="expat" var="LIBEXPAT"
          install-name="libexpat20" module="64bit">v&gt;=2.0.1</depend>
        <depend program="libiconv" var="LIBICONV"
          install-name="libiconv113"
          module="64bit">v&gt;=1.13.1</depend>
        <depend program="mysql" var="MYSQL"
          module="64bit">v==5.5.15</depend>
        <depend program="postgresql" var="PGSQL" module="64bit"
          systype="*-aix*|*-hpux11.[123]*|*-irix*|*-solaris*">v==9.0.6</depend>
        <depend program="sqlite" var="LIBSQLITE"
          install-name="libsqlite37"
          module="64bit">v&gt;=3.7.7.1</depend>
        <depend program="openldap" var="OPENLDAP"
          install-name="openldap24"
          module="64bit">v&gt;=2.4.26</depend>
      </dependencies>

      <script-header replace="0">
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  _bindir=bin/ppc64
  _incdir=include/ppc64
  _libdir=lib/ppc64 ;;
ia64*-hpux*)
  _bindir=bin/hpux64
  _incdir=include/hpux64
  _libdir=lib/hpux64 ;;
*-hpux*)
  _bindir=bin/pa20_64
  _incdir=include/pa20_64
  _libdir=lib/pa20_64 ;;
*-irix*)
  _bindir=bin/mips4
  _incdir=include/mips4
  _libdir=lib64 ;;
i?86*-solaris*)
  _bindir=bin/amd64
  _incdir=include/amd64
  _libdir=lib/amd64 ;;
*-solaris*)
  _bindir=bin/sparcv9
  _incdir=include/sparcv9
  _libdir=lib/sparcv9 ;;
esac

case "${SB_SYSTYPE}" in
*-aix*)
  export OBJECT_MODE=64 ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -q64 -qmaxmem=-1"
  CC_LD_RT="-Wl,-blibpath:"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib" ;;
ia64*-hpux*)
  CC=cc CFLAGS="+O2 +Olit=all +Ofltacc +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  CC=cc CFLAGS="+O2 +Olit=all +Ofltacc +Oentrysched +DD64 \
+Odataprefetch +Onolimit"
  CC_LD_RT="-Wl,+s,+b,"

  case "${SB_SYSTYPE}" in
  *-hpux11.31)
    ARGS="--build=hppa64-hp-hpux11.31" ;;
  *-hpux11.23)
    ARGS="--build=hppa64-hp-hpux11.23" ;;
  *-hpux11.11)
    ARGS="--build=hppa64-hp-hpux11.11" ;;
  *-hpux11.00)
    ARGS="--build=hppa64-hp-hpux11.00" ;;
  esac ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-64 -mips4 -O2 -OPT:Olimit=0"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -m64 \
-xarch=sse2"
  CC_LD_RT="-R" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -xarch=v9"
  CC_LD_RT="-R" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -m64 \
-xarch=sparc"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="${SB_VAR_LIBDB+-I${SB_VAR_LIBDB_INC}}" \
LDFLAGS="${SB_VAR_LIBDB+-L${SB_VAR_LIBDB}/${_libdir} \
${CC_LD_RT}${SB_VAR_LIBDB}/${_libdir}} ${LDFLAGS+${LDFLAGS}}" \
${SB_VAR_LIBICONV+--with-iconv} \
${SB_VAR_LIBICONV+--with-iconv-include=${SB_VAR_LIBICONV_INC}} \
${SB_VAR_LIBICONV+--with-iconv-lib=${SB_VAR_LIBICONV}/${_libdir}} \
--with-berkeley-db --with-dbm=db47 \
${SB_VAR_LIBDB+--with-berkeley-db-include=${SB_VAR_LIBDB_INC}} \
${SB_VAR_LIBDB+--with-berkeley-db-lib=${SB_VAR_LIBDB}/${_libdir}} \
${SB_VAR_OPENLDAP+ac_cv_header_ldap_ssl_h=no} \
${SB_VAR_OPENLDAP+--with-ldap} \
${SB_VAR_OPENLDAP+--with-ldap-include=${SB_VAR_OPENLDAP_INC}} \
${SB_VAR_OPENLDAP+--with-ldap-lib=${SB_VAR_OPENLDAP}/${_libdir}} \
${SB_VAR_LIBSQLITE+--with-sqlite3} \
${SB_VAR_LIBSQLITE+--with-sqlite3-include=${SB_VAR_LIBSQLITE_INC}} \
${SB_VAR_LIBSQLITE+--with-sqlite3-lib=${SB_VAR_LIBSQLITE}/${_libdir}} \
${SB_VAR_MYSQL+--with-mysql} \
${SB_VAR_MYSQL+--with-mysql-include=${SB_VAR_MYSQL_INC}} \
${SB_VAR_MYSQL+--with-mysql-lib=${SB_VAR_MYSQL}/${_libdir}} \
${SB_VAR_PGSQL+--with-pgsql} \
${SB_VAR_PGSQL+--with-pgsql-include=${SB_VAR_PGSQL_INC}} \
${SB_VAR_PGSQL+--with-pgsql-lib=${SB_VAR_PGSQL}/${_libdir}} \
ac_cv_path_MYSQL_CONFIG= \
ac_cv_path_PGSQL_CONFIG= \
--enable-layout=TWW --with-expat \
--with-expat-include=${SB_VAR_LIBEXPAT_INC} \
--with-expat-lib="${SB_VAR_LIBEXPAT}/${_libdir}" ${ARGS+${ARGS}} \
--bindir="${SB_INSTALL_PREFIX}/${_bindir}" \
--includedir="${SB_INSTALL_PREFIX}/${_incdir}" \
--libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\) -l!-L\1 ${CC_LD_RT}\1 -l!" apu-1-config

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" apr-util.pc

# add runtime path to database directories
if [ "${SB_VAR_MYSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
  s!-L${SB_VAR_MYSQL}/${_libdir}!-L${SB_VAR_MYSQL}/${_libdir} \
  ${CC_LD_RT}${SB_VAR_MYSQL}/${_libdir} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
if [ "${SB_VAR_PGSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L${SB_VAR_PGSQL}/${_libdir}!-L${SB_VAR_PGSQL}/${_libdir} \
${CC_LD_RT}${SB_VAR_PGSQL}/${_libdir} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
]]>
      </configure>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/bin/64 ]; then
  ln -s ./$(basename ${_bindir}) ${SB_INSTALL_PREFIX}/bin/64
fi
if [ ! -d ${SB_INSTALL_PREFIX}/include/64 ]; then
  ln -s ./$(basename ${_incdir}) ${SB_INSTALL_PREFIX}/include/64
fi
if [ ! -d ${SB_INSTALL_PREFIX}/lib/64 ]; then
  case "${SB_SYSTYPE}" in
  *-aix*|*-hpux*|*-solaris*)
    ln -s ./$(basename ${_libdir}) ${SB_INSTALL_PREFIX}/lib/64 ;;
  *-irix*)
    ln -s ../lib64 ${SB_INSTALL_PREFIX}/lib/64 ;;
  esac
fi

gmake install-bin install-headers install-lib install-pkgconfig
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/bin/64 ${SB_INSTALL_PREFIX}/include/64 \
${SB_INSTALL_PREFIX}/lib/64 ${SB_INSTALL_PREFIX}/${_bindir} \
${SB_INSTALL_PREFIX}/${_incdir} ${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <module name="gcc44">
      <dependencies replace="0">
        <depend program="apr" var="LIBAPR" install-name="libapr14"
          module="gcc44">v&gt;=1.4.5</depend>
        <depend program="apr" install-name="libapr14" module="gcc44"
          append="bin/gcc44" add-path="prepend">v&gt;=1.4.5</depend>
        <depend program="gcc" install-name="gcc44"
          add-path="prepend">v&gt;=4.4.6</depend>
        <depend var="GCC_RT" install-name="gcc44r"/>
      </dependencies>

      <script-header replace="0">
<![CDATA[
_gcc_subdir="gcc44"
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CFLAGS="-O2 -mcpu=powerpc" CXXFLAGS="-O2 -mcpu=powerpc"
  LDFLAGS="-Wl,-brtl -Wl,-blibpath:/usr/lib"
  CC_LD_RT="-Wl,-blibpath:" ;;
ia64*-hpux*)
  CC_LD_RT="-Wl,+b," ;;
*-hpux*)
  CC_LD_RT="-Wl,+s,+b," ;;
*-irix*)
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CXXFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro"
  CC_LD_RT="-Wl,-rpath," ;;
*-linux*)
  CC_LD_RT="-Wl,-rpath," ;;
*-osf*)
  CFLAGS="-O2 -mcpu=ev5" CXXFLAGS="-O2 -mcpu=ev5"
  CC_LD_RT="-Wl,-rpath," ;;
i?86*-solaris*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CXXFLAGS="-O2 -mtune=pentium4 -march=pentium4"
  CC_LD_RT="-R" ;;
*-solaris*)
  CFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CXXFLAGS="-O2 -mcpu=ultrasparc -mvis"
  CC_LD_RT="-R" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
CPPFLAGS="${SB_VAR_LIBDB+-I${SB_VAR_LIBDB_INC}}" \
LDFLAGS="${SB_VAR_LIBDB+-L${SB_VAR_LIBDB_LIB} \
${CC_LD_RT}${SB_VAR_LIBDB_LIB}} ${LDFLAGS+${LDFLAGS}}" \
${SB_VAR_LIBICONV+--with-iconv} \
${SB_VAR_LIBICONV+--with-iconv-include=${SB_VAR_LIBICONV_INC}} \
${SB_VAR_LIBICONV+--with-iconv-lib=${SB_VAR_LIBICONV_LIB}} \
--with-berkeley-db --with-dbm=${_db_ver} \
${SB_VAR_LIBDB+--with-berkeley-db-include=${SB_VAR_LIBDB_INC}} \
${SB_VAR_LIBDB+--with-berkeley-db-lib=${SB_VAR_LIBDB_LIB}} \
${SB_VAR_OPENLDAP+ac_cv_header_ldap_ssl_h=no} \
${SB_VAR_OPENLDAP+--with-ldap} \
${SB_VAR_OPENLDAP+--with-ldap-include=${SB_VAR_OPENLDAP_INC}} \
${SB_VAR_OPENLDAP+--with-ldap-lib=${SB_VAR_OPENLDAP_LIB}} \
${SB_VAR_LIBSQLITE+--with-sqlite3} \
${SB_VAR_LIBSQLITE+--with-sqlite3-include=${SB_VAR_LIBSQLITE_INC}} \
${SB_VAR_LIBSQLITE+--with-sqlite3-lib=${SB_VAR_LIBSQLITE_LIB}} \
${SB_VAR_MYSQL+--with-mysql} \
${SB_VAR_MYSQL+--with-mysql-include=${SB_VAR_MYSQL_INC}} \
${SB_VAR_MYSQL+--with-mysql-lib=${SB_VAR_MYSQL_LIB}} \
${SB_VAR_PGSQL+--with-pgsql} \
${SB_VAR_PGSQL+--with-pgsql-include=${SB_VAR_PGSQL_INC}} \
${SB_VAR_PGSQL+--with-pgsql-lib=${SB_VAR_PGSQL_LIB}} \
ac_cv_path_MYSQL_CONFIG= \
ac_cv_path_PGSQL_CONFIG= \
--enable-layout=TWW --with-expat \
--with-expat-include=${SB_VAR_LIBEXPAT_INC} \
--with-expat-lib=${SB_VAR_LIBEXPAT_LIB} ${ARGS+${ARGS}} \
--bindir="${SB_INSTALL_PREFIX}/bin/${_gcc_subdir}" \
--includedir="${SB_INSTALL_PREFIX}/include/${_gcc_subdir}" \
--libdir="${SB_INSTALL_PREFIX_LIB}/${_gcc_subdir}" \
--prefix=${SB_INSTALL_PREFIX}

${SB_PATH_SED} -i -e "\
s!-L\(\$libdir\) -l!-L\1 ${CC_LD_RT}\1 -l!" apu-1-config

${SB_PATH_SED} -i -e "\
s!-L\(\${libdir}\)!-L\1 ${CC_LD_RT}\1!;" apr-util.pc

# add runtime path to database directories
if [ "${SB_VAR_MYSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L${SB_VAR_MYSQL_LIB}!-L${SB_VAR_MYSQL_LIB} \
${CC_LD_RT}${SB_VAR_MYSQL_LIB} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
if [ "${SB_VAR_PGSQL+set}" = set ]; then
  ${SB_PATH_SED} -i -e "\
s!-L${SB_VAR_PGSQL_LIB}!-L${SB_VAR_PGSQL_LIB} \
${CC_LD_RT}${SB_VAR_PGSQL_LIB} ${LDFLAGS+${LDFLAGS}}!g;" \
  Makefile
fi
]]>
      </configure>

      <install>
<![CDATA[
gmake install

${SB_PATH_CHOWN} -hR 0:0 ${SB_INSTALL_PREFIX_LIB}/${_gcc_subdir}
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/bin/${_gcc_subdir} \
${SB_INSTALL_PREFIX}/include/${_gcc_subdir} \
${SB_INSTALL_PREFIX_LIB}/${_gcc_subdir}
]]>
      </uninstall>
    </module>

    <licenses>
      <license path="apache-2.0.license"/>

      <license module="apr_md5_encode() in crypto/apr_md5.c">
        <para>The apr_md5_encode() routine uses much code obtained
from the FreeBSD 3.0 MD5 crypt() function, which is licenced as
follows:</para>
        <para skip="0">THE BEER-WARE LICENSE" (Revision 42):</para>
        <para>&lt;phk@login.dknet.dk&gt; wrote this file. As long as
you retain this notice you can do whatever you want with this stuff.
If we meet some day, and you think this stuff is worth it, you can buy
me a beer in return. Poul-Henning Kamp</para>
      </license>

      <license module="crypto/apr_md4.c, crypto/apr_md5.c, include/apr_md4.h, include/apr_md5.h">
        <para>This is derived from material copyright RSA Data
Security, Inc. Their notice is reproduced below in its
entirety.</para>
        <para>Copyright (C) 1991-2, RSA Data Security, Inc. Created
1991. All rights reserved.</para>
        <para>License to copy and use this software is granted
provided that it is identified as the "RSA Data Security, Inc. MD4
Message-Digest Algorithm" in all material mentioning or referencing
this software or this function.</para>
        <para>License is also granted to make and use derivative works
provided that such works are identified as "derived from the RSA Data
Security, Inc. MD4 Message-Digest Algorithm" in all material
mentioning or referencing the derived work.</para>
        <para>RSA Data Security, Inc. makes no representations
concerning either the merchantability of this software or the
suitability of this software for any particular purpose. It is
provided "as is" without express or implied warranty of any
kind.</para>
        <para>These notices must be retained in any copies of any part
of this documentation and/or software.</para>
      </license>

      <license module="expat xml parser component">
        <para>Copyright (c) 1998, 1999, 2000 Thai Open Source Software
Center Ltd and Clark Cooper</para>
        <para>Permission is hereby granted, free of charge, to any
person obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge,
publish, distribute, sublicense, and/or sell copies of the Software,
and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:</para>
        <unorderedlist>
          <item><para>The above copyright notice and this permission
notice shall be included in all copies or substantial portions of the
Software.</para></item>
        </unorderedlist>

        <para>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF
ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</para>
      </license>

      <license module="ldap/apr_ldap_url.c component">
        <para skip="0">Portions Copyright 1998-2002 The OpenLDAP
Foundation</para>
        <para>All rights reserved.</para>
        <indent>
          <para>Redistribution and use in source and binary forms, with
or without modification, are permitted only as authorized by the
OpenLDAP Public License. A copy of this license is available at
<ulink url="http://www.OpenLDAP.org/license.html">http://www.OpenLDAP.org/license.html</ulink>
or in file LICENSE in the top-level directory of the
distribution.</para>
          <para>OpenLDAP is a registered trademark of the OpenLDAP
Foundation.</para>
          <para>Individual files and/or contributed packages may be
copyright by other parties and subject to additional
restrictions.</para>
          <para>This work is derived from the University of Michigan
LDAP v3.3 distribution. Information concerning this software is
available at: <ulink url="http://www.umich.edu/~dirsvcs/ldap/">http://www.umich.edu/~dirsvcs/ldap/</ulink></para>
          <para>This work also contains materials derived from public
sources.</para>
        </indent>

        <para skip="0">Portions Copyright (c) 1992-1996 Regents of the
University of Michigan.</para>
        <para>All rights reserved.</para>
        <indent>
          <para>Redistribution and use in source and binary forms are
permitted provided that this notice is preserved and that due credit
is given to the University of Michigan at Ann Arbor. The name of the
University may not be used to endorse or promote products derived from
this software without specific prior written permission. This software
is provided "as is" without express or implied warranty.</para>
        </indent>
      </license>
    </licenses>

    <notes>
      <change from="1.3.11" to="1.3.12">
        <item><para>apr_ldap: Fix crash because of NULL cleanup
registered by apr_ldap_rebind_init()</para></item>
      </change>

      <change from="1.3.10" to="1.3.11">
        <item><para>apr_dbd_oracle: fix endianness issue in prepared
statements. PR 50690.</para></item>
        <item><para>apr_ldap: resolve possible hangs or crashes when
the pool passed to apr_ldap_rebind_init() is cleaned up and
apr_ldap_rebind is re-initted and re-used. PR50918.</para></item>
        <item><para>DBD ODBC support: Fix stack buffer overwrite when
an unexpected number of parameters is passed to open. Fix range
checking of the APR DBD type enum passed to some of the
APIs.</para></item>
      </change>

      <change from="1.3.9" to="1.3.10">
        <item><para>SECURITY: CVE-2010-1623 Fix a denial of service
attack against apr_brigade_split_line().</para></item>
        <item><para>SECURITY: CVE-2009-3560, CVE-2009-3720 Fix two
buffer over-read flaws in the bundled copy of expat which could cause
applications to crash while parsing specially-crafted XML
documents.</para></item>
        <item><para>Upgrade bundled copy of expat library to
1.95.7.</para></item>
        <item><para>apr_thread_pool: Fix some potential deadlock
situations. PR 49709.</para></item>
        <item><para>apr_thread_pool_create: Fix pool corruption caused
by multithreaded use of the pool when multiple initial threads are
created. PR 47843.</para></item>
        <item><para>apr_thread_pool_create(): Only set the output
thread pool handle on success.</para></item>
        <item><para>DBD ODBC support: Fix memory corruption using
apr_dbd_datum_get() with several different data types, including
APR_DBD_TYPE_TIME. PR 49645.</para></item>
        <item><para>Add support for Berkeley DB 4.8 and 5.0. PR
49866, PR 49179.</para></item>
        <item><para>Make bundled expat compatible with libtool 2.x.
PR 49053. </para></item>
        <item><para>Prefer libtool 1.x when searching for libtool in
bundled expat release process</para></item>
        <item><para>Improve platform detection for bundled expat by
updating config.guess and config.sub</para></item>
      </change>

      <change from="1.3.8" to="1.3.9">
        <item><para>SECURITY: CVE-2009-2412 Fix overflow in rmm, where
size alignment was taking place</para></item>
        <item><para>Make sure that "make check" is used in the RPM
spec file, so that the crypto, dbd and dbm tests pass</para></item>
        <item><para>Make sure the mysql version of
dbd_mysql_get_entry() respects the rule that if the column number
exceeds the number of columns, we return NULL</para></item>
        <item><para>Ensure the dbm module is packaged up correctly in
the RPM</para></item>
        <item><para>Clarify the error messages within the dbd
tests</para></item>
      </change>

      <change from="1.3.7" to="1.3.8">
        <item><para>Use locally scoped variables in PostgreSQL driver
to avoid stomping on return codes. PR 47431.</para></item>
        <item><para>Fix race conditions in initialisation of DBD, DBM
and DSO</para></item>
        <item><para>Expose DBM libs in apu-1-config by default. To
avoid that, use apu-1-config --avoid-dbm --libs. To get just DBM libs,
use apu-1-config --dbm-libs.</para></item>
        <item><para>Make sure --without-ldap works</para></item>
      </change>

      <change from="1.3.6" to="1.3.7">
        <item><para>SECURITY: CVE-2009-1955 Fix a denial of service
attack against the apr_xml_* interface using the "billion laughs"
entity expansion technique</para></item>
      </change>

      <change from="1.3.5" to="1.3.6">
        <item><para>Minor build and bug fixes</para></item>
      </change>

      <change from="1.3.4" to="1.3.5">
        <item><para>SECURITY: CVE-2009-0023 Fix underflow in
apr_strmatch_precompile</para></item>
        <item><para>SECURITY: CVE-2009-1956 Fix off by one overflow in
apr_brigade_vprintf</para></item>
        <item><para>APR_LDAP_SIZELIMIT should prefer
LDAP_DEFAULT_LIMIT/-1 when the SDK supports it, but in the absence of
LDAP_DEFAULT_LIMIT (and LDAP_NO_LIMIT/0) it is not safe to use a
literal -1. PR23356.</para></item>
        <item><para>Clean up ODBC types. Warnings seen when compiling
packages for Fedora 11.</para></item>
        <item><para>Use of my_init() requires my_global.h and
my_sys.h. </para></item>
        <item><para>Fix apr_memcache_multgetp memory corruption and
incorrect error handling. PR 46588.</para></item>
        <item><para>Fix memcache memory leak with persistent
connections. PR 46482.</para></item>
        <item><para>Add Oracle 11 support.</para></item>
        <item><para>apr_dbd_freetds: Avoid segfault when process is
NULL. Do no print diagnostics to stderr. Never allow driver to exit
process.</para></item>
        <item><para>apr_dbd_freetds: The sybdb.h header file might be
freetds/sybdb.h or sybdb.h</para></item>
        <item><para>LDAP detection improvements: --with-ldap now
supports library names containing non-alphanumeric characters, such as
libldap-2.4.so. New option --with-lber can be used to override the
default liblber name. Fix a problem reporting the lber library from
apu-N-config.</para></item>
        <item><para>Suppress pgsql column-out-of-range warning. PR
46012.</para></item>
        <item><para>Fix a buffer overrun and password matching for SHA
passwords. PR 45679.</para></item>
        <item><para>Introduce DSO handling of the db, gdbm and ndbm
drivers, so these are loaded as .so's on first demand, unless
--disable-util-dso is configured.</para></item>
        <item><para>Fix a segfault in the DBD testcase when the DBD
modules were not present.</para></item>
      </change>

      <change from="1.3.3" to="1.3.4">
        <item><para>Fix a memory leak introduced in r683756 and a free
call to a non malloced pointer in the case that the platform has no
threads.</para></item>
      </change>

      <change from="1.3.2" to="1.3.3">
        <item><para>Add Berkeley DB 4.7 support.</para></item>
        <item><para>PostgreSQL rows (internally) start from zero, not
one. Account for it in row fetching function.</para></item>
        <item><para>Detection of PostgreSQL may fail if LIBS contains
all libs returned by pg_config. Use it only as the last
resort.</para></item>
        <item><para>When searching for DSOs, look in
apr-util-APU_MAJOR_VERSION subdirectory of each component of
APR_DSOPATH. PR 45327</para></item>
        <item><para>Give MySQL DBD driver reconnect option. PR
45407</para></item>
      </change>

      <change from="1.3.1" to="1.3.2">
        <item><para>Fix parameter parsing error in ODBC DBD
driver.</para></item>
        <item><para>Older OpenLDAP implementations may have
ldap_set_rebind_proc() with two args. Provide detection code and
alternative implementation.</para></item>
        <item><para>Use pool memory when setting DBD driver name into
the hash.</para></item>
      </change>

      <change from="1.3.0" to="1.3.1">
        <item><para>Add ODBC DBD Driver.</para></item>
        <item><para>Fix build of the FreeTDS and MySQL
drivers.</para></item>
        <item><para>Fix build failure for no modules
(--disable-dso).</para></item>
        <item><para>Fix win32 build failure for no modules (empty
DBD_LIST).</para></item>
      </change>

      <change from="1.2.10" to="1.3.0">
        <item><para>apr_reslist: destroy all resources in apr_cleanup
(don't give up on error). PR 45086</para></item>
        <item><para>Add apr_brigade_split_ex for reusing existing
brigades in situation where brigades need to be split often during the
lifetime of a pool.</para></item>
        <item><para>Amend apr_reslist to expire resources whose idle
time exceeds ttl. PR 42841</para></item>
        <item><para>Modularize ldap's stub with the dbd dso modular
structure, and teach the apu dso's to respect the system specific
shared lib path var. To link to an application without ldap libs,
query `apu-1-config --avoid-ldap --libs` (in addition to the usual
linker queries for compiling and linking).</para></item>
        <item><para>Support building DBD drivers as DSOs by default;
use --disable-util-dso flag to configure to use static
link.</para></item>
        <item><para>All DBD drivers now count rows from 1, which
affects PostgreSQL and MySQL drivers in particular. Using row number
zero is an error.</para></item>
        <item><para>Add support for OpenLDAP's ability to support a
directory of certificate authorities.</para></item>
        <item><para>Better error detection for bucket allocation
failures.</para></item>
        <item><para>Ensure that the LDAP code can compile cleanly on
platforms that do not define the LDAP_OPT_REFHOPLIMIT symbol, most
specifically Windows.</para></item>
        <item><para>Fix the setting of LDAP_OPT_SSL on Win2k, which
expects a pointer to the value LDAP_OPT_ON, and not the value itself.
XP works with both.</para></item>
        <item><para>Fix a regression in apr_brigade_partition that
causes integer overflows on systems where apr_off_t &gt;
apr_size_t.</para></item>
        <item><para>Ensure that apr_uri_unparse does not add scheme to
URI if APR_URI_UNP_OMITSITEPART flag is set. PR 44044</para></item>
        <item><para>Add an LDAP rebind implementation so that
authentication can be carried through referrals.</para></item>
        <item><para>Fix the make test target in the spec
file.</para></item>
        <item><para>Introduce apr_dbd_open_ex()</para></item>
        <item><para>Make md5 hash files portable between EBCDIC and
ASCII platforms  </para></item>
        <item><para>Add limited apr_dbd_freetds driver (MSSQL and
Sybase)</para></item>
        <item><para>Commit relicensed apr_dbd_mysql driver to
/trunk/</para></item>
        <item><para>Support BerkeleyDB 4.6.</para></item>
        <item><para>Support Tivoli ITDS LDAP client
library.</para></item>
        <item><para>Portably implement testdate's long-time constants
to solve compilation faults where #LL isn't valid.</para></item>
        <item><para>Use buffered I/O with SDBM.</para></item>
        <item><para>Unify parsing of prepared statements and add
binary argument functions to DBD</para></item>
        <item><para>Rewrite detection of expat in configure to fix
build on e.g. biarch Linux platforms. PR 28205.</para></item>
        <item><para>Add apr_thread_pool implementation.</para></item>
        <item><para>Add support for Berkeley DB 4.5 to the configure
scripts.</para></item>
        <item><para>Allow apr_queue.h to be included before other APR
headers. PR 40891</para></item>
        <item><para>Fix precedence problem in error checking for sdbm
dbm back end. PR 40659</para></item>
        <item><para>Add an apr_reslist_acquired_count, for determining
how many outstanding resources there are in a reslist.</para></item>
        <item><para>Provide folding in autogenerated .manifest files
for Win32 builders using VisualStudio 2005</para></item>
        <item><para>Implement DBD transaction modes</para></item>
        <item><para>Implement prepared statement support in SQLite3
DBD driver</para></item>
        <item><para>Add get (column) name to apr_dbd API</para></item>
        <item><para>Make the DBD autoconf-glue use LDFLAGS instead of
LIBS in several places, fixing some configure issues on
Solaris.</para></item>
        <item><para>Make apr_dbd.h work as a stand alone header,
without needing other files to be included before it.</para></item>
        <item><para>On platforms that use autoconf stop automatically
linking against apr-iconv when an apr-iconv source dir is found in
../apr-iconv. Instead, add a --with-apr-iconv option to configure that
lets you specify the relative path to your apr-iconv source
directory.</para></item>
        <item><para>APR_FIND_APU macro now supports customisable
detailed checks on each installed apr-util.</para></item>
        <item><para>APR_FIND_APU macro no longer checks
/usr/local/apache2/</para></item>
        <item><para>Add apr_dbd_oracle driver.</para></item>
      </change>

      <change from="1.2.9" to="1.2.10">
        <item><para>Support BerkeleyDB 4.6</para></item>
        <item><para>Test improvements to validate testmd4 and testdbm,
unattended</para></item>
      </change>

      <change from="1.2.8" to="1.2.9">
        <item><para>Ensure that an apr_reslist shrinks back to SMAX
via the TTL by reorganising the resource list from a queue to a stack.
PR 40348.</para></item>
        <item><para>Fix Solaris 2.8+ fdatasync() detection. The
fdatasync() function is marked as part of the Realtime library
functions. PR 37343.</para></item>
        <item><para>Change configure's expat detection to use standard
linker-based tests, fixing build on e.g. biarch Linux systems. PR
28205.</para></item>
        <item><para>Portably implement testdate's long-time constants
to solve compilation faults where #LL isn't valid.</para></item>
        <item><para>APR_FIND_APU macro no longer checks
/usr/local/apache2/. PR 42089.</para></item>
        <item><para>Fix handling of attribute namespaces in
apr_xml_to_text() when a namespace map is provided. PR
41908.</para></item>
      </change>

      <change from="1.2.7" to="1.2.8">
        <item><para>Add support for Berkeley DB 4.5 to the configure
scripts.</para></item>
        <item><para>Allow apr_queue.h to be included before other APR
headers. PR 40891.</para></item>
        <item><para>Provide folding in autogenerated .manifest files
for Win32 builders using VisualStudio 2005</para></item>
        <item><para>Implement prepared statement support in SQLite3
DBD driver</para></item>
        <item><para>Fix to ensure that "deprecated" LDAP interfaces
are still exposed if using OpenLDAP 2.3</para></item>
        <item><para>Fix incorrect byte order and incorrect timestamp
type in the fallback UUID generator used when no external UUID
generator is detected by APR. PR 37342.</para></item>
      </change>

      <note type="installation">
        <para>The apr_dbd_mysql driver requires the installation of
the MySQL package. The apr_dbd_pgsql driver requires the installation
of the PostgreSQL package. They are not required by default but are
optional for the installation of this package.</para>
      </note>
    </notes>
  </program>
</programs>
