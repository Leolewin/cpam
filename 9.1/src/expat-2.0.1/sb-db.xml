<?xml version="1.0"?>
<programs>
<!DOCTYPE programs SYSTEM "sb-db.dtd">
  <program name="expat" version="2.0.1" revision="9">
    <build-name>${SB_PROG_NAME}-${SB_PROG_VER}</build-name>

    <install-name>libexpat20</install-name>

    <sources>
      <source checksum="ee8b492592568805593f81f8cdf2a04c"
        checksum-type="md5" size="446456"
        path="src/expat-2.0.1.tar.gz"/>
      <patch checksum="14846befbe007fb5cb24008f6d496ae9"
        checksum-type="md5" size="520"
        path="src/expat-2.0.1.CVE-2009-3560.patch"/>
      <patch checksum="375216d79d8a04520ea31c7a657bca38"
        checksum-type="md5" size="452"
        path="src/expat-2.0.1.CVE-2009-3720.patch"/>
      <patch checksum="5827b5c909c35c8f260967c65b37966f"
        checksum-type="md5" size="20685"
        path="src/expat-2.0.1.CVE-2012-0876.patch"/>
      <patch checksum="92a8364f49da3780a6575b3c21db4880"
        checksum-type="md5" size="864"
        path="src/expat-2.0.1.CVE-2012-1148.patch"/>
      <patch checksum="2236a9261d8dbf604eab40dffd42f52b"
        checksum-type="md5" size="1520"
        path="src/expat-2.0.1.tww.patch"/>
      <patch checksum="91ba6f96f497ee580f5ef4b3c4bff278"
        checksum-type="md5" size="1122749"
        path="src/expat-2.0.1.auto.patch"/>
    </sources>

    <module name="default">
      <validate>
        <depend program="expat" module="64bit"
          systype="*-aix*|*-hpux*|*-irix*|*-solaris*">v==2.0.1</depend>
      </validate>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -qmaxmem=-1 -qarch=ppc"
  LDFLAGS="-Wl,-brtl" ;;
*-hpux11.[01]*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +DAportable \
+Oentrysched +Odataprefetch +Onolimit" ;;
*-hpux*)
  CC=cc CFLAGS="-z +O2 +Ofltacc +Olit=all +Oentrysched \
+Odataprefetch +Onolimit" ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1009,1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-O2 -OPT:Olimit=0" ;;
i?86*-freebsd*)
  CFLAGS="-O2 -mtune=pentium4 -march=pentium4" ;;
i?86*-linux*)
  CFLAGS="-O2 -mtune=pentiumpro -march=pentiumpro" ;;
*-osf*)
  CC=cc CFLAGS="-O2 -arch ev5 -msym -readonly_strings" ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=pentium4" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-xarch=v8plusa" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=ultra2 \
-m32 -xarch=sparcvis" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
LDFLAGS="${LDFLAGS+${LDFLAGS}}" --enable-shared \
--enable-static --mandir="${SB_INSTALL_PREFIX}/man" \
--libdir=${SB_INSTALL_PREFIX_LIB} --prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>
    </module>

    <module name="64bit"
    systype="*-aix*|*-hpux*|*-irix*|*-solaris*">
      <script-header>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  _libdir=lib/ppc64 ;;
ia64*-hpux*)
  _libdir=lib/hpux64 ;;
*-hpux*)
  _libdir=lib/pa20_64 ;;
*-irix*)
  _libdir=lib64 ;;
i?86*-solaris*)
  _libdir=lib/amd64 ;;
*-solaris*)
  _libdir=lib/sparcv9 ;;
esac

case "${SB_SYSTYPE}" in
*-aix*)
  export OBJECT_MODE=64 ;;
esac
]]>
      </script-header>

      <configure>
<![CDATA[
case "${SB_SYSTYPE}" in
*-aix*)
  CC=xlc CFLAGS="-O2 -qro -qroconst -q64 -qmaxmem=-1"
  LDFLAGS="-Wl,-brtl" ;;
ia64*-hpux*)
  CC=cc CFLAGS="+O2 +Olit=all +Onofltacc +Oentrysched +DD64 \
+Odataprefetch +Onolimit" ;;
*-hpux*)
  CC=cc CFLAGS="+O2 +Olit=all +Onofltacc +Oentrysched +DD64 \
+Odataprefetch +Onolimit"

  case "${SB_SYSTYPE}" in
  *-hpux11.31)
    ARGS="--build=hppa64-hp-hpux11.31" ;;
  *-hpux11.23)
    ARGS="--build=hppa64-hp-hpux11.23" ;;
  *-hpux11.11)
    ARGS="--build=hppa64-hp-hpux11.11" ;;
  *-hpux11.00)
    ARGS="--build=hppa64-hp-hpux11.00" ;;
  esac ;;
*-irix*)
  CC=cc CFLAGS="-Wl,-woff,84 -Wl,-woff,85 -woff 1429 \
-use_readonly_const -G0 -rdata_shared -DEBUG:optimize_space=ON \
-64 -mips4 -O2 -OPT:Olimit=0" ;;
i?86*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=opteron -m64 \
-xarch=sse2" ;;
*-solaris2.8)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -xarch=v9" ;;
*-solaris*)
  CC=cc CFLAGS="-mr -Qn -xstrconst -xO2 -xtarget=generic -m64 \
-xarch=sparc" ;;
esac

${SHELL} ./configure CC="${CC:-gcc}" CFLAGS="${CFLAGS:--O2}" \
${LDFLAGS+LDFLAGS="${LDFLAGS}"} --enable-shared --enable-static \
--libdir="${SB_INSTALL_PREFIX}/${_libdir}" \
--mandir="${SB_INSTALL_PREFIX}/man" ${ARGS+${ARGS}} \
--prefix=${SB_INSTALL_PREFIX}
]]>
      </configure>

      <install>
<![CDATA[
if [ ! -d ${SB_INSTALL_PREFIX}/lib/64 ]; then
  case "${SB_SYSTYPE}" in
  *-aix*|*-hpux*|*-solaris*)
    ln -s ./$(basename ${_libdir}) ${SB_INSTALL_PREFIX}/lib/64 ;;
  *-irix*)
    ln -s ../lib64 ${SB_INSTALL_PREFIX}/lib/64 ;;
  esac
fi

gmake installlib
]]>
      </install>

      <uninstall>
<![CDATA[
rm -rf ${SB_INSTALL_PREFIX}/lib/64 ${SB_INSTALL_PREFIX}/${_libdir}
]]>
      </uninstall>
    </module>

    <notes>
      <change from="2.0.0" to="2.0.1">
        <item><para>Fixed: The character data handler's calling of
XML_StopParser() was not handled properly; if the parser was stopped
and the handler set to NULL, the parser would segfault.</para></item>
        <item><para>Fixed: Expat failed on EBCDIC systems as it
assumed some character constants to be ASCII encoded.</para></item>
        <item><para>Minor cleanups of the test harness.</para></item>
        <item><para>Minor fixes for xmlwf and example
programs.</para></item>
        <item><para>Fixes and improvements for the Windows
platform. New Windows directory structure.</para></item>
        <item><para>Build fixes for various platforms: HP-UX, Tru64,
Solaris 9.</para></item>
        <item><para>Build fixes for Unix:</para>
        <unorderedlist>
          <item><para>Refreshed config.sub/config.guess.</para></item>
          <item><para>Support both, DESTDIR and INSTALL_ROOT, without
relying on GNU-Make specific features.</para></item>
          <item><para>Patched configure.in to work better with Intel
compiler.</para></item>
          <item><para>Fixes to Makefile.in to have make check work
correctly.</para></item>
        </unorderedlist></item>
        <item><para>Added Open Watcom support.</para></item>
      </change>

      <change from="1.95.8" to="2.0.0">
        <item><para>Fixed headers for use from C++.</para></item>
        <item><para>XML_GetCurrentLineNumber() and
XML_GetCurrentColumnNumber() now return unsigned
integers.</para></item>
        <item><para>Added XML_LARGE_SIZE switch to enable 64-bit
integers for byte indexes and line/column numbers.</para></item>
        <item><para>Added support for AmigaOS.</para></item>
        <item><para>Some mostly minor bug fixes. SF issues include:
1006708, 1021776, 1023646, 1114960, 1156398, 1221160,
1271642.</para></item>
      </change>
    </notes>

    <changelog>
      <change date="2012 August 13" revision="9"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Apply patch for CVE-2009-3560 (<ulink url="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3560">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3560</ulink>).
The <command>big2_toUtf8</command> function in
<command>lib/xmltok.c</command> in libexpat, allows context-dependent
attackers to cause a denial of service (application crash) via an XML
document with malformed UTF-8 sequences that trigger a buffer
over-read, related to the <command>doProlog</command> function in
<command>lib/xmlparse.c</command>, a different vulnerability than
CVE-2009-2625 and CVE-2009-3720.</para></item>
        <item><para>Apply patch for CVE-2012-0876 (<ulink url="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0876">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0876</ulink>).
A denial of service flaw was found in the implementation of hash
arrays in Expat. An attacker could use this flaw to make an
application using Expat consume an excessive amount of CPU time by
providing a specially-crafted XML file that triggers multiple hash
function collisions. To mitigate this issue, randomization has been
added to the hash function to reduce the chance of an attacker
successfully causing intentional collisions.</para></item>
        <item><para>Apply patch for CVE-2012-1148 (<ulink url="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1148">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1148</ulink>).
A memory leak flaw was found in Expat. If an XML file processed by an
application linked against Expat triggered a memory re-allocation
failure, Expat failed to free the previously allocated memory. This
could cause the application to exit unexpectedly or crash when all
available memory is exhausted.</para></item>
      </change>

      <change date="2010 November 19" revision="8"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 7.1</para></item>
      </change>

      <change date="2010 June 29" revision="7"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for RHEL 6</para></item>
      </change>

      <change date="2009 November 4" revision="6"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Apply patch for CVE-2009-3720 (<ulink url="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3720">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3720</ulink>).
A buffer over-read flaw was found in the way Expat handles malformed
UTF-8 sequences when processing XML files. A specially-crafted XML
file could cause applications using Expat to crash while parsing the
file.</para></item>
      </change>

      <change date="2008 December 24" revision="5"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for SLES 10</para></item>
      </change>

      <change date="2008 September 3" revision="4"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for AIX 6.1</para></item>
      </change>

      <change date="2008 July 22" revision="3"
      author="Gary V. Vaughan" email="gary@thewrittenword.com">
        <item><para>On HPPA, use +Ofltacc compiler option instead of
+Onofltacc</para></item>
        <item><para>On Solaris 9 and 10/sparc, support latest
compilers</para></item>
      </change>

      <change date="2008 July 8" revision="2"
      author="Albert Chin-A-Young" email="china@thewrittenword.com">
        <item><para>Add support for HP-UX 11.31/IA</para></item>
      </change>
    </changelog>
  </program>
</programs>
